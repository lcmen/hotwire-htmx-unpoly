// unpoly@3.9.2 downloaded from https://ga.jspm.io/npm:unpoly@3.9.2/unpoly.js

var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;(()=>{var t=[,()=>{window.up={version:"3.9.2"}},()=>{up.mockable=function(t){if(window.jasmine){let r=t.name;let n={[r]:t};let mockableFn=function(){return n[r].apply(this||e,arguments)};mockableFn.mock=()=>spyOn(n,r);return mockableFn}return t}},()=>{up.util=function(){function noop(){}function asyncNoop(){return Promise.resolve()}function memoize(t){let r,n;return function(...s){if(n)return r;n=true;return r=t.apply(this||e,s)}}function normalizeURL(e,t){t=newOptions(t,{host:"cross-domain"});const r=parseURL(e);let n="";t.host==="cross-domain"&&(t.host=isCrossOrigin(r));t.host&&(n+=r.protocol+"//"+r.host);let{pathname:s}=r;t.trailingSlash===false&&s!=="/"&&(s=s.replace(/\/$/,""));n+=s;t.search!==false&&(n+=r.search);t.hash!==false&&(n+=r.hash);return n}function matchURLs(e,t,r){return matchableURL(e,r)===matchableURL(t,r)}function matchableURL(e,t){if(e)return normalizeURL(e,{hash:false,trailingSlash:false,...t})}function matchableURLPatternAtom(e){return e.endsWith("/")?[e,e.slice(0,-1)]:e.includes("/?")?[e,e.replace("/?","?")]:e.endsWith("/*")?[e,e.slice(0,-2),e.slice(0,-2)+"?*"]:e}const t=location.protocol;const r=location.hostname;function isCrossOrigin(e){if(isString(e)&&e.indexOf("//")===-1)return false;const n=parseURL(e);return r!==n.hostname||t!==n.protocol}function parseURL(e){if(e.pathname)return e;let t=document.createElement("a");t.href=e;return t}function normalizeMethod(e){return e?e.toUpperCase():"GET"}function methodAllowsPayload(e){return e!=="GET"&&e!=="HEAD"}function iteratee(e){return isString(e)?t=>t[e]:e}function map(e,t){if(e.length===0)return[];t=iteratee(t);let r=[];let n=0;for(let s of e)r.push(t(s,n++));return r}function mapObject(e,t){const merger=function(e,t){e[t[0]]=t[1];return e};return map(e,t).reduce(merger,{})}function each(e,t){let r=0;for(let n of e)t(n,r++)}function isNull(e){return e===null}function isUndefined(e){return e===void 0}const n=negate(isUndefined);function isMissing(e){return isUndefined(e)||isNull(e)}const s=negate(isMissing);function isBlank(e){return!!isMissing(e)||(isObject(e)&&e[isBlank.key]?e[isBlank.key]():isString(e)||isList(e)?e.length===0:!!isOptions(e)&&Object.keys(e).length===0)}isBlank.key="up.util.isBlank";function presence(e,t=i){if(t(e))return e}const i=negate(isBlank);function isFunction(e){return typeof e==="function"}function isString(e){return typeof e==="string"||e instanceof String}function isBoolean(e){return typeof e==="boolean"||e instanceof Boolean}function isNumber(e){return typeof e==="number"||e instanceof Number}function isOptions(e){return typeof e==="object"&&!isNull(e)&&(isUndefined(e.constructor)||e.constructor===Object)}function isObject(e){const t=typeof e;return t==="object"&&!isNull(e)||t==="function"}function isElement(e){return e instanceof Element}function isRegExp(e){return e instanceof RegExp}function isError(e){return e instanceof Error}function isJQuery(e){return up.browser.canJQuery()&&e instanceof jQuery}function isElementish(e){return!!(e&&(e.addEventListener||e[0]?.addEventListener))}function isPromise(e){return isObject(e)&&isFunction(e.then)}const{isArray:o}=Array;function isFormData(e){return e instanceof FormData}function toArray(e){return o(e)?e:copyArrayLike(e)}function isList(e){return o(e)||isNodeList(e)||isArguments(e)||isJQuery(e)||isHTMLCollection(e)}function isNodeList(e){return e instanceof NodeList}function isHTMLCollection(e){return e instanceof HTMLCollection}function isArguments(e){return Object.prototype.toString.call(e)==="[object Arguments]"}function wrapList(e){return isList(e)?e:isMissing(e)?[]:[e]}function copy(e){isObject(e)&&e[copy.key]?e=e[copy.key]():isList(e)?e=copyArrayLike(e):isOptions(e)&&(e=Object.assign({},e));return e}function copyArrayLike(e){return Array.prototype.slice.call(e)}copy.key="up.util.copy";Date.prototype[copy.key]=function(){return new Date(+(this||e))};function merge(...e){return Object.assign({},...e)}function mergeDefined(...e){const t={};for(let r of e)if(r)for(let e in r){const s=r[e];n(s)&&(t[e]=s)}return t}function newOptions(e,t){return t?merge(t,e):e?copy(e):{}}function parseArgIntoOptions(e,t){let r=extractOptions(e);if(n(e[0])){r=copy(r);r[t]=e[0]}return r}function findInList(e,t){t=iteratee(t);let r;for(let n of e)if(t(n)){r=n;break}return r}function some(e,t){return!!findResult(e,t)}function findResult(e,t){t=iteratee(t);let r=0;for(let n of e){const e=t(n,r++);if(e)return e}}function every(e,t){t=iteratee(t);let r=true;let n=0;for(let s of e)if(!t(s,n++)){r=false;break}return r}function compact(e){return filterList(e,s)}function compactObject(e){return pickBy(e,s)}function uniq(e){return e.length<2?e:Array.from(new Set(e))}function uniqBy(e,t){if(e.length<2)return e;t=iteratee(t);const r=new Set;return filterList(e,(function(e,n){const s=t(e,n);if(r.has(s))return false;r.add(s);return true}))}function filterList(e,t){t=iteratee(t);const r=[];each(e,(function(e,n){if(t(e,n))return r.push(e)}));return r}function reject(e,t){t=negate(iteratee(t));return filterList(e,t)}function intersect(e,t){return filterList(e,(e=>contains(t,e)))}function scheduleTimer(e,t){return setTimeout(t,e)}function queueTask(e){return setTimeout(e)}function last(e){return e[e.length-1]}function contains(e,t){let r=e.indexOf||Array.prototype.indexOf;return r.call(e,t)>=0}function containsAll(e,t){return every(t,(t=>contains(e,t)))}function objectContains(e,t){const r=pick(e,Object.keys(t));return isEqual(t,r)}function pick(e,t){const r={};for(let n of t)n in e&&(r[n]=e[n]);return r}function pickBy(e,t){t=iteratee(t);const r={};for(let n in e){const s=e[n];t(s,n,e)&&(r[n]=e[n])}return r}function omit(e,t){return pickBy(e,((e,r)=>!contains(t,r)))}function unresolvablePromise(){return new Promise(noop)}function remove(e,t){const r=e.indexOf(t);if(r>=0){e.splice(r,1);return t}}function evalOption(e,...t){return isFunction(e)?e(...t):e}function evalAutoOption(e,t,...r){e=evalOption(e,...r);e==="auto"&&(e=evalOption(t,...r));return e}const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};function escapeHTML(e){return e.replace(/[&<>"']/g,(e=>a[e]))}function escapeRegExp(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}function pluckKey(e,t){const r=e[t];delete e[t];return r}function renameKey(e,t,r){return e[r]=pluckKey(e,t)}function extractLastArg(e,t){if(t(last(e)))return e.pop()}function extractCallback(e){return extractLastArg(e,isFunction)}function extractOptions(e){return extractLastArg(e,isOptions)||{}}function identity(e){return e}function sequence(e){e=compact(e);return(...t)=>map(e,(e=>e(...t)))}function flatten(e){const t=[];for(let r of e)isList(r)?t.push(...r):t.push(r);return t}function flatMap(e,t){return flatten(map(e,t))}function always(e,t=identity){return e.then(t,t)}function newDeferred(){let e;let t;const r=new Promise((function(r,n){e=r;t=n}));r.resolve=e;r.reject=t;return r}function isBasicObjectProperty(e){return Object.prototype.hasOwnProperty(e)}function isEqual(e,t){e?.valueOf&&(e=e.valueOf());t?.valueOf&&(t=t.valueOf());if(typeof e!==typeof t)return false;if(isList(e)&&isList(t))return isEqualList(e,t);if(isObject(e)&&e[isEqual.key])return e[isEqual.key](t);if(isOptions(e)&&isOptions(t)){const r=Object.keys(e);const n=Object.keys(t);return!!isEqualList(r,n)&&every(r,(r=>isEqual(e[r],t[r])))}return e===t}isEqual.key="up.util.isEqual";function isEqualList(e,t){return e.length===t.length&&every(e,((e,r)=>isEqual(e,t[r])))}const u={"space/or":/\s+(?:or\s+)?/,or:/\s+or\s+/,comma:/\s*,\s*/};function parseTokens(e,t={}){if(isString(e)){e=e.trim();if(t.json&&/^\[.*]$/.test(e))return JSON.parse(e);{let r=t.separator||"space/or";let n=u[r];return e.split(n)}}return wrapList(e)}function wrapValue(e,...t){return t[0]instanceof e?t[0]:new e(...t)}let l=0;function uid(){return l++}function reverse(e){return copy(e).reverse()}function replaceValue(e,t,r){return e===t?r:e}function renameKeys(e,t){const r={};for(let n in e)r[t(n)]=e[n];return r}function camelToKebabCase(e){return e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))}function lowerCaseFirst(e){return e[0].toLowerCase()+e.slice(1)}function upperCaseFirst(e){return e[0].toUpperCase()+e.slice(1)}function defineDelegates(t,r,n){for(let s of r)Object.defineProperty(t,s,{get(){const t=n.call(this||e);let r=t[s];isFunction(r)&&(r=r.bind(t));return r},set(t){const r=n.call(this||e);r[s]=t}})}function stringifyArg(e,t="%o"){let r;const n=200;if(t==="%c")return"";t==="%s"&&s(e)&&(e=e.toString());if(isString(e)){r=e.trim().replace(/[\n\r\t ]+/g," ");t==="%o"&&(r=JSON.stringify(r))}else if(isUndefined(e))r="undefined";else if(isNumber(e)||isFunction(e))r=e.toString();else if(o(e))r=`[${map(e,stringifyArg).join(", ")}]`;else if(isJQuery(e))r=`$(${map(e,stringifyArg).join(", ")})`;else if(isElement(e)){r=`<${e.tagName.toLowerCase()}`;for(let t of["id","up-id","name","class"]){let n=e.getAttribute(t);n&&(r+=` ${t}="${n}"`)}r+=">"}else if(isRegExp(e)||isError(e))r=e.toString();else try{r=JSON.stringify(e)}catch(e){if(e.name!=="TypeError")throw e;r="(circular structure)"}r.length>n&&(r=`${r.substr(0,n)}â€¦${last(r)}`);return r}const c=/%[oOdisfc]/g;function sprintf(e,...t){return e.replace(c,(e=>stringifyArg(t.shift(),e)))}function negate(e){return function(...t){return!e(...t)}}function useMemoizeCacheEntry(e){if(e.error)throw e.error;return e.value}function buildMemoizeCacheEntry(e,t,r){try{return{value:e.apply(t,r)}}catch(e){return{error:e}}}function memoizeMethod(t,r){for(let n in r){let r=Object.getOwnPropertyDescriptor(t,n);let s=r.value;let cachingImpl=function(...t){let r=(this||e)[`__${n}MemoizeCache`]||={};let i=JSON.stringify(t);r[i]||=buildMemoizeCacheEntry(s,this||e,t);return useMemoizeCacheEntry(r[i])};t[n]=cachingImpl}}function safeStringifyJSON(e){let t=JSON.stringify(e);return escapeHighASCII(t)}function escapeHighASCII(e){let unicodeEscape=e=>"\\u"+e.charCodeAt(0).toString(16).padStart(4,"0");return e.replace(/[^\x00-\x7F]/g,unicodeEscape)}function variant(e,t={}){let r=Object.create(e);Object.assign(r,t);return r}return{parseURL:parseURL,normalizeURL:normalizeURL,matchableURL:matchableURL,matchableURLPatternAtom:matchableURLPatternAtom,matchURLs:matchURLs,normalizeMethod:normalizeMethod,methodAllowsPayload:methodAllowsPayload,copy:copy,merge:merge,mergeDefined:mergeDefined,options:newOptions,parseArgIntoOptions:parseArgIntoOptions,each:each,map:map,flatMap:flatMap,mapObject:mapObject,findResult:findResult,some:some,every:every,find:findInList,filter:filterList,reject:reject,intersect:intersect,compact:compact,compactObject:compactObject,uniq:uniq,uniqBy:uniqBy,last:last,isNull:isNull,isDefined:n,isUndefined:isUndefined,isGiven:s,isMissing:isMissing,isPresent:i,isBlank:isBlank,presence:presence,isObject:isObject,isFunction:isFunction,isString:isString,isBoolean:isBoolean,isNumber:isNumber,isElement:isElement,isJQuery:isJQuery,isElementish:isElementish,isPromise:isPromise,isOptions:isOptions,isArray:o,isFormData:isFormData,isList:isList,isRegExp:isRegExp,timer:scheduleTimer,contains:contains,containsAll:containsAll,objectContains:objectContains,toArray:toArray,pick:pick,pickBy:pickBy,omit:omit,unresolvablePromise:unresolvablePromise,remove:remove,memoize:memoize,pluckKey:pluckKey,renameKey:renameKey,extractOptions:extractOptions,extractCallback:extractCallback,noop:noop,asyncNoop:asyncNoop,identity:identity,escapeHTML:escapeHTML,escapeRegExp:escapeRegExp,sequence:sequence,evalOption:evalOption,evalAutoOption:evalAutoOption,flatten:flatten,newDeferred:newDeferred,always:always,isBasicObjectProperty:isBasicObjectProperty,isCrossOrigin:isCrossOrigin,task:queueTask,isEqual:isEqual,parseTokens:parseTokens,wrapList:wrapList,wrapValue:wrapValue,uid:uid,upperCaseFirst:upperCaseFirst,lowerCaseFirst:lowerCaseFirst,delegate:defineDelegates,reverse:reverse,camelToKebabCase:camelToKebabCase,replaceValue:replaceValue,sprintf:sprintf,renameKeys:renameKeys,memoizeMethod:memoizeMethod,safeStringifyJSON:safeStringifyJSON,variant:variant}}()},()=>{up.error=function(){function fail(...e){throw new up.Error(e)}function isCritical(e){return typeof e!=="object"||e.name!=="AbortError"&&!(e instanceof up.RenderResult)&&!(e instanceof up.Response)}function muteUncriticalRejection(e){return e.catch(throwCritical)}function muteUncriticalSync(e){try{return e()}catch(e){throwCritical(e)}}function throwCritical(e){if(isCritical(e))throw e}function report(e){console.error("Uncaught %o",e);let t=new ErrorEvent("error",{error:e,message:"Uncaught "+e});window.dispatchEvent(t)}function guard(e){try{return e()}catch(e){report(e)}}function guardFn(e){return(...t)=>guard((()=>e(...t)))}return{fail:fail,throwCritical:throwCritical,muteUncriticalRejection:muteUncriticalRejection,muteUncriticalSync:muteUncriticalSync,guard:guard,guardFn:guardFn}}();up.fail=up.error.fail},()=>{up.migrate={config:{}}},()=>{up.browser=function(){const e=up.util;function submitForm(e){e.submit()}function canPushState(){return up.protocol.initialRequestMethod()==="GET"}function canJQuery(){return!!window.jQuery}const t=e.memoize((()=>CSS.supports("selector(:has(*))")));function popCookie(e){let t=document.cookie.match(new RegExp(e+"=(\\w+)"))?.[1];if(t){document.cookie=e+"=;Max-Age=0;Path=/";return t}}function assertConfirmed(e){const t=!e.confirm||window.confirm(e.confirm);if(!t)throw new up.Aborted("User canceled action");return true}return{submitForm:submitForm,canPushState:canPushState,canJQuery:canJQuery,assertConfirmed:assertConfirmed,popCookie:popCookie,canHasSelector:t}}()},(e,t,r)=>{r(8);up.element=function(){const e=up.util;function first(...e){const t=e.pop();const r=e[0]||document;return r.querySelector(t)}function subtree(e,t){const r=[];e.matches(t)&&r.push(e);r.push(...e.querySelectorAll(t));return r}function contains(e,t){const r=getOne(t);return Node.prototype.contains.call(e,r)}function ancestor(e,t){return e.parentNode?.closest(t)}function around(e,t){return getList(e.closest(t),subtree(e,t))}function getOne(...t){const r=t.pop();if(e.isElement(r))return r;if(e.isString(r))return first(...t,r);if(e.isList(r)){r.length>1&&up.fail("up.element.get(): Cannot cast multiple elements (%o) to a single element",r);return r[0]}return r}function getList(...t){return e.flatMap(t,valueToList)}function valueToList(t){return e.isString(t)?document.querySelectorAll(t):e.wrapList(t)}function hide(e){e.setAttribute("hidden","")}function show(e){e.removeAttribute("hidden");e.style.display==="none"&&(e.style.display="")}function toggle(e,t){t==null&&(t=!isVisible(e));(t?show:hide)(e)}function toggleAttr(e,t,r,n){n==null&&(n=!e.hasAttribute(t));return n?e.setAttribute(t,r):e.removeAttribute(t)}function setAttrs(t,r){for(let n in r){const s=r[n];e.isGiven(s)?t.setAttribute(n,s):t.removeAttribute(n)}}function setTemporaryAttrs(e,t){const r={};for(let n of Object.keys(t))r[n]=e.getAttribute(n);setAttrs(e,t);return()=>setAttrs(e,r)}function metaContent(e){const t="meta"+attrSelector("name",e);return first(t)?.getAttribute("content")}function insertBefore(e,t){e.insertAdjacentElement("beforebegin",t)}function createFromSelector(t,r={}){let{includePath:n}=parseSelector(t);let s;let i;let o;for(let e of n){let{tagName:t,id:r,classNames:n,attributes:a}=e;t&&t!=="*"||(t="div");i=document.createElement(t);s||(s=i);r&&(i.id=r);for(let e of n)i.classList.add(e);for(let e in a){let t=a[e];i.setAttribute(e,t||"")}o?.appendChild(i);o=i}for(let t in r){let n=r[t];if(t==="class")for(let t of e.wrapList(n))s.classList.add(t);else t==="style"?setInlineStyle(s,n):t==="text"?s.textContent=n:t==="content"?s.innerHTML=n:s.setAttribute(t,n)}return s}function parseSelector(e){let t;const r=e.replace(/:not\([^)]+\)/,(function(e){t=e;return""}));const[n,s]=removeAttrSelectorValues(r);const i=n.split(/[ >]+/);let o=i.map((function(t){let r={tagName:null,classNames:[],id:null,attributes:{}};t=t.replace(/^[\w-*]+/,(function(e){r.tagName=e;return""}));t=t.replace(/#([\w-]+)/,(function(e,t){r.id=t;return""}));t=t.replace(/\.([\w-]+)/g,(function(e,t){r.classNames.push(t);return""}));s.length&&(t=replaceAttrSelectors(t,(function({name:e}){r.attributes[e]=s.shift();return""})));t&&up.fail("Cannot parse selector: "+e);return r}));return{includePath:o,includeRaw:r,excludeRaw:t}}const t=/\[([\w-]+)(?:([~|^$*]?=)(["'])?([^\3\]]*?)\3)?]/g;function replaceAttrSelectors(e,r){return e.replace(t,(function(e,t,n,s,i){i&&(i=i.replace(/\\([\\"'])/,"$1"));return r({name:t,operator:n,quote:s,value:i})}))}function removeAttrSelectorValues(e){let t=[];e=replaceAttrSelectors(e,(function({name:e,value:r}){t.push(r);return`[${e}]`}));return[e,t]}function affix(t,...r){let n,s;const i=e.extractOptions(r);if(r.length===2)[n,s]=r;else{n="beforeend";s=r[0]}const o=createFromSelector(s,i);t.insertAdjacentElement(n,o);return o}const r=["HTML","BODY","HEAD","TITLE"];const n=up.mockable((e=>e.matches(r.join())));function elementTagName(e){return e.tagName.toLowerCase()}function attrSelector(t,r){if(e.isGiven(r)){r=r.replace(/"/g,'\\"');return`[${t}="${r}"]`}return`[${t}]`}function idSelector(e){return e.match(/^[a-z][a-z0-9\-_]*$/i)?`#${e}`:attrSelector("id",e)}function classSelector(e){e=e.replace(/[^\w-]/g,"\\$&");return`.${e}`}function createBrokenDocumentFromHTML(e){return(new DOMParser).parseFromString(e,"text/html")}function fixParserDamage(e){let t=createFromHTML(e.outerHTML);e.replaceWith(t)}function createFromHTML(e){const t=document.createRange();t.setStart(document.body,0);const r=t.createContextualFragment(e.trim());let n=r.childNodes;if(n.length!==1)throw new Error("HTML must have a single root element");return n[0]}function getRoot(){return document.documentElement}function paint(e){e.offsetHeight}function concludeCSSTransition(e){const t=setTemporaryStyle(e,{transition:"none"});paint(e);return t}function hasCSSTransition(e){const t=e["transition-property"];const r=e["transition-duration"];const n=t==="none"||t==="all"&&r===0;return!n}function fixedToAbsolute(e){const t=e.getBoundingClientRect();e.style.position="absolute";const r=e.offsetParent.getBoundingClientRect();setInlineStyle(e,{left:t.left-computedStyleNumber(e,"margin-left")-r.left+"px",top:t.top-computedStyleNumber(e,"margin-top")-r.top+"px",right:"",bottom:""})}function setMissingAttrs(e,t){for(let r in t)setMissingAttr(e,r,t[r])}function setMissingAttr(t,r,n){e.isMissing(t.getAttribute(r))&&t.setAttribute(r,n)}function unwrap(t){preservingFocus((function(){const r=t.parentNode;const n=e.toArray(t.childNodes);e.each(n,(e=>r.insertBefore(e,t)));r.removeChild(t)}))}function wrapChildren(e){let t;const r=document.createElement("up-wrapper");while(t=e.firstChild)r.appendChild(t);e.appendChild(r);return r}function preservingFocus(e){const t=document.activeElement;try{return e()}finally{t&&t!==document.activeElement&&t.focus({preventScroll:true})}}function stringAttr(t,r){let n=t.getAttribute(r);return e.replaceValue(n,null,void 0)}function booleanAttr(e,t,r){if(!e.hasAttribute(t))return;const n=stringAttr(e,t);switch(n){case"false":return false;case"true":case"":case t:return true;default:return!r||n}}function booleanOrStringAttr(e,t,r=true){let n=booleanAttr(e,t,true);return n===true?r:n}function numberAttr(e,t){let r=e.getAttribute(t);if(r){r=r.replace(/_/g,"");if(r.match(/^-?[\d.]+$/))return parseFloat(r)}}function jsonAttr(e,t){let r=e.getAttribute?.(t)?.trim();if(r)return JSON.parse(r)}function callbackAttr(t,r,{exposedKeys:n=[],mainKey:s="event"}={}){let i=t.getAttribute(r);if(i){const r=up.NonceableCallback.fromString(i).toFunction(s,...n);return function(s){const i=Object.values(e.pick(s,n));return r.call(t,s,...i)}}}function closestAttr(e,t,r=stringAttr){let n=e.closest("["+t+"]");if(n)return r(n,t)}function setTemporaryStyle(e,t){const r=inlineStyle(e,Object.keys(t));setInlineStyle(e,t);return()=>setInlineStyle(e,r)}function addTemporaryClass(e,t){e.classList.add(t);return()=>e.classList.remove(t)}function computedStyle(e,t){const r=window.getComputedStyle(e);return extractFromStyleObject(r,t)}function computedStyleNumber(t,r){const n=computedStyle(t,r);if(e.isPresent(n))return parseFloat(n)}function inlineStyle(e,t){const{style:r}=e;return extractFromStyleObject(r,t)}function extractFromStyleObject(t,r){up.migrate.loaded&&(r=up.migrate.fixStyleProps(r));return e.isString(r)?t.getPropertyValue(r):e.mapObject(r,(e=>[e,t.getPropertyValue(e)]))}function setInlineStyle(t,r,n=""){up.migrate.loaded&&(r=up.migrate.fixStyleProps(r,n));if(e.isString(r))t.setAttribute("style",r);else{const{style:e}=t;for(let t in r){let s=r[t];e.setProperty(t,s+n)}}}function isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}function isUpPrefixed(e){return/^up-/.test(e)}function upAttrs(t){let r=e.filter(t.getAttributeNames(),isUpPrefixed);return e.mapObject(r,(e=>[e,t.getAttribute(e)]))}function upClasses(t){return e.filter(t.classList.values(),isUpPrefixed)}function cleanJQuery(e){up.browser.canJQuery()&&jQuery(e).remove()}function isEmpty(e){return!e.children.length>0&&!e.innerText.trim()}function crossOriginSelector(e){return`[${e}*="//"]:not([${e}*="//${location.host}/"])`}function isIntersectingWindow(e,{margin:t=0}={}){const r=up.Rect.fromElement(e);r.grow(t);return r.bottom>0&&r.top<window.innerHeight&&r.right>0&&r.left<window.innerWidth}function unionSelector(t,r){let n=`:is(${t.join()})`;e.isPresent(r)&&(n+=`:not(${r.join()})`);return n}return{subtree:subtree,contains:contains,closestAttr:closestAttr,ancestor:ancestor,around:around,get:getOne,list:getList,toggle:toggle,hide:hide,show:show,metaContent:metaContent,insertBefore:insertBefore,createFromSelector:createFromSelector,setAttrs:setAttrs,setTemporaryAttrs:setTemporaryAttrs,affix:affix,idSelector:idSelector,classSelector:classSelector,isSingleton:n,attrSelector:attrSelector,tagName:elementTagName,createBrokenDocumentFromHTML:createBrokenDocumentFromHTML,fixParserDamage:fixParserDamage,createFromHTML:createFromHTML,get root(){return getRoot()},paint:paint,concludeCSSTransition:concludeCSSTransition,hasCSSTransition:hasCSSTransition,fixedToAbsolute:fixedToAbsolute,setMissingAttrs:setMissingAttrs,setMissingAttr:setMissingAttr,unwrap:unwrap,wrapChildren:wrapChildren,attr:stringAttr,booleanAttr:booleanAttr,numberAttr:numberAttr,jsonAttr:jsonAttr,callbackAttr:callbackAttr,booleanOrStringAttr:booleanOrStringAttr,setTemporaryStyle:setTemporaryStyle,style:computedStyle,styleNumber:computedStyleNumber,inlineStyle:inlineStyle,setStyle:setInlineStyle,isVisible:isVisible,upAttrs:upAttrs,upClasses:upClasses,toggleAttr:toggleAttr,addTemporaryClass:addTemporaryClass,cleanJQuery:cleanJQuery,parseSelector:parseSelector,isEmpty:isEmpty,crossOriginSelector:crossOriginSelector,isIntersectingWindow:isIntersectingWindow,unionSelector:unionSelector}}()},(e,t,r)=>{r.r(t)},()=>{up.Error=class Error extends window.Error{constructor(e,t={}){Array.isArray(e)&&(e=up.util.sprintf(...e));super(e);let r="up."+this.constructor.name;Object.assign(this,{name:r},t)}}},()=>{up.NotImplemented=class NotImplemented extends up.Error{}},()=>{up.Aborted=class Aborted extends up.Error{constructor(e){super(e,{name:"AbortError"})}}},()=>{up.CannotMatch=class CannotMatch extends up.Error{}},()=>{up.CannotParse=class CannotParse extends up.Error{}},()=>{up.CannotTarget=class CannotTarget extends up.Error{}},()=>{up.Offline=class Offline extends up.Error{}},()=>{const e=up.util;up.Record=class Record{keys(){throw"Return an array of keys"}defaults(e){return{}}constructor(e){Object.assign(this,this.defaults(e),this.attributes(e))}attributes(t=this){return e.pick(t,this.keys())}[e.copy.key](){return e.variant(this)}[e.isEqual.key](t){return this.constructor===t.constructor&&e.isEqual(this.attributes(),t.attributes())}}},()=>{const e=up.util;const t=up.element;up.Config=class Config{constructor(e=(()=>({}))){this._blueprintFn=e;this.reset();document.addEventListener("up:framework:reset",(()=>this.reset()))}reset(){Object.assign(this,this._blueprintFn())}matches(e,t){return e.matches(this.selector(t))}selector(r){let n=this[r];let s=this["no"+e.upperCaseFirst(r)];return t.unionSelector(n,s)}selectorFn(e){return()=>this.selector(e)}}},()=>{let e="up.log.enabled";let t=false;try{t=!!sessionStorage?.getItem(e)}catch{}up.LogConfig=class LogConfig extends up.Config{constructor(){super((()=>({banner:true,format:true})))}get enabled(){return t}set enabled(r){t=r;try{sessionStorage?.setItem(e,r?"1":"")}catch{}}}},()=>{const e=up.util;const t=up.element;up.OptionsParser=class OptionsParser{constructor(e,t,r={}){this._options=t;this._element=e;this._parserOptions=r;this._fail=r.fail;this._closest=r.closest;this._attrPrefix=r.attrPrefix||"up-";this._defaults=r.defaults||{}}string(e,r){this.parse(t.attr,e,r)}boolean(e,r){this.parse(t.booleanAttr,e,r)}number(e,r){this.parse(t.numberAttr,e,r)}booleanOrString(e,r){this.parse(t.booleanOrStringAttr,e,r)}json(e,r){this.parse(t.jsonAttr,e,r)}callback(e,r={}){let parser=(e,n)=>t.callbackAttr(e,n,r);this.parse(parser,e,r)}parse(t,r,n={}){const s=e.wrapList(n.attr??this._attrNameForKey(r));let i=this._options[r];for(let e of s)i??=this._parseFromAttr(t,this._element,e);i??=n.default??this._defaults[r];let o=n.normalize;o&&(i=o(i));e.isDefined(i)&&(this._options[r]=i);let a;if(this._fail&&(a=up.fragment.failKey(r))){const r=e.compact(e.map(s,(e=>this._deriveFailAttrName(e))));this.parse(t,a,{...n,attr:r})}}include(e){let t=e(this._element,this._options,this._parserOptions);Object.assign(this._options,t)}_parseFromAttr(e,r,n){return this._closest?t.closestAttr(r,n,e):e(r,n)}_deriveFailAttrName(e){return this._deriveFailAttrNameForPrefix(e,this._attrPrefix+"on-")||this._deriveFailAttrNameForPrefix(e,this._attrPrefix)}_deriveFailAttrNameForPrefix(e,t){if(e.startsWith(t))return`${t}fail-${e.substring(t.length)}`}_attrNameForKey(t){return`${this._attrPrefix}${e.camelToKebabCase(t)}`}}},()=>{const e=up.util;up.FIFOCache=class FIFOCache{constructor({capacity:t=10,normalizeKey:r=e.identity}={}){this._map=new Map;this._capacity=t;this._normalizeKey=r}get(e){e=this._normalizeKey(e);return this._map.get(e)}set(e,t){if(this._map.size===this._capacity){let e=this._map.keys().next().value;this._map.delete(e)}e=this._normalizeKey(e);this._map.set(e,t)}clear(){this._map.clear()}}},()=>{up.Rect=class Rect extends up.Record{keys(){return["left","top","width","height"]}get bottom(){return this.top+this.height}get right(){return this.left+this.width}grow(e){this.left-=e;this.top-=e;this.width+=e*2;this.height+=e*2}static fromElement(e){return new this(e.getBoundingClientRect())}}},()=>{const e=up.element;const t="up-scrollbar-away";up.BodyShifter=class BodyShifter{constructor(){this._anchoredElements=new Set;this._stack=0;this._cleaners=[]}lowerStack(){--this._stack===0&&this._unshiftNow()}raiseStack(){++this._stack===1&&this._shiftNow()}onAnchoredElementInserted(e){this._anchoredElements.add(e);this._shiftElement(e,"right");return()=>this._anchoredElements.delete(e)}_isShifted(){return this._rootScrollbarWidth&&this._stack>0}_shiftNow(){this._rootScrollbarWidth=up.viewport.rootScrollbarWidth();this._cleaners.push(e.setTemporaryStyle(e.root,{"--up-scrollbar-width":this._rootScrollbarWidth+"px"}));this._shiftElement(document.body,"padding-right");for(let e of this._anchoredElements)this._shiftElement(e,"right")}_shiftElement(r,n){if(!this._isShifted())return;let s=e.style(r,n);this._cleaners.push(e.setTemporaryStyle(r,{["--up-original-"+n]:s}),e.addTemporaryClass(r,t))}_unshiftNow(){let e;while(e=this._cleaners.pop())e()}}},()=>{const e=up.util;up.Change=class Change{constructor(e){this.options=e}execute(){throw new up.NotImplemented}onFinished(e){return this.options.onFinished?.(e)}improveHistoryValue(t,r){return t===false||e.isString(t)?t:r}deriveFailOptions(){return up.RenderOptions.deriveFailOptions(this.options)}}},()=>{const e=up.util;const t=up.element;up.Change.Addition=class Addition extends up.Change{constructor(e){super(e);this._acceptLayer=e.acceptLayer;this._dismissLayer=e.dismissLayer;this._eventPlans=e.eventPlans||[];this._response=e.response}handleLayerChangeRequests(){if(this.layer.isOverlay()){this.tryAcceptLayerFromServer();this.abortWhenLayerClosed();this.layer.tryAcceptForLocation(this.responseOption());this.abortWhenLayerClosed();this.tryDismissLayerFromServer();this.abortWhenLayerClosed();this.layer.tryDismissForLocation(this.responseOption());this.abortWhenLayerClosed()}this.layer.asCurrent((()=>{for(let e of this._eventPlans){up.emit({...e,...this.responseOption()});this.abortWhenLayerClosed()}}))}tryAcceptLayerFromServer(){e.isDefined(this._acceptLayer)&&this.layer.isOverlay()&&this.layer.accept(this._acceptLayer,this.responseOption())}tryDismissLayerFromServer(){e.isDefined(this._dismissLayer)&&this.layer.isOverlay()&&this.layer.dismiss(this._dismissLayer,this.responseOption())}abortWhenLayerClosed(e=this.layer){if(e.isClosed())throw new up.Aborted("Layer was closed")}setSource({oldElement:e,newElement:r,source:n}){n==="keep"&&(n=e&&up.fragment.source(e));n&&t.setMissingAttr(r,"up-source",up.fragment.normalizeSource(n))}setTime({newElement:e,time:r}){t.setMissingAttr(e,"up-time",!!r&&r.toUTCString())}setETag({newElement:e,etag:r}){t.setMissingAttr(e,"up-etag",r||false)}setReloadAttrs(e){this.setSource(e);this.setTime(e);this.setETag(e)}responseOption(){return{response:this._response}}executeSteps(e,t,r){return new up.Change.UpdateSteps({steps:e,noneOptions:r}).execute(t)}}},()=>{var t;const r=up.util;up.RenderJob=(t=class RenderJob{constructor(e){this.options=e}execute(){this._rendered=this._executePromise();return this}async _executePromise(){try{this._guardRender();this.options=up.RenderOptions.preprocess(this.options);let e=await this._getChange().execute();this._handleResult(e);return e}catch(e){this._handleResult(e)||this._handleError(e);throw e}}_handleResult(e){if(e instanceof up.RenderResult){let{onRendered:t,onFinished:n}=e.options;e.none||up.error.guard((()=>t?.(e)));let guardedOnFinished=function(e){up.error.guard((()=>n?.(e)))};this.finished.then(guardedOnFinished,r.noop);return true}}_handleError(e){let t=e instanceof up.Aborted?"Rendering was aborted":"Error while rendering";up.puts("up.render()",`${t}: ${e.name}: ${e.message}`);up.error.guard((()=>this.options.onError?.(e)))}get finished(){return this._awaitFinished()}async _awaitFinished(){try{let e=await this._rendered;return await e.finished}catch(e){throw e instanceof up.RenderResult?await e.finished:e}}_getChange(){if(this.options.url){let onRequest=e=>this._handleAbortOption(e);return new up.Change.FromURL({...this.options,onRequest:onRequest})}if(this.options.response){let onRender=()=>this._handleAbortOption(null);return new up.Change.FromResponse({...this.options,onRender:onRender})}{let onRender=()=>this._handleAbortOption(null);return new up.Change.FromContent({...this.options,onRender:onRender})}}_guardRender(){up.browser.assertConfirmed(this.options);let e=r.pluckKey(this.options,"guardEvent");if(e){e.renderOptions=this.options;if(up.emit(e,{target:this.options.origin}).defaultPrevented)throw new up.Aborted(`Rendering was prevented by ${e.type} listener`)}up.RenderOptions.assertContentGiven(this.options)}_handleAbortOption(e){let{abort:t}=this.options;if(!t||!up.network.isBusy())return;let{fragments:n,layer:s,origin:i,newLayer:o}=this._getChange().getPreflightProps();let a={except:e,logOnce:["up.render()","Change with { abort } option will abort other requests"],newLayer:o,origin:i};t==="target"?up.fragment.abort(n,a):t==="layer"?up.fragment.abort({...a,layer:s}):t==="all"||t===true?up.fragment.abort({...a,layer:"any"}):r.isFunction(t)?t(a):up.fragment.abort(t,{...a,layer:s})}},(()=>{r.delegate(t.prototype,["then","catch","finally"],(function(){return(this||e)._rendered}));r.memoizeMethod(t.prototype,{_awaitFinished:true,_getChange:true})})(),t)},()=>{up.Change.Removal=class Removal extends up.Change{}},()=>{up.Change.DestroyFragment=class DestroyFragment extends up.Change.Removal{constructor(e){super(e);this._layer=up.layer.get(e)||up.layer.current;this._element=this.options.element;this._animation=this.options.animation;this._log=this.options.log}execute(){this._parent=this._element.parentNode;up.fragment.markAsDestroying(this._element);up.motion.willAnimate(this._element,this._animation,this.options)?this._destroyAfterAnimation():this._destroyNow()}async _destroyAfterAnimation(){this._emitDestroyed();await this._animate();this._wipe();this.onFinished()}_destroyNow(){this._wipe();this._emitDestroyed();this.onFinished()}_animate(){return up.motion.animate(this._element,this._animation,this.options)}_wipe(){this._layer.asCurrent((()=>{up.fragment.abort(this._element);up.script.clean(this._element,{layer:this._layer});up.element.cleanJQuery(this._element);this._element.remove()}))}_emitDestroyed(){up.fragment.emitDestroyed(this._element,{parent:this._parent,log:this._log})}}},()=>{let e=up.util;up.Change.OpenLayer=class OpenLayer extends up.Change.Addition{constructor(e){super(e);this.target=e.target;this._origin=e.origin;this._baseLayer=e.baseLayer}getPreflightProps(){return{mode:this.options.mode,context:this._buildLayer().context,origin:this.options.origin,target:this.target,layer:this._baseLayer,fragments:e.compact([up.fragment.get(":main",{layer:this._baseLayer})]),newLayer:true}}execute(e,t){this.responseDoc=e;this._matchPostflight();t();this._createOverlay();let r=this.layer.on("up:layer:accepting up:layer:dimissing",this._renderOtherLayers.bind(this));try{this._renderOverlayContent();this._renderOtherLayers();return up.RenderResult.both(this._newOverlayResult,this._otherLayersResult)}finally{r()}}_matchPostflight(){this.target===":none"?this._content=document.createElement("up-none"):this._content=this.responseDoc.select(this.target);if(!this._content||this._baseLayer.isClosed())throw new up.CannotMatch}_createOverlay(){up.puts("up.render()",`Opening element "${this.target}" in new overlay`);this._assertOpenEventEmitted();this.layer=this._buildLayer();this._baseLayer.peel({history:!this.layer.history});up.layer.stack.push(this.layer);this.layer.createElements();this.layer.setupHandlers()}_renderOverlayContent(){this._handleHistory();this.handleLayerChangeRequests();this.responseDoc.commitElement(this._content);this.layer.setContent(this._content);this.setReloadAttrs({newElement:this._content,source:this.options.source});this.responseDoc.finalizeElement(this._content);this._newOverlayResult=new up.RenderResult({layer:this.layer,fragments:[this._content],target:this.target});up.hello(this.layer.element,{...this.options,layer:this.layer});this._handleScroll();this._newOverlayResult.finished=this._finish();this.layer.opening=false;this._emitOpenedEvent();this.abortWhenLayerClosed()}_renderOtherLayers(){if(this._otherLayersResult)return;let e=this._getHungrySteps().other;this._otherLayersResult=this.executeSteps(e,this.responseDoc)}async _finish(){await this.layer.startOpenAnimation();this.abortWhenLayerClosed();this._handleFocus();return this._newOverlayResult}_buildLayer(){const e={...this.options,opening:true};const beforeNew=e=>this.options=up.RenderOptions.finalize(e);return up.layer.build(e,beforeNew)}_handleHistory(){this.layer.history==="auto"&&(this.layer.history=up.fragment.hasAutoHistory([this._content],this.layer));let{parent:e}=this.layer;this.layer.history&&=e.history;e.saveHistory();this.layer.updateHistory(this.options)}_handleFocus(){this._baseLayer.overlayFocus?.moveToBack();this.layer.overlayFocus.moveToFront();const e=new up.FragmentFocus({fragment:this._content,layer:this.layer,autoMeans:["autofocus","layer"],inputDevice:this.options.inputDevice});e.process(this.options.focus)}_handleScroll(){const e={...this.options,fragment:this._content,layer:this.layer,autoMeans:["hash","layer"]};const t=new up.FragmentScrolling(e);t.process(this.options.scroll)}_assertOpenEventEmitted(){up.event.assertEmitted("up:layer:open",{origin:this._origin,baseLayer:this._baseLayer,layerOptions:this.options,log:"Opening new overlay"})}_emitOpenedEvent(){this.layer.emit("up:layer:opened",{origin:this._origin,callback:this.layer.callback("onOpened"),log:`Opened new ${this.layer}`})}_getHungrySteps(){return up.radio.hungrySteps(this._getEffectiveRenderOptions())}_getEffectiveRenderOptions(){return{...this.options,layer:this.layer,history:this.layer.history}}}},()=>{var e;const t=up.util;up.Change.UpdateLayer=(e=class UpdateLayer extends up.Change.Addition{constructor(e){e=up.RenderOptions.finalize(e);super(e);this.layer=e.layer;this.target=e.target;this._context=e.context;this._steps=up.fragment.parseTargetSteps(this.target,this.options)}getPreflightProps(){this._matchPreflight();return{layer:this.layer,mode:this.layer.mode,context:t.merge(this.layer.context,this._context),origin:this.options.origin,target:this._bestPreflightSelector(),fragments:this._getFragments(),newLayer:false}}_bestPreflightSelector(){this._matchPreflight();return up.fragment.targetForSteps(this._steps)}_getFragments(){this._matchPreflight();return t.map(this._steps,"oldElement")}execute(e,t){this.responseDoc=e;this._matchPostflight();t();let r=this.layer.on("up:layer:accepting up:layer:dimissing",this._renderOtherLayers.bind(this));try{this._renderCurrentLayer();this._renderOtherLayers();return up.RenderResult.both(this._currentLayerResult,this._otherLayersResult)}finally{r()}}_renderCurrentLayer(){this._steps.length&&up.puts("up.render()",`Updating "${this._bestPreflightSelector()}" in ${this.layer}`);this._setScrollAndFocusOptions();this.options.saveScroll&&up.viewport.saveScroll({layer:this.layer});this.options.saveFocus&&up.viewport.saveFocus({layer:this.layer});this.options.peel&&this.layer.peel({history:!this._hasHistory()});this.options.abort!==false&&up.fragment.abort(this._getFragments(),{reason:"Fragment is being replaced"});Object.assign(this.layer.context,this._context);this._hasHistory()&&this.layer.updateHistory(this.options);this.handleLayerChangeRequests();this._currentLayerResult=this.executeSteps(this._steps,this.responseDoc,this.options)}_renderOtherLayers(){if(this._otherLayersResult)return;let e=this._getHungrySteps().other;this._otherLayersResult=this.executeSteps(e,this.responseDoc)}_matchPreflight(){this._matchOldElements();this._compressNestedSteps()}_matchPostflight(){this._matchOldElements();this._addHungryStepsOnCurrentLayer();this._compressNestedSteps();this._matchNewElements()}_addHungryStepsOnCurrentLayer(){this._steps.push(...this._getHungrySteps().current)}_matchOldElements(){this._steps=this._steps.filter((e=>{const r=new up.FragmentFinder(t.pick(e,["selector","origin","layer","match","preferOldElements"]));e.oldElement||=r.find();if(e.oldElement)return true;if(!e.maybe)throw new up.CannotMatch}))}_matchNewElements(){this._steps=this.responseDoc.selectSteps(this._steps)}_compressNestedSteps(){this._steps=up.fragment.compressNestedSteps(this._steps)}_getHungrySteps(){return up.radio.hungrySteps(this._getEffectiveRenderOptions())}_setScrollAndFocusOptions(){let e=up.FocusCapsule.preserve(this.layer);this._steps.forEach(((t,r)=>{t.focusCapsule=e;if(r>0){t.scroll=false;t.focus=false}}))}_hasHistory(){return t.evalAutoOption(this.options.history,this._hasAutoHistory.bind(this))}_hasAutoHistory(){const e=t.map(this._steps,"oldElement");return up.fragment.hasAutoHistory(e,this.layer)}_getEffectiveRenderOptions(){return{...this.options,layer:this.layer,history:this._hasHistory()}}},(()=>{t.memoizeMethod(e.prototype,{_matchPreflight:true,_matchOldElements:true,_hasHistory:true,_getHungrySteps:true})})(),e)},()=>{const e=up.util;const t=up.element;up.Change.UpdateSteps=class UpdateSteps extends up.Change.Addition{constructor(t){super(t);this._noneOptions=t.noneOptions||{};this._steps=e.copy(t.steps)}execute(e){this.responseDoc=e;this._steps=e.selectSteps(this._steps);this._steps=e.commitSteps(this._steps);if(!this._steps.length)return this._executeNone();this.renderResult=new up.RenderResult({layer:this._steps[0]?.layer,target:up.fragment.targetForSteps(this._steps)});this._steps.reverse();const t=this._steps.map((e=>this._executeStep(e)));this.renderResult.finished=this._finish(t);return this.renderResult}_executeNone(){this._handleFocus(null,this._noneOptions);this._handleScroll(null,this._noneOptions);return up.RenderResult.buildNone()}async _finish(e){await Promise.all(e);for(let e of this._steps)this.abortWhenLayerClosed(e.layer);return this.renderResult}_addToResult(e){let t=e.matches("up-wrapper")?e.children:[e];this.renderResult.fragments.unshift(...t)}_executeStep(e){this.setReloadAttrs(e);switch(e.placement){case"swap":{let t=this._findKeepPlan(e);if(t){this._handleFocus(e.oldElement,e);this._handleScroll(e.oldElement,e);return Promise.resolve()}{this._preserveKeepables(e);const t=e.oldElement.parentNode;const r={...e,beforeStart(){up.fragment.markAsDestroying(e.oldElement)},afterInsert:()=>{this._restoreKeepables(e);this.responseDoc.finalizeElement(e.newElement);this._unmarkKeepables(e);up.hello(e.newElement,e);this._addToResult(e.newElement)},beforeDetach:()=>{up.script.clean(e.oldElement,{layer:e.layer})},afterDetach(){up.element.cleanJQuery();up.fragment.emitDestroyed(e.oldElement,{parent:t,log:false})},scrollNew:()=>{this._handleFocus(e.newElement,e);this._handleScroll(e.newElement,e)}};return up.morph(e.oldElement,e.newElement,e.transition,r)}}case"content":{let r=t.wrapChildren(e.oldElement);let n=t.wrapChildren(e.newElement);let s={...e,placement:"swap",oldElement:r,newElement:n,focus:false};return this._executeStep(s).then((()=>{t.unwrap(n);this._handleFocus(e.oldElement,e)}))}case"before":case"after":{let r=t.wrapChildren(e.newElement);let n=e.placement==="before"?"afterbegin":"beforeend";e.oldElement.insertAdjacentElement(n,r);this.responseDoc.finalizeElement(r);up.hello(r,e);this._addToResult(r);this._handleFocus(r,e);this._handleScroll(r,e);return up.animate(r,e.transition,e).then((()=>t.unwrap(r)))}default:up.fail("Unknown placement: %o",e.placement)}}_findKeepPlan(e){if(!e.useKeep)return;const{oldElement:r,newElement:n}=e;let s=t.booleanAttr(r,"up-keep");if(!s)return;let i;let o=up.fragment.toTarget(r);const a={layer:e.layer};i=e.descendantsOnly?up.fragment.get(n,o,a):up.fragment.subtree(n,o,a)[0];if(i&&t.booleanAttr(i,"up-keep")!==false){const t={oldElement:r,newElement:i,newData:up.script.data(i),renderOptions:e};if(!up.fragment.emitKeep(t).defaultPrevented)return t}}_preserveKeepables(e){const t=[];if(e.useKeep)for(let r of e.oldElement.querySelectorAll("[up-keep]")){let n=this._findKeepPlan({...e,oldElement:r,descendantsOnly:true});if(n){const e=r.cloneNode(true);r.insertAdjacentElement("beforebegin",e);r.classList.add("up-keeping");up.script.disableSubtree(n.newElement);let s=up.viewport.subtree(n.oldElement);n.revivers=s.map((function(e){let t=up.viewport.copyCursorProps(e);return()=>up.viewport.copyCursorProps(t,e)}));this._willChangeElement(document.body)?n.newElement.replaceWith(r):document.body.append(r);t.push(n)}}e.keepPlans=t}_restoreKeepables(e){for(let t of e.keepPlans){t.newElement.replaceWith(t.oldElement);for(let e of t.revivers)e()}}_unmarkKeepables(e){for(let t of e.keepPlans)t.oldElement.classList.remove("up-keeping")}_willChangeElement(t){return e.some(this._steps,(e=>e.oldElement.contains(t)))}_handleFocus(e,t){const r=new up.FragmentFocus({...t,fragment:e,autoMeans:up.fragment.config.autoFocus});return r.process(t.focus)}_handleScroll(e,t){const r=new up.FragmentScrolling({...t,fragment:e,autoMeans:up.fragment.config.autoScroll});return r.process(t.scroll)}}},()=>{const e=up.util;up.Change.CloseLayer=class CloseLayer extends up.Change.Removal{constructor(e){super(e);this._verb=e.verb;this._layer=up.layer.get(e);this._origin=e.origin;this._value=e.value;this._preventable=e.preventable??true;this._response=e.response;this._history=e.history??true}execute(){if(!this._layer.isOpen())return Promise.resolve();up.browser.assertConfirmed(this.options);if(this._emitCloseEvent().defaultPrevented&&this._preventable)throw new up.Aborted("Close event was prevented");this._emitClosingEvent();up.fragment.abort({reason:"Layer is closing",layer:this._layer});const{parent:e}=this._layer;this._layer.peel();this._layer.stack.remove(this._layer);this._history&&e.restoreHistory();this._handleFocus(e);this._layer.teardownHandlers();this._layer.destroyElements(this.options);this._emitClosedEvent(e)}_emitCloseEvent(){let t=this._layer.emit(this._buildEvent(`up:layer:${this._verb}`),{callback:this._layer.callback(`on${e.upperCaseFirst(this._verb)}`),log:[`Will ${this._verb} ${this._layer} with value %o`,this._value]});this._value=t.value;return t}_emitClosingEvent(){let e=this._buildEvent(`up:layer:${this._verb}ing`);this._layer.emit(e,{log:false})}_emitClosedEvent(t){const r=`${this._verb}ed`;const n=e.upperCaseFirst(r);return this._layer.emit(this._buildEvent(`up:layer:${r}`),{baseLayer:t,callback:this._layer.callback(`on${n}`),ensureBubbles:true,log:[`${n} ${this._layer} with value %o`,this._value]})}_buildEvent(e){return up.event.build(e,{layer:this._layer,value:this._value,origin:this._origin,response:this._response})}_handleFocus(e){this._layer.overlayFocus.teardown();e.overlayFocus?.moveToFront();let t=this._layer.origin||e.element;up.focus(t,{preventScroll:true})}}},()=>{var e;const t=up.util;up.Change.FromURL=(e=class FromURL extends up.Change{execute(){let e=this._newPageReason();if(e){up.puts("up.render()",e);up.network.loadPage(this.options);return t.unresolvablePromise()}this.request=up.request(this._getRequestAttrs());this.options.onRequest?.(this.request);up.feedback.showAroundRequest(this.request,this.options);up.form.disableWhile(this.request,this.options);return this.options.preload?this.request:t.always(this.request,(e=>this._onRequestSettled(e)))}_newPageReason(){return t.isCrossOrigin(this.options.url)?"Loading cross-origin content in new page":this.options.history&&!up.browser.canPushState()?"Loading content in new page to restore history support":void 0}_getRequestAttrs(){const e=this._preflightPropsForRenderOptions(this.options);const r=this._preflightPropsForRenderOptions(this.deriveFailOptions(),{optional:true});return{...this.options,...e,...t.renameKeys(r,up.fragment.failKey)}}getPreflightProps(){return this._getRequestAttrs()}_preflightPropsForRenderOptions(e,t){const r=new up.Change.FromContent({...e,preview:true});return r.getPreflightProps(t)}_onRequestSettled(e){return e instanceof up.Response?this._onRequestSettledWithResponse(e):this._onRequestSettledWithError(e)}_onRequestSettledWithResponse(e){return new up.Change.FromResponse({...this.options,response:e}).execute()}_onRequestSettledWithError(e){e instanceof up.Offline&&this.request.emit("up:fragment:offline",{callback:this.options.onOffline,renderOptions:this.options,retry:e=>up.render({...this.options,...e}),log:["Cannot load fragment from %s: %s",this.request.description,e.reason]});throw e}},(()=>{t.memoizeMethod(e.prototype,{_getRequestAttrs:true})})(),e)},()=>{var e;const t=up.util;up.Change.FromResponse=(e=class FromResponse extends up.Change{constructor(e){super(e);this._response=e.response;this._request=this._response.request}execute(){up.fragment.config.skipResponse(this._loadedEventProps())?this._skip():this._request.assertEmitted("up:fragment:loaded",{...this._loadedEventProps(),callback:this.options.onLoaded,log:["Loaded fragment from %s",this._response.description],skip:()=>this._skip()});let e=t.evalOption(this.options.fail,this._response)??!this._response.ok;if(e)throw this._updateContentFromResponse(this.deriveFailOptions());return this._updateContentFromResponse(this.options)}_skip(){up.puts("up.render()","Skipping "+this._response.description);this.options.target=":none";this.options.failTarget=":none"}_updateContentFromResponse(e){e.failPrefixForced&&up.puts("up.render()","Rendering failed response using fail-prefixed options (https://unpoly.com/failed-responses)");this._augmentOptionsFromResponse(e);e.meta=this._compilerPassMeta();let t=new up.Change.FromContent(e).execute();t.finished=this.finish(t,e);return t}async finish(e,t){e=await e.finished;up.fragment.shouldRevalidate(this._request,this._response,t)&&(e=await this._revalidate(e,t));return e}async _revalidate(e,t){let r=t.target;let n=e.target;if(/:(before|after)/.test(r))up.warn("up.render()","Cannot revalidate cache when prepending/appending (target %s)",r);else{up.puts("up.render()",'Revalidating cached response for target "%s"',n);let r=await up.reload(n,{...t,preferOldElements:e.fragments,layer:e.layer,onFinished:null,scroll:false,focus:"keep",transition:false,cache:false,confirm:false,feedback:false,abort:false,expiredResponse:this._response});r.none||(e=r)}return e}_loadedEventProps(){const{expiredResponse:e}=this.options;return{request:this._request,response:this._response,renderOptions:this.options,revalidating:!!e,expiredResponse:e}}_compilerPassMeta(){let e={revalidating:!!this.options.expiredResponse};up.migrate.processCompilerPassMeta?.(e,this._response);return e}_augmentOptionsFromResponse(e){const r=this._response.url;let n=r;let s=this._request.hash;if(s){e.hash=s;n+=s}const i=this._response.method==="GET";if(i)e.source=this.improveHistoryValue(e.source,r);else{e.source=this.improveHistoryValue(e.source,"keep");e.history=!!e.location}e.location=this.improveHistoryValue(e.location,n);e.title=this.improveHistoryValue(e.title,this._response.title);e.eventPlans=this._response.eventPlans;let o=this._response.target;o&&(e.target=o);e.acceptLayer=this._response.acceptLayer;e.dismissLayer=this._response.dismissLayer;e.document=this._response.text;this._response.none&&(e.target=":none");e.context=t.merge(e.context,this._response.context);e.cspNonces=this._response.cspNonces;e.time??=this._response.lastModified;e.etag??=this._response.etag}},(()=>{t.memoizeMethod(e.prototype,{_loadedEventProps:true})})(),e)},()=>{var e;const t=up.util;up.Change.FromContent=(e=class FromContent extends up.Change{constructor(e){super(e);this._origin=e.origin;this._preview=e.preview;this._layers=up.layer.getAll(e)}_getPlans(){let e=[];this._filterLayers();this._improveOptionsFromResponseDoc();this._expandIntoPlans(e,this._layers,this.options.target);this._expandIntoPlans(e,this._layers,this.options.fallback);return e}_isRenderableLayer(e){return e==="new"||e.isOpen()}_filterLayers(){this._layers=t.filter(this._layers,this._isRenderableLayer)}_expandIntoPlans(e,t,r){for(let n of t)for(let t of this._expandTargets(r,n)){const r={...this.options,target:t,layer:n,defaultPlacement:this._defaultPlacement()};const s=n==="new"?new up.Change.OpenLayer(r):new up.Change.UpdateLayer(r);e.push(s)}}_expandTargets(e,t){return up.fragment.expandTargets(e,{layer:t,mode:this.options.mode,origin:this._origin})}execute(){return this.options.preload?Promise.resolve():this._seekPlan(this._executePlan.bind(this))||this._cannotMatchPostflightTarget()}_executePlan(e){let t=e.execute(this._getResponseDoc(),this._onPlanApplicable.bind(this,e));t.options=this.options;return t}_isApplicablePlanError(e){return!(e instanceof up.CannotMatch)}_onPlanApplicable(e){let t=this._getPlans()[0];e!==t&&up.puts("up.render()",'Could not match primary target "%s". Updating a fallback target "%s".',t.target,e.target);let{assets:r}=this._getResponseDoc();r&&up.script.assertAssetsOK(r,e.options);this.options.onRender?.()}_getResponseDoc(){if(this._preview)return;const e=t.pick(this.options,["target","content","fragment","document","html","cspNonces","origin"]);up.migrate.handleResponseDocOptions?.(e);this._defaultPlacement()==="content"&&(e.target=this._firstExpandedTarget(e.target));return new up.ResponseDoc(e)}_improveOptionsFromResponseDoc(){if(this._preview)return;let e=this._getResponseDoc();this.options.fragment&&(this.options.target||=e.rootSelector());this.options.title=this.improveHistoryValue(this.options.title,e.title);this.options.metaTags=this.improveHistoryValue(this.options.metaTags,e.metaTags);this.options.lang=this.improveHistoryValue(this.options.lang,e.lang)}_defaultPlacement(){if(!this.options.document&&!this.options.fragment)return"content"}_firstExpandedTarget(e){let t=this._layers[0]||up.layer.root;return this._expandTargets(e||":main",t)[0]}getPreflightProps(e={}){const getPlanProps=e=>e.getPreflightProps();return this._seekPlan(getPlanProps)||e.optional||this._cannotMatchPreflightTarget()}_cannotMatchPreflightTarget(){this._cannotMatchTarget("Could not find target in current page")}_cannotMatchPostflightTarget(){this._cannotMatchTarget("Could not find common target in current page and response")}_cannotMatchTarget(e){if(this._getPlans().length){const r=t.uniq(t.map(this._getPlans(),"target"));const n=up.layer.optionToString(this.options.layer);throw new up.CannotMatch([e+" (tried selectors %o in %s)",r,n])}if(this._layers.length!==0)throw this.options.failPrefixForced?new up.CannotMatch("No target selector given for failed responses (https://unpoly.com/failed-responses)"):new up.CannotMatch("No target selector given");this._cannotMatchLayer()}_cannotMatchLayer(){throw new up.CannotMatch("Could not find a layer to render in. You may have passed an unmatchable layer reference, or a detached element.")}_seekPlan(e){for(let t of this._getPlans())try{return e(t)}catch(e){if(this._isApplicablePlanError(e))throw e}}},(()=>{t.memoizeMethod(e.prototype,{_getPlans:true,_getResponseDoc:true,getPreflightProps:true})})(),e)},()=>{const e=up.util;up.CompilerPass=class CompilerPass{constructor(e,t,{layer:r,data:n,dataMap:s,meta:i}){r||=up.layer.get(e)||up.layer.current;this._root=e;this._compilers=t;this._layer=r;this._data=n;this._dataMap=s;i||={};i.layer=r;this._meta=i}run(){this._layer.asCurrent((()=>{this.setCompileData();for(let e of this._compilers)this._runCompiler(e)}))}setCompileData(){this._data&&(this._root.upCompileData=this._data);if(this._dataMap)for(let e in this._dataMap)for(let t of this._select(e))t.upCompileData=this._dataMap[e]}_runCompiler(e){const t=this._selectOnce(e);if(t.length){e.isDefault||up.puts("up.hello()",'Compiling %dÃ— "%s" on %s',t.length,e.selector,this._layer);if(e.batch)this._compileBatch(e,t);else for(let r of t)this._compileOneElement(e,r);return up.migrate.postCompile?.(t,e)}}_compileOneElement(e,t){const r=[t];if(e.length!==1){const e=up.script.data(t);r.push(e,this._meta)}const n=this._applyCompilerFunction(e,t,r);let s=this._destructorPresence(n);s&&up.destructor(t,s)}_compileBatch(t,r){const n=[r];if(t.length!==1){const t=e.map(r,up.script.data);n.push(t,this._meta)}const s=this._applyCompilerFunction(t,r,n);this._destructorPresence(s)&&up.fail("Compilers with { batch: true } cannot return destructors")}_applyCompilerFunction(e,t,r){return up.error.guard((()=>e.apply(t,r)))}_destructorPresence(t){if(e.isFunction(t)||e.isArray(t)&&e.every(t,e.isFunction))return t}_select(t){return up.fragment.subtree(this._root,e.evalOption(t),{layer:this._layer})}_selectOnce(t){let r=this._select(t.selector);return e.filter(r,(e=>{let r=e.upAppliedCompilers||=new Set;if(!r.has(t)){r.add(t);return true}}))}}},()=>{const e=up.util;const t=up.element;up.CSSTransition=class CSSTransition{constructor(e,t,r){this._element=e;this._lastFrame=t;this._lastFrameKeys=Object.keys(this._lastFrame);this._finishEvent=r.finishEvent;this._duration=r.duration;this._easing=r.easing;this._finished=false}start(){if(this._lastFrameKeys.length===0){this._finished=true;return Promise.resolve()}this._deferred=e.newDeferred();this._pauseOldTransition();this._startTime=new Date;this._startFallbackTimer();this._listenToFinishEvent();this._listenToTransitionEnd();this._startMotion();return this._deferred}_listenToFinishEvent(){this._finishEvent&&(this._stopListenToFinishEvent=up.on(this._element,this._finishEvent,this._onFinishEvent.bind(this)))}_onFinishEvent(e){e.stopPropagation();this._finish()}_startFallbackTimer(){const t=100;this._fallbackTimer=e.timer(this._duration+t,(()=>this._finish()))}_stopFallbackTimer(){clearTimeout(this._fallbackTimer)}_listenToTransitionEnd(){this._stopListenToTransitionEnd=up.on(this._element,"transitionend",this._onTransitionEnd.bind(this))}_onTransitionEnd(t){if(t.target!==this._element)return;const r=new Date-this._startTime;if(r<=.25*this._duration)return;const n=t.propertyName;e.contains(this._lastFrameKeys,n)&&this._finish()}_finish(){if(!this._finished){this._finished=true;this._stopFallbackTimer();this._stopListenToFinishEvent?.();this._stopListenToTransitionEnd?.();t.concludeCSSTransition(this._element);this._resumeOldTransition();this._deferred.resolve()}}_pauseOldTransition(){const e=t.style(this._element,["transition-property","transition-duration","transition-delay","transition-timing-function"]);if(t.hasCSSTransition(e)){if(e["transition-property"]!=="all"){const r=e["transition-property"].split(/\s*,\s*/);const n=t.style(this._element,r);this._setOldTransitionTargetFrame=t.setTemporaryStyle(this._element,n)}this._setOldTransition=t.concludeCSSTransition(this._element)}}_resumeOldTransition(){this._setOldTransitionTargetFrame?.();this._setOldTransition?.()}_startMotion(){t.setStyle(this._element,{"transition-property":this._lastFrameKeys.join(),"transition-duration":`${this._duration}ms`,"transition-timing-function":this._easing});t.setStyle(this._element,this._lastFrame)}}},()=>{const e=up.util;up.DestructorPass=class DestructorPass{constructor(e,t){this._fragment=e;this._options=t}run(){for(let t of this._selectCleanables()){let r=e.pluckKey(t,"upDestructors");if(r)for(let e of r)this._applyDestructorFunction(e,t);t.classList.remove("up-can-clean")}}_selectCleanables(){const e={...this._options,destroying:true};return up.fragment.subtree(this._fragment,".up-can-clean",e)}_applyDestructorFunction(e,t){up.error.guard((()=>e(t)))}}},()=>{const e=up.util;const t=up.element;up.EventEmitter=class EventEmitter extends up.Record{keys(){return["target","event","baseLayer","callback","log","ensureBubbles"]}emit(){this._logEmission();this.baseLayer?this.baseLayer.asCurrent((()=>this._dispatchEvent())):this._dispatchEvent();return this.event}_dispatchEvent(){this.target.dispatchEvent(this.event);this.ensureBubbles&&!this.target.isConnected&&document.dispatchEvent(this.event);up.error.guard((()=>this.callback?.(this.event)))}assertEmitted(){const e=this.emit();if(e.defaultPrevented)throw new up.Aborted(`Event ${e.type} was prevented`)}_logEmission(){if(!up.log.config.enabled)return;let t=this.log;let r;e.isArray(t)?[t,...r]=t:r=[];const{type:n}=this.event;e.isString(t)?up.puts(n,t,...r):t!==false&&up.puts(n,`Event ${n}`)}static fromEmitArgs(r,n={}){let s=e.extractOptions(r);s=e.merge(n,s);e.isElementish(r[0])?s.target=t.get(r.shift()):r[0]instanceof up.Layer&&(s.layer=r.shift());let i;if(e.isGiven(s.layer)){i=up.layer.get(s.layer);s.target||=i.element;s.baseLayer||=i}s.baseLayer&&(s.baseLayer=up.layer.get(s.baseLayer));e.isString(s.target)?s.target=up.fragment.get(s.target,{layer:s.layer}):s.target||(s.target=document);if(r[0]?.preventDefault){s.event=r[0];s.log??=r[0].log}else e.isString(r[0])?s.event=up.event.build(r[0],s):s.event=up.event.build(s);return new this(s)}}},()=>{const e=up.util;up.EventListener=class EventListener extends up.Record{keys(){return["element","eventType","selector","callback","guard","baseLayer","passive","once","capture","beforeBoot"]}constructor(e){super(e);this._key=this.constructor._buildKey(e);this.isDefault=up.framework.evaling;this.beforeBoot??=this.eventType.indexOf("up:framework:")===0;this.nativeCallback=this.nativeCallback.bind(this)}bind(){const e=this.element.upEventListeners||={};e[this._key]&&up.fail("up.on(): The %o callback %o cannot be registered more than once",this.eventType,this.callback);e[this._key]=this;this.element.addEventListener(...this._addListenerArg())}_addListenerArg(){let t=e.compactObject(e.pick(this,["once","passive","capture"]));return[this.eventType,this.nativeCallback,t]}unbind(){let e=this.element.upEventListeners;e&&delete e[this._key];this.element.removeEventListener(...this._addListenerArg())}nativeCallback(t){if(up.framework.beforeBoot&&!this.beforeBoot)return;let r=t.target;this.selector&&(r=r.closest(e.evalOption(this.selector)));if((!this.guard||this.guard(t))&&r){const e=[t,r];const n=this.callback.length;if(n!==1&&n!==2){const t=up.script.data(r);e.push(t)}if(this.eventType==="click"&&r.disabled)return;const s=this.callback.bind(r,...e);this.baseLayer?this.baseLayer.asCurrent(s):s()}}static fromElement(e){let t=e.element.upEventListeners;if(t){const r=this._buildKey(e);return t[r]}}static _buildKey(t){t.callback.upUid||=e.uid();return[t.eventType,t.selector,t.callback.upUid].join("|")}static allNonDefault(t){let r=t.upEventListeners;if(r){const t=Object.values(r);return e.reject(t,"isDefault")}return[]}}},()=>{const e=up.util;up.EventListenerGroup=class EventListenerGroup extends up.Record{keys(){return["elements","eventTypes","selector","callback","guard","baseLayer","passive","once","capture","beforeBoot"]}bind(){const t=[];this._eachListenerAttributes((function(e){const r=new up.EventListener(e);r.bind();return t.push(r.unbind.bind(r))}));return e.sequence(t)}_eachListenerAttributes(e){for(let t of this.elements)for(let r of this.eventTypes)e(this._listenerAttributes(t,r))}_listenerAttributes(e,t){return{...this.attributes(),element:e,eventType:t}}unbind(){this._eachListenerAttributes((function(e){let t=up.EventListener.fromElement(e);t&&t.unbind()}))}static fromBindArgs(t,r){t=e.copy(t);const n=t.pop();let s;s=t[0].addEventListener?[t.shift()]:e.isJQuery(t[0])||e.isList(t[0])&&t[0][0].addEventListener?t.shift():[document];let i=e.parseTokens(t.shift());let o=up.migrate.fixEventTypes;o&&(i=o(i));const a=e.extractOptions(t);const u=t[0];const l={elements:s,eventTypes:i,selector:u,callback:n,...a,...r};return new this(l)}}},()=>{const e=up.util;up.FieldWatcher=class FieldWatcher{constructor(e,t,r){this._options=t;this._root=e;this._scope=up.form.getScope(e);this._callback=r;this._batch=t.batch;this._abortable=t.abortable}start(){this._scheduledValues=null;this._processedValues=this._readFieldValues();this._currentTimer=null;this._callbackRunning=false;this._unbindFns=[];this._watchFieldsWithin(this._root);this._root.addEventListener("up:fragment:inserted",(({target:e})=>{e!==this._root&&this._watchFieldsWithin(e)}));this._unbindFns.push(up.fragment.onAborted(this._scope,(()=>this._abort())));this._unbindFns.push(up.on(this._scope,"reset",(()=>this._onFormReset())))}stop(){this._abort();for(let e of this._unbindFns)e()}_fieldOptions(t){let r=e.copy(this._options);return up.form.watchOptions(t,r,{defaults:{event:"input"}})}_watchFieldsWithin(e){for(let t of up.form.fields(e))this._watchField(t)}_watchField(e){let t=this._fieldOptions(e);this._unbindFns.push(up.on(e,t.event,(()=>this._check(t))))}_abort(){this._scheduledValues=null}_scheduleValues(t,r){this._scheduledValues=t;this._scheduledFieldOptions=r;let n=r.delay||0;clearTimeout(this._currentTimer);this._currentTimer=e.timer(n,(()=>{this._currentTimer=null;this._requestCallback()}))}_isNewValues(t){return!e.isEqual(t,this._processedValues)&&!e.isEqual(this._scheduledValues,t)}async _requestCallback(){if(!this._scheduledValues)return;if(this._callbackRunning)return;if(this._currentTimer)return;if(!this._scope.isConnected)return;let t=this._scheduledFieldOptions;const r=this._changedValues(this._processedValues,this._scheduledValues);this._processedValues=this._scheduledValues;this._scheduledValues=null;this._callbackRunning=true;this._scheduledFieldOptions=null;let n={...t,disable:false};const s=[];if(this._batch)s.push(this._runCallback(r,n));else for(let e in r){const t=r[e];s.push(this._runCallback(t,e,n))}if(e.some(s,e.isPromise)){let e=Promise.allSettled(s);up.form.disableWhile(e,t);await e}this._callbackRunning=false;this._requestCallback()}_runCallback(...e){return up.error.guard((()=>this._callback(...e)))}_changedValues(t,r){const n={};let s=Object.keys(t);s=s.concat(Object.keys(r));s=e.uniq(s);for(let i of s){const s=t[i];const o=r[i];e.isEqual(s,o)||(n[i]=o)}return n}_readFieldValues(){return up.Params.fromContainer(this._root).toObject()}_check(e={}){const t=this._readFieldValues();this._isNewValues(t)&&this._scheduleValues(t,e)}_onFormReset(){e.task((()=>this._check()))}}},()=>{const e=up.util;const t=up.element;up.FormValidator=class FormValidator{constructor(e){this._form=e;this._dirtySolutions=[];this._nextRenderTimer=null;this._rendering=false;this._resetNextRenderPromise();this._honorAbort()}_honorAbort(){up.fragment.onAborted(this._form,(e=>this._onAborted(e)))}_onAborted(e){if(this._dirtySolutions.length){this._dirtySolutions=[];this._nextRenderPromise.reject(new up.Aborted(e.reason));this._resetNextRenderPromise()}}_resetNextRenderPromise(){this._nextRenderPromise=e.newDeferred()}watchContainer(e){let{event:t}=this._originOptions(e);let guard=()=>up.fragment.isAlive(e);let callback=()=>up.error.muteUncriticalRejection(this.validate({origin:e}));up.on(e,t,{guard:guard},callback)}validate(e={}){let t=this._getSolutions(e);this._dirtySolutions.push(...t);this._scheduleNextRender();return this._nextRenderPromise}_getSolutions(e){let t=this._getTargetSelectorSolutions(e)||this._getFieldSolutions(e)||this._getElementSolutions(e.origin);for(let r of t){r.renderOptions=this._originOptions(r.origin,e);r.target=up.fragment.resolveOrigin(r.target,r)}return t}_getFieldSolutions({origin:e,...t}){if(up.form.isField(e))return this._getValidateAttrSolutions(e)||this._getFormGroupSolutions(e,t)}_getFormGroupSolutions(e,{formGroup:t=true}){if(!t)return;let r=up.form.groupSolution(e);if(r){up.puts("up.validate()","Validating form group of field %o",e);return[r]}}_getTargetSelectorSolutions({target:t,origin:r}){if(e.isString(t)){up.puts("up.validate()",'Validating target "%s"',t);let n=up.fragment.splitTarget(t);return e.compact(n.map((function(e){let t=up.fragment.get(e,{origin:r});if(t)return{element:t,target:e,origin:r};up.fail('Validation target "%s" does not match an element',e)})))}}_getElementSolutions(e){up.puts("up.validate()","Validating element %o",e);return[{element:e,target:up.fragment.toTarget(e),origin:e}]}_getValidateAttrSolutions(e){let r=e.closest("[up-validate]");if(r){let n=t.booleanOrStringAttr(r,"up-validate");return this._getTargetSelectorSolutions({target:n,origin:e})}}_originOptions(e,t){return up.form.watchOptions(e,t,{defaults:{event:"change"}})}_scheduleNextRender(){let t=this._dirtySolutions.map((e=>e.renderOptions.delay));let r=Math.min(...t)||0;clearTimeout(this._nextRenderTimer);this._nextRenderTimer=e.timer(r,(()=>{this._nextRenderTimer=null;this._renderDirtySolutions()}))}_renderDirtySolutions(){up.error.muteUncriticalRejection(this._doRenderDirtySolutions())}async _doRenderDirtySolutions(){if(!this._dirtySolutions.length)return;if(this._rendering)return;if(this._nextRenderTimer)return;let t=this._dirtySolutions;this._dirtySolutions=[];let r=e.map(t,"origin");let n=e.flatMap(r,up.form.fields);let s=e.uniq(e.map(n,"name"));let i=this._buildDataMap(t);let o=e.map(t,"renderOptions");let a=e.mergeDefined(...o,{dataMap:i},up.form.destinationOptions(this._form));a.target=e.map(t,"target").join(", ");a.feedback=e.some(o,"feedback");a.origin=this._form;a.focus??="keep";a.failOptions=false;a.defaultMaybe=true;a.params=up.Params.merge(a.params,...e.map(o,"params"));a.headers=e.merge(...e.map(o,"headers"));this._addValidateHeader(a.headers,s);a.guardEvent=up.event.build("up:form:validate",{fields:n,log:"Validating form",params:a.params,form:this._form});this._rendering=true;let u=this._nextRenderPromise;this._resetNextRenderPromise();a.disable=false;for(let e of t)up.form.disableWhile(u,{disable:e.renderOptions.disable,origin:e.origin});try{u.resolve(up.render(a));await u}finally{this._rendering=false;this._renderDirtySolutions()}}_addValidateHeader(e,t){let r=up.protocol.headerize("validate");let n=t.join(" ");(!n||n.length>up.protocol.config.maxHeaderSize)&&(n=":unknown");e[r]=n}_buildDataMap(t){let r={};for(let n of t){let t=e.pluckKey(n.renderOptions,"data");let s=e.pluckKey(n.renderOptions,"keepData");s&&(t=up.data(n.element));t&&(r[n.target]=t)}return r}static forElement(e){let t=up.form.get(e);return t.upFormValidator||=new this(t)}}},()=>{up.FocusCapsule=class FocusCapsule{constructor(e,t){this._target=e;this._cursorProps=t}restore(e,t){let r=up.fragment.get(this._target,{layer:e});if(r){up.viewport.copyCursorProps(this._cursorProps,r);up.focus(r,t);return true}}static preserve(e){let t=up.viewport.focusedElementWithin(e.element);if(!t)return;let r=up.fragment.tryToTarget(t);if(!r)return;const n=up.viewport.copyCursorProps(t);return new this(r,n)}}},()=>{const e=up.util;up.FragmentProcessor=class FragmentProcessor extends up.Record{keys(){return["fragment","autoMeans","origin","layer"]}process(e){let t=this.preprocess(e);return this.tryProcess(t)}preprocess(t){return e.parseTokens(t,{separator:"or"})}tryProcess(t){if(e.isArray(t))return this.processArray(t);if(e.isFunction(t)){let e=up.error.guard((()=>t(this.fragment,this.attributes())));return this.tryProcess(e)}if(e.isElement(t))return this.processElement(t);if(e.isString(t)){if(t==="auto")return this.tryProcess(this.autoMeans);let e=t.match(/^(.+?)-if-(.+?)$/);if(e)return this.resolveCondition(e[2])&&this.process(e[1])}return this.processPrimitive(t)}processArray(t){return e.find(t,(e=>this.tryProcess(e)))}resolveCondition(e){if(e==="main")return this.fragment&&up.fragment.contains(this.fragment,":main")}findSelector(e){const t={layer:this.layer,origin:this.origin};let r=this.fragment&&up.fragment.get(this.fragment,e,t);let n=r||up.fragment.get(e,t);if(n)return n;up.warn("up.render()",'Could not find an element matching "%s"',e)}}},()=>{const e=up.util;const t=/^([^ >+(]+) (.+)$/;up.FragmentFinder=class FragmentFinder{constructor(e){this._options=e;this._origin=e.origin;this._selector=e.selector;this._document=e.document||window.document;this._match=e.match??up.fragment.config.match;this._preferOldElements=e.preferOldElements}find(){return this._findInPreferredElements()||this._findInRegion()||this._findFirst()}_findInPreferredElements(){if(this._preferOldElements)return this._preferOldElements.find((e=>this._document.contains(e)&&up.fragment.matches(e,this._selector)))}_findInRegion(){if(this._match==="region"&&!up.fragment.containsMainPseudo(this._selector)&&this._origin?.isConnected)return this._findClosest()||this._findDescendantInRegion()}_findClosest(){return up.fragment.closest(this._origin,this._selector,this._options)}_findDescendantInRegion(){let r=up.fragment.splitTarget(this._selector);return e.findResult(r,(e=>{let r=e.match(t);if(r){let e=up.fragment.closest(this._origin,r[1],this._options);if(e)return up.fragment.getDumb(e,r[2])}}))}_findFirst(){return up.fragment.getDumb(this._document,this._selector,this._options)}}},()=>{const e=up.util;const t=up.element;const r={preventScroll:true};up.FragmentFocus=class FragmentFocus extends up.FragmentProcessor{keys(){return super.keys().concat(["hash","focusCapsule","inputDevice"])}processPrimitive(t){switch(t){case"keep":return this._restoreLostFocus();case"restore":return this._restorePreviousFocusForLocation();case"target":case true:return this._focusElement(this.fragment);case"layer":return this._focusElement(this.layer.getFocusElement());case"main":return this._focusSelector(":main");case"hash":return this._focusHash();case"autofocus":return this._autofocus();default:if(e.isString(t))return this._focusSelector(t)}}processElement(e){return this._focusElement(e)}resolveCondition(e){return e==="lost"?this._wasFocusLost():super.resolveCondition(e)}_focusSelector(e){let t=this.findSelector(e);return this._focusElement(t)}_restoreLostFocus(){if(this._wasFocusLost())return this.focusCapsule?.restore(this.layer,r)}_restorePreviousFocusForLocation(){return up.viewport.restoreFocus({layer:this.layer})}_autofocus(){let e=this.fragment&&t.subtree(this.fragment,"[autofocus]")[0];if(e)return this._focusElement(e)}_focusElement(e){if(e){up.focus(e,{force:true,...r,inputDevice:this.inputDevice});return true}}_focusHash(){let e=up.viewport.firstHashTarget(this.hash,{layer:this.layer});if(e)return this._focusElement(e)}_wasFocusLost(){return!this.layer.hasFocus()}}},()=>{const e=up.element;up.FragmentPolling=class FragmentPolling{constructor(e){this._options=up.radio.pollOptions(e);this._fragment=e;up.destructor(e,this._onFragmentDestroyed.bind(this));up.fragment.onAborted(e,this._onFragmentAborted.bind(this));this._state="initialized";this._abortable=true;this._loading=false;this._satisfyInterval()}static forFragment(e){return e.upPolling||=new this(e)}onPollAttributeObserved(){this._start()}_onFragmentDestroyed(){this._stop()}_start(e){Object.assign(this._options,e);if(this._state!=="started"){if(!up.fragment.isTargetable(this._fragment)){up.warn("[up-poll]","Cannot poll untargetable fragment %o",this._fragment);return}this._state="started";this._ensureEventsBound();this._scheduleRemainingTime()}}_stop(){if(this._state==="started"){this._clearReloadTimer();this._state="stopped";this.unbindEvents?.()}}forceStart(e){Object.assign(this._options,e);this.forceStarted=true;this._start()}forceStop(){this._stop();this.forceStarted=false}_ensureEventsBound(){this.unbindEvents||(this.unbindEvents=up.on("visibilitychange up:layer:opened up:layer:dismissed up:layer:accepted",this._onVisibilityChange.bind(this)))}_onVisibilityChange(){this._isFragmentVisible()&&this._scheduleRemainingTime()}_isFragmentVisible(){return!document.hidden&&(this._options.ifLayer==="any"||this._isOnFrontLayer())}_clearReloadTimer(){clearTimeout(this.reloadTimer);this.reloadTimer=null}_scheduleRemainingTime(){if(!this.reloadTimer&&!this._loading){this._clearReloadTimer();this.reloadTimer=setTimeout(this._onTimerReached.bind(this),this._getRemainingDelay())}}_onTimerReached(){this.reloadTimer=null;this._tryReload()}_tryReload(){this._state==="started"&&(this._isFragmentVisible()?this._reloadNow():up.puts("[up-poll]","Will not poll hidden fragment"))}_getFullDelay(){return this._options.interval??e.numberAttr(this._fragment,"up-interval")??up.radio.config.pollInterval}_getRemainingDelay(){return Math.max(this._getFullDelay()-this._getFragmentAge(),0)}_getFragmentAge(){return new Date-this._lastAttempt}_isOnFrontLayer(){this.layer||=up.layer.get(this._fragment);return this.layer?.isFront?.()}_reloadNow(){this._clearReloadTimer();let e=this._abortable;try{this._abortable=false;this._loading=true;up.reload(this._fragment,this._reloadOptions()).then(this._onReloadSuccess.bind(this),this._onReloadFailure.bind(this))}finally{this._abortable=e}}_reloadOptions(){let e=up.event.build("up:fragment:poll",{log:["Polling fragment",this._fragment]});return{...this._options,guardEvent:e}}_onFragmentAborted({newLayer:e}){this._abortable&&!e&&this._stop()}_onReloadSuccess({fragment:e}){this._loading=false;this._satisfyInterval();e?this._onFragmentSwapped(e):this._scheduleRemainingTime()}_onFragmentSwapped(e){this._stop();this.forceStarted&&up.fragment.matches(this._fragment,e)&&this.constructor.forFragment(e).forceStart(this._options)}_onReloadFailure(e){this._loading=false;this._satisfyInterval();this._scheduleRemainingTime();up.error.throwCritical(e)}_satisfyInterval(){this._lastAttempt=new Date}}},()=>{const e=up.util;up.FragmentScrolling=class FragmentScrolling extends up.FragmentProcessor{keys(){return super.keys().concat(["hash","mode","revealTop","revealMax","revealSnap","scrollBehavior"])}processPrimitive(t){switch(t){case"reset":return this._reset();case"layer":return this._revealLayer();case"main":return this._revealSelector(":main");case"restore":return this._restore();case"hash":return this.hash&&up.viewport.revealHash(this.hash,this.attributes());case"target":case"reveal":case true:return this._revealElement(this.fragment);default:if(e.isString(t))return this._revealSelector(t)}}processElement(e){return this._revealElement(e)}_revealElement(e){if(e){up.reveal(e,this.attributes());return true}}_revealSelector(e){let t=this.findSelector(e);return this._revealElement(t)}_revealLayer(){return this._revealElement(this.layer.getBoxElement())}_reset(){up.viewport.resetScroll({...this.attributes(),around:this.fragment});return true}_restore(){return up.viewport.restoreScroll({...this.attributes(),around:this.fragment})}}},()=>{const e=up.element;const t=up.util;up.Layer=class Layer extends up.Record{keys(){return["element","stack","history","mode","context","lastScrollTops","lastFocusCapsules"]}defaults(){return{context:{},lastScrollTops:up.viewport.newStateCache(),lastFocusCapsules:up.viewport.newStateCache()}}constructor(e={}){super(e);if(!this.mode)throw"missing { mode } option"}setupHandlers(){up.link.convertClicks(this)}teardownHandlers(){}mainTargets(){return up.layer.mainTargets(this.mode)}sync(){}accept(){throw new up.NotImplemented}dismiss(){throw new up.NotImplemented}peel(e){this.stack.peel(this,e)}evalOption(e){return t.evalOption(e,this)}isCurrent(){return this.stack.isCurrent(this)}isFront(){return this.stack.isFront(this)}isRoot(){return this.stack.isRoot(this)}isOverlay(){return this.stack.isOverlay(this)}isOpen(){return this.stack.isOpen(this)}isClosed(){return this.stack.isClosed(this)}get parent(){return this.stack.parentOf(this)}get child(){return this.stack.childOf(this)}get ancestors(){return this.stack.ancestorsOf(this)}get descendants(){return this.stack.descendantsOf(this)}get subtree(){return[this,...this.descendants]}get index(){return this._index??=this.stack.indexOf(this)}getContentElement(){return this.contentElement||this.element}getBoxElement(){return this.boxElement||this.element}getFocusElement(){return this.getBoxElement()}getFirstSwappableElement(){throw new up.NotImplemented}contains(e){return e.closest(up.layer.anySelector())===this.element}on(...e){return this._buildEventListenerGroup(e).bind()}off(...e){return this._buildEventListenerGroup(e).unbind()}_buildEventListenerGroup(e){return up.EventListenerGroup.fromBindArgs(e,{guard:e=>this._containsEventTarget(e),elements:[this.element],baseLayer:this})}_containsEventTarget(e){return this.contains(e.target)}wasHitByMouseEvent({clientX:e,clientY:t}){const r=document.elementFromPoint(e,t);return!r||this.contains(r)}_buildEventEmitter(e){return up.EventEmitter.fromEmitArgs(e,{layer:this})}emit(...e){return this._buildEventEmitter(e).emit()}isDetached(){return!this.element.isConnected}saveHistory(){if(this.history){this.savedTitle=document.title;this.savedMetaTags=up.history.findMetaTags();this.savedLocation=up.history.location;this.savedLang=up.history.getLang()}}restoreHistory(){if(this.showsLiveHistory()){this.savedLocation&&up.history.push(this.savedLocation);this.savedTitle&&(document.title=this.savedTitle);this.savedMetaTags&&up.history.updateMetaTags(this.savedMetaTags);t.isString(this.savedLang)&&up.history.updateLang(this.savedLang)}}asCurrent(e){return this.stack.asCurrent(this,e)}updateHistory(e){t.isString(e.location)&&(this.location=e.location);if(up.history.config.updateMetaTags&&t.isList(e.metaTags)){up.migrate?.warnOfHungryMetaTags?.(e.metaTags);this.metaTags=e.metaTags}t.isString(e.title)&&(this.title=e.title);t.isString(e.lang)&&(this.lang=e.lang)}showsLiveHistory(){return this.history&&this.isFront()}get title(){return this.showsLiveHistory()?document.title:this.savedTitle}set title(e){this.savedTitle=e;this.showsLiveHistory()&&(document.title=e)}get metaTags(){return this.showsLiveHistory()?up.history.findMetaTags():this.savedMetaTags}set metaTags(e){this.savedMetaTags=e;this.showsLiveHistory()&&up.history.updateMetaTags(e)}get lang(){return this.showsLiveHistory()?up.history.getLang():this.savedLang}set lang(e){this.savedLang=e;this.showsLiveHistory()&&up.history.updateLang(e)}get location(){return this.showsLiveHistory()?up.history.location:this.savedLocation}set location(e){const r=this.location;e=t.normalizeURL(e);if(r!==e||this.opening){this.savedLocation=e;this.showsLiveHistory()&&up.history.push(e);this.opening||this.emit("up:layer:location:changed",{location:e})}}selector(e){return this.constructor.selector(e)}static selector(e){throw new up.NotImplemented}toString(){throw new up.NotImplemented}affix(...t){return e.affix(this.getFirstSwappableElement(),...t)}[t.isEqual.key](e){return this.constructor===e.constructor&&this.element===e.element}hasFocus(){let e=document.activeElement;return e!==document.body&&this.element.contains(e)}reset(){Object.assign(this,this.defaults())}}},()=>{const e=up.element;const t=up.util;up.Layer.Overlay=class Overlay extends up.Layer{keys(){return super.keys().concat(["position","align","size","origin","class","backdrop","openAnimation","closeAnimation","openDuration","closeDuration","openEasing","closeEasing","backdropOpenAnimation","backdropCloseAnimation","dismissable","dismissLabel","dismissAriaLabel","onOpened","onAccept","onAccepted","onDismiss","onDismissed","acceptEvent","dismissEvent","acceptLocation","dismissLocation","opening"])}constructor(e){super(e);this.dismissable===true?this.dismissable=["button","key","outside"]:this.dismissable===false?this.dismissable=[]:this.dismissable=t.parseTokens(this.dismissable);this.acceptLocation&&(this.acceptLocation=new up.URLPattern(this.acceptLocation));this.dismissLocation&&(this.dismissLocation=new up.URLPattern(this.dismissLocation))}callback(e){let t=this[e];if(t)return t.bind(this)}createElement(e){this.nesting||=this._suggestVisualNesting();const r=t.compactObject(t.pick(this,["align","position","size","class","nesting"]));this.element=this.affixPart(e,null,r)}createBackdropElement(e){this.backdropElement=this.affixPart(e,"backdrop")}createViewportElement(e){this.viewportElement=this.affixPart(e,"viewport",{"up-viewport":""})}createBoxElement(e){this.boxElement=this.affixPart(e,"box")}createContentElement(e){this.contentElement=this.affixPart(e,"content")}setContent(e){this.contentElement.append(e);this.onContentSet()}onContentSet(){}createDismissElement(t){this.dismissElement=this.affixPart(t,"dismiss",{"up-dismiss":'":button"',"aria-label":this.dismissAriaLabel});return e.affix(this.dismissElement,'span[aria-hidden="true"]',{text:this.dismissLabel})}affixPart(t,r,n={}){return e.affix(t,this.selector(r),n)}static selector(e){return t.compact(["up",this.mode,e]).join("-")}_suggestVisualNesting(){const{parent:e}=this;return this.mode===e.mode?1+e._suggestVisualNesting():0}setupHandlers(){super.setupHandlers();this.overlayFocus=new up.OverlayFocus(this);this._supportsDismissMethod("button")&&this.createDismissElement(this.getBoxElement());this._supportsDismissMethod("outside")&&(this.viewportElement?up.on(this.viewportElement,"up:click",(e=>{e.target===this.viewportElement&&this._onOutsideClicked(e,true)})):this.unbindParentClicked=this.parent.on("up:click",((e,t)=>{if(!up.layer.isWithinForeignOverlay(t)){const r=this.origin&&this.origin.contains(t);this._onOutsideClicked(e,r)}})));this._supportsDismissMethod("key")&&(this.unbindEscapePressed=up.event.onEscape((e=>this.onEscapePressed(e))));this.registerClickCloser("up-accept",((e,t)=>{this.accept(e,t)}));this.registerClickCloser("up-dismiss",((e,t)=>{this.dismiss(e,t)}));up.migrate.registerLayerCloser?.(this);this._registerEventCloser(this.acceptEvent,this.accept);this._registerEventCloser(this.dismissEvent,this.dismiss);this.on("up:click","label[for]",((e,t)=>this._onLabelClicked(e,t)))}_onLabelClicked(t,r){let n=r.getAttribute("for");let s=up.form.fieldSelector(e.idSelector(n));let i=up.fragment.all(s,{layer:"any"});let o=up.fragment.all(s,{layer:this});if(i.length>1&&o[0]!==i[0]){t.preventDefault();const e=o[0];e.focus();e.matches("input[type=checkbox], input[type=radio]")&&e.click()}}_onOutsideClicked(e,t){up.log.putsEvent(e);t&&up.event.halt(e);up.error.muteUncriticalSync((()=>this.dismiss(":outside",{origin:e.target})))}onEscapePressed(e){if(this.isFront()){let t=up.form.focusedField();if(t)t.blur();else if(this._supportsDismissMethod("key")){up.event.halt(e,{log:true});up.error.muteUncriticalSync((()=>this.dismiss(":key")))}}}registerClickCloser(t,r){let n=`[${t}]`;this.on("up:click",n,(function(s){up.event.halt(s,{log:true});const i=s.target.closest(n);const o=e.jsonAttr(i,t);const a={origin:i};const u=new up.OptionsParser(i,a);u.booleanOrString("animation");u.string("easing");u.number("duration");u.string("confirm");up.error.muteUncriticalSync((()=>r(o,a)))}))}_registerEventCloser(e,t){if(e)return this.on(e,(e=>{e.preventDefault();up.error.muteUncriticalSync((()=>t.call(this,e,{response:e.response})))}))}tryAcceptForLocation(e){this._tryCloseForLocation(this.acceptLocation,this.accept,e)}tryDismissForLocation(e){this._tryCloseForLocation(this.dismissLocation,this.dismiss,e)}_tryCloseForLocation(e,t,r){let n,s;if(e&&(n=this.location)&&(s=e.recognize(n))){const e={...s,location:n};up.error.muteUncriticalSync((()=>t.call(this,e,r)))}}teardownHandlers(){super.teardownHandlers();this.unbindParentClicked?.();this.unbindEscapePressed?.();this.overlayFocus.teardown()}destroyElements(e){const animation=()=>this.startCloseAnimation(e);const onFinished=()=>{this.onElementsRemoved();e.onFinished?.()};const t={...e,animation:animation,onFinished:onFinished,log:false};up.destroy(this.element,t)}onElementsRemoved(){}_startAnimation(e={}){const t=up.animate(this.getBoxElement(),e.boxAnimation,e);let r;this.backdrop&&!up.motion.isNone(e.boxAnimation)&&(r=up.animate(this.backdropElement,e.backdropAnimation,e));return Promise.all([t,r])}async startOpenAnimation(e={}){await this._startAnimation({boxAnimation:e.animation??this.evalOption(this.openAnimation),backdropAnimation:"fade-in",easing:e.easing||this.openEasing,duration:e.duration||this.openDuration});this.wasEverVisible=true}startCloseAnimation(e={}){return this._startAnimation({boxAnimation:this.wasEverVisible&&(e.animation??this.evalOption(this.closeAnimation)),backdropAnimation:this.wasEverVisible&&"fade-out",easing:e.easing||this.closeEasing,duration:e.duration||this.closeDuration})}accept(e=null,t={}){return this._executeCloseChange("accept",e,t)}dismiss(e=null,t={}){return this._executeCloseChange("dismiss",e,t)}_supportsDismissMethod(e){return t.contains(this.dismissable,e)}_executeCloseChange(e,t,r){r={...r,verb:e,value:t,layer:this};return new up.Change.CloseLayer(r).execute()}getFirstSwappableElement(){return this.getContentElement().children[0]}toString(){return`${this.mode} overlay`}}},()=>{up.Layer.OverlayWithTether=class OverlayWithTether extends up.Layer.Overlay{createElements(){this.origin||up.fail("Missing { origin } option");this._tether=new up.Tether({anchor:this.origin,align:this.align,position:this.position});this.createElement(this._tether.parent);this.createContentElement(this.element)}onContentSet(){this._tether.start(this.element)}onElementsRemoved(){this._tether.stop()}sync(){this.isOpen()&&(this.isDetached()||this._tether.isDetached()?this.dismiss(":detached",{animation:false,preventable:false}):this._tether.sync())}}},()=>{up.Layer.OverlayWithViewport=class OverlayWithViewport extends up.Layer.Overlay{static getParentElement(){return document.body}createElements(){up.viewport.bodyShifter.raiseStack();this.createElement(this.constructor.getParentElement());this.backdrop&&this.createBackdropElement(this.element);this.createViewportElement(this.element);this.createBoxElement(this.viewportElement);this.createContentElement(this.boxElement)}onElementsRemoved(){up.viewport.bodyShifter.lowerStack()}sync(){this.isDetached()&&this.isOpen()&&this.constructor.getParentElement().appendChild(this.element)}}},()=>{var e;const t=up.element;up.Layer.Root=(e=class Root extends up.Layer{get element(){return t.root}constructor(e){super(e);this.setupHandlers()}getFirstSwappableElement(){return document.body}static selector(){return"html"}setupHandlers(){if(!this.element.upHandlersApplied){this.element.upHandlersApplied=true;super.setupHandlers()}}sync(){this.setupHandlers()}accept(){this._cannotCloseRoot()}dismiss(){this._cannotCloseRoot()}_cannotCloseRoot(){up.fail("Cannot close the root layer")}toString(){return"root layer"}},e.mode="root",e)},()=>{var e;up.Layer.Modal=(e=class Modal extends up.Layer.OverlayWithViewport{},e.mode="modal",e)},()=>{var e;up.Layer.Popup=(e=class Popup extends up.Layer.OverlayWithTether{},e.mode="popup",e)},()=>{var e;up.Layer.Drawer=(e=class Drawer extends up.Layer.OverlayWithViewport{},e.mode="drawer",e)},()=>{var e;up.Layer.Cover=(e=class Cover extends up.Layer.OverlayWithViewport{},e.mode="cover",e)},()=>{var e;const t=up.util;const r=up.element;up.LayerLookup=(e=class LayerLookup{constructor(e,r){this._stack=e;r.normalizeLayerOptions!==false&&up.layer.normalizeOptions(r);this._options=r;this._values=t.parseTokens(r.layer)}all(){let e=t.flatMap(this._values,(e=>this._resolveValue(e)));e=t.compact(e);e=t.uniq(e);return e}static all(e,...r){const n=t.parseArgIntoOptions(r,"layer");const{layer:s}=n;return s instanceof up.Layer?[s]:new this(e,n).all()}_forElement(e){e=r.get(e);return t.find(this._stack.reversed(),(t=>t.contains(e)))}_forIndex(e){return this._stack.at(e)}_resolveValue(e){if(e instanceof up.Layer)return e;if(t.isNumber(e))return this._forIndex(e);if(/^\d+$/.test(e))return this._forIndex(Number(e));if(t.isElementish(e))return this._forElement(e);switch(e){case"any":return[this._getBaseLayer(),...this._stack.reversed()];case"current":return this._getBaseLayer();case"closest":return this._stack.selfAndAncestorsOf(this._getBaseLayer());case"parent":return this._getBaseLayer().parent;case"ancestor":case"ancestors":return this._getBaseLayer().ancestors;case"child":return this._getBaseLayer().child;case"descendant":case"descendants":return this._getBaseLayer().descendants;case"subtree":return this._getBaseLayer().subtree;case"new":return"new";case"root":return this._stack.root;case"overlay":case"overlays":return t.reverse(this._stack.overlays);case"front":return this._stack.front;case"origin":return this._getOriginLayer();default:return up.fail("Unknown { layer } option: %o",e)}}_getOriginLayer(){let{origin:e,originLayer:t}=this._options;return t||(e?this._forElement(e):void 0)}_getBaseLayer(){let{baseLayer:e}=this._options;if(t.isString(e)){const t={...this._options,baseLayer:this._stack.current,normalizeLayerOptions:false,layer:e};return this.constructor.all(this._stack,t)[0]}return e||this._getOriginLayer()||this._stack.current}},(()=>{t.memoizeMethod(e.prototype,{_getBaseLayer:true,_getOriginLayer:true})})(),e)},()=>{const e=up.util;up.LayerStack=class LayerStack{constructor(){this._currentOverrides=[];this.layers=[this._buildRoot()]}_buildRoot(){return up.layer.build({mode:"root",stack:this})}remove(t){e.remove(this.layers,t)}peel(t,r){const n=e.reverse(t.descendants);const s={...r,preventable:false};for(let e of n)e.dismiss(":peel",s)}reset(){this.peel(this.root,{animation:false});this._currentOverrides=[];this.root.reset()}isOpen(t){return e.contains(this.layers,t)}isClosed(e){return!this.isOpen(e)}parentOf(e){return this.layers[e.index-1]}childOf(e){return this.layers[e.index+1]}ancestorsOf(t){return e.reverse(this.layers.slice(0,t.index))}selfAndAncestorsOf(e){return[e,...e.ancestors]}descendantsOf(e){return this.layers.slice(e.index+1)}isRoot(e){return this.root===e}isOverlay(e){return this.root!==e}isCurrent(e){return this.current===e}isFront(e){return this.front===e}get(...e){return this.getAll(...e)[0]}getAll(...e){return up.LayerLookup.all(this,...e)}sync(){for(let e of this.layers)e.sync()}asCurrent(e,t){try{this._currentOverrides.push(e);return t()}finally{this._currentOverrides.pop()}}reversed(){return e.reverse(this.layers)}dismissOverlays(t=null,r={}){r.dismissable=false;for(let n of e.reverse(this.overlays))n.dismiss(t,r)}at(e){return this.layers[e]}indexOf(e){return this.layers.indexOf(e)}get count(){return this.layers.length}get root(){return this.layers[0]}get overlays(){return this.root.descendants}get current(){return e.last(this._currentOverrides)||this.front}get front(){return e.last(this.layers)}}},()=>{const e=up.util;up.LinkFeedbackURLs=class LinkFeedbackURLs{constructor(t){this._isSafe=up.link.isSafe(t);if(this._isSafe){const r=t.getAttribute("href");r&&r!=="#"&&(this._href=e.matchableURL(r));const n=t.getAttribute("up-href");n&&(this._upHREF=e.matchableURL(n));const s=t.getAttribute("up-alias");s&&(this._aliasPattern=new up.URLPattern(s))}}isCurrent(e){return!!e&&!!(this._href===e||this._upHREF===e||this._aliasPattern?.test?.(e,false))}}},()=>{const e=up.util;const t=up.element;up.LinkFollowIntent=class LinkFollowIntent{constructor(e,t){this._link=e;this._callback=t;this._on("mouseenter mousedown touchstart",(e=>this._scheduleCallback(e)));this._on("mouseleave",(()=>this._unscheduleCallback()));up.fragment.onAborted(this._link,(()=>this._unscheduleCallback()))}_on(e,t){up.on(this._link,e,{passive:true},t)}_scheduleCallback(t){if(!up.link.shouldFollowEvent(t,this._link))return;this._unscheduleCallback();const r=t.type==="mouseenter";if(r){let r=this._parseDelay();this._timer=e.timer(r,(()=>this._runCallback(t)))}else this._runCallback(t)}_unscheduleCallback(){clearTimeout(this._timer);up.network.abort((e=>e.origin===this._link&&e.background))}_parseDelay(){return t.numberAttr(this._link,"up-preload-delay")??up.link.config.preloadDelay}_runCallback(e){up.log.putsEvent(e);up.error.muteUncriticalRejection(this._callback())}}},()=>{const e=up.util;const t=up.element;up.MotionController=class MotionController{constructor(e){this._activeClass=`up-${e}`;this._selector=`.${this._activeClass}`;this.finishEvent=`up:${e}:finish`;this.finishCount=0;this._clusterCount=0}startFunction(e,r,n={}){e=t.list(e);const mutedAnimator=()=>up.error.muteUncriticalRejection(r());n.trackMotion=n.trackMotion??up.motion.isEnabled();if(n.trackMotion===false)return mutedAnimator();{n.trackMotion=false;this.finish(e);this._markCluster(e);let t=this._whileForwardingFinishEvent(e,mutedAnimator);t=t.then((()=>this._unmarkCluster(e)));return t}}finish(e){this.finishCount++;if(this._clusterCount!==0&&up.motion.isEnabled()){e=this._expandFinishRequest(e);for(let t of e)this._finishOneElement(t);return up.migrate.formerlyAsync?.("up.motion.finish()")}}_expandFinishRequest(r){return r?e.flatMap(r,(e=>t.list(e.closest(this._selector),e.querySelectorAll(this._selector)))):document.querySelectorAll(this._selector)}isActive(e){return e.classList.contains(this._activeClass)}_finishOneElement(e){this._emitFinishEvent(e)}_emitFinishEvent(e,t={}){t={target:e,log:false,...t};return up.emit(this.finishEvent,t)}_markCluster(e){this._clusterCount++;this._toggleActive(e,true)}_unmarkCluster(e){this._clusterCount--;this._toggleActive(e,false)}_toggleActive(e,t){for(let r of e)r.classList.toggle(this._activeClass,t)}_whileForwardingFinishEvent(e,t){if(e.length<2)return t();const doForward=t=>{if(!t.forwarded)for(let r of e)r!==t.target&&this.isActive(r)&&this._emitFinishEvent(r,{forwarded:true})};const r=up.on(e,this.finishEvent,doForward);return t().then(r)}async reset(){await this.finish();this.finishCount=0;this._clusterCount=0}}},()=>{const e=up.util;const t=up.element;up.NonceableCallback=class NonceableCallback{constructor(e,t){this.script=e;this.nonce=t}static fromString(e){let t=e.match(/^(nonce-([^\s]+)\s)?(.*)$/);return new this(t[3],t[2])}toFunction(...e){if(this.nonce){let t=this;return function(...r){return t._runAsNoncedFunction(this,e,r)}}return new Function(...e,this.script)}toString(){return`nonce-${this.nonce} ${this.script}`}_runAsNoncedFunction(e,t,r){let n=`\n      try {\n        up.noncedEval.value = (function(${t.join()}) {\n          ${this.script}\n        }).apply(up.noncedEval.thisArg, up.noncedEval.args)\n      } catch (error) {\n        up.noncedEval.error = error\n      }\n    `;let s;try{up.noncedEval={args:r,thisArg:e};s=up.element.affix(document.body,"script",{nonce:this.nonce,text:n});if(up.noncedEval.error)throw up.noncedEval.error;return up.noncedEval.value}finally{up.noncedEval=void 0;s&&s.remove()}}_allowedBy(t){return this.nonce&&e.contains(t,this.nonce)}static adoptNonces(r,n){if(!n?.length)return;const s=e.memoize(up.protocol.cspNonce);e.each(up.script.config.nonceableAttributes,(i=>{let o=t.subtree(r,`[${i}^="nonce-"]`);e.each(o,(e=>{let t=e.getAttribute(i);let r=this.fromString(t);let warn=(e,...r)=>up.log.warn("up.render()",`Cannot use callback [${i}="${t}"]: ${e}`,...r);if(!r._allowedBy(n))return warn("Callback's CSP nonce (%o) does not match response header (%o)",r.nonce,n);let o=s();if(!o)return warn("Current page's CSP nonce is unknown");r.nonce=o;e.setAttribute(i,r.toString())}))}))}}},()=>{const e=up.element;const t=up.util;up.OverlayFocus=class OverlayFocus{constructor(e){this._layer=e;this._focusElement=this._layer.getFocusElement()}moveToFront(){if(!this._enabled){this._enabled=true;this._untrapFocus=up.on("focusin",(e=>this._onFocus(e)));this._unsetAttrs=e.setTemporaryAttrs(this._focusElement,{tabindex:"0",role:"dialog","aria-modal":"true"});this._focusTrapBefore=e.affix(this._focusElement,"beforebegin","up-focus-trap[tabindex=0]");this._focusTrapAfter=e.affix(this._focusElement,"afterend","up-focus-trap[tabindex=0]")}}moveToBack(){this.teardown()}teardown(){if(this._enabled){this._enabled=false;this._untrapFocus();this._unsetAttrs();this._focusTrapBefore.remove();this._focusTrapAfter.remove()}}_onFocus(e){const{target:t}=e;if(!this._processingFocusEvent&&!up.layer.isWithinForeignOverlay(t)){this._processingFocusEvent=true;t===this._focusTrapBefore?this._focusEnd():t!==this._focusTrapAfter&&this._layer.contains(t)||this._focusStart();this._processingFocusEvent=false}}_focusStart(e){up.focus(this._focusElement,e)}_focusEnd(){this._focusLastDescendant(this._layer.getBoxElement())||this._focusStart()}_focusLastDescendant(e){for(let r of t.reverse(e.children))if(up.viewport.tryFocus(r)||this._focusLastDescendant(r))return true}}},()=>{const e=up.util;const t=up.element;up.Params=class Params{constructor(e){this.clear();this.addAll(e)}clear(){this.entries=[]}[e.copy.key](){return new up.Params(this)}toObject(){const t={};for(let r of this.entries){const{name:n,value:s}=r;if(!e.isBasicObjectProperty(n))if(this._isArrayKey(n)){t[n]||=[];t[n].push(s)}else t[n]=s}return t}toArray(){return this.entries}toFormData(){const e=new FormData;for(let t of this.entries)e.append(t.name,t.value);e.entries||(e.originalArray=this.entries);return e}toQuery(){let t=e.map(this.entries,this._arrayEntryToQuery.bind(this));t=e.compact(t);return t.join("&")}_arrayEntryToQuery(t){const{value:r}=t;if(this._isBinaryValue(r))return;let n=encodeURIComponent(t.name);if(e.isGiven(r)){n+="=";n+=encodeURIComponent(r)}return n}_isBinaryValue(e){return e instanceof Blob}hasBinaryValues(){const t=e.map(this.entries,"value");return e.some(t,this._isBinaryValue)}toURL(t){let r=[t,this.toQuery()];r=e.filter(r,e.isPresent);const n=e.contains(t,"?")?"&":"?";return r.join(n)}add(e,t){this.entries.push({name:e,value:t})}addAll(t){e.isMissing(t)||(t instanceof this.constructor?this.entries.push(...t.entries):e.isArray(t)?this.entries.push(...t):e.isString(t)?this._addAllFromQuery(t):e.isFormData(t)?this._addAllFromFormData(t):e.isObject(t)?this._addAllFromObject(t):up.fail("Unsupport params type: %o",t))}_addAllFromObject(t){for(let r in t){const n=t[r];const s=e.isArray(n)?n:[n];for(let e of s)this.add(r,e)}}_addAllFromQuery(t){for(let r of t.split("&"))if(r){let[t,n]=r.split("=");t=decodeURIComponent(t);n=e.isGiven(n)?decodeURIComponent(n):null;this.add(t,n)}}_addAllFromFormData(e){for(let t of e.entries())this.add(...t)}set(e,t){this.delete(e);this.add(e,t)}delete(t){this.entries=e.reject(this.entries,this._matchEntryFn(t))}_matchEntryFn(e){return t=>t.name===e}get(e){return this._isArrayKey(e)?this.getAll(e):this.getFirst(e)}getFirst(t){const r=e.find(this.entries,this._matchEntryFn(t));return r?.value}getAll(t){if(this._isArrayKey(t))return this.getAll(t);{const r=e.map(this.entries,this._matchEntryFn(t));return e.map(r,"value")}}_isArrayKey(e){return e.endsWith("[]")}[e.isBlank.key](){return this.entries.length===0}static fromForm(e){return this.fromContainer(e)}static fromContainer(e){let t=up.form.fields(e);return this.fromFields(t)}static fromFields(t){const r=new this;for(let n of e.wrapList(t))r.addField(n);return r}addField(e){e=t.get(e);let r=e.name;if(r&&!e.disabled){const{tagName:t}=e;const{type:n}=e;if(t==="SELECT")for(let t of e.querySelectorAll("option"))t.selected&&this.add(r,t.value);else if(n==="checkbox"||n==="radio")e.checked&&this.add(r,e.value);else{if(n!=="file")return this.add(r,e.value);for(let t of e.files)this.add(r,t)}}}[e.isEqual.key](t){return this.constructor===t.constructor&&e.isEqual(this.entries,t.entries)}static fromURL(t){const r=new this;const n=e.parseURL(t);let s=n.search;if(s){s=s.replace(/^\?/,"");r.addAll(s)}return r}static stripURL(t){return e.normalizeURL(t,{search:false})}static merge(...e){return e.reduce((function(e,t){e.addAll(t);return e}),new up.Params)}}},()=>{const e=up.element;const t=300;up.ProgressBar=class ProgressBar{constructor(){this._step=0;this._element=e.affix(document.body,"up-progress-bar");this._element.style.transition=`width ${t}ms ease-out`;this._moveTo(0);up.element.paint(this._element);this._width=31;this._nextStep()}_nextStep(){let e;e=this._width<80?Math.random()<.15?7+5*Math.random():1.5+.5*Math.random():.13*(100-this._width)*Math.random();this._moveTo(this._width+e);this._step++;const r=t+this._step*40;this.timeout=setTimeout(this._nextStep.bind(this),r)}_moveTo(e){this._width=e;this._element.style.width=`${e}vw`}destroy(){clearTimeout(this.timeout);this._element.remove()}conclude(){clearTimeout(this.timeout);this._moveTo(100);setTimeout(this.destroy.bind(this),t)}}},()=>{const e=up.util;up.RenderOptions=function(){const t={useHungry:true,useKeep:true,saveScroll:true,saveFocus:true,focus:"keep",abort:"target",failOptions:true};const r={abort:false,confirm:false,feedback:false,cache:true,background:true};const n=["url","method","origin","headers","params","cache","fallback","abort","abortable","confirm","feedback","origin","originLayer","baseLayer","fail","onError"];const s=n.concat(["keep","hungry","history","source","saveScroll","navigate","baseLayer"]);const i=["url","response","content","fragment","document"];const o=["history","focus","scroll"];function navigateDefaults(e){if(e.navigate)return up.fragment.config.navigateOptions}function normalizeURL({url:t}){if(t)return{url:e.normalizeURL(t)}}function preloadOverrides(e){if(e.preload)return r}function preprocess(r){up.migrate.preprocessRenderOptions?.(r);const n=e.merge(t,navigateDefaults(r));return e.merge(e.omit(n,o),{defaults:n},{inputDevice:up.event.inputDevice},r,normalizeURL(r),rememberOriginLayer(r),preloadOverrides(r))}function rememberOriginLayer({origin:e,originLayer:t}){if(e&&!t)return{originLayer:up.layer.get(e)}}function finalize(t,r){return e.merge(t.defaults,r,t)}function assertContentGiven(t){e.some(i,(r=>e.isGiven(t[r])))||(t.defaultToEmptyContent?t.content="":up.fail("up.render() needs either { "+i.join(", ")+" } option"))}function failOverrides(e){const t={};for(let r in e){const n=e[r];let s=up.fragment.successKey(r);s&&(t[s]=n)}return t}function deriveFailOptions(t){let r=failOverrides(t);let n=rememberOriginLayer(r);return t.failOptions?{...t.defaults,...e.pick(t,s),...r,...n,failPrefixForced:true}:{...t,...r,...n}}return{preprocess:preprocess,finalize:finalize,assertContentGiven:assertContentGiven,deriveFailOptions:deriveFailOptions,lookupLayers:rememberOriginLayer}}()},()=>{up.RenderResult=class RenderResult extends up.Record{keys(){return["fragments","layer","target","options","finished"]}defaults(){return{fragments:[]}}get none(){return!this.fragments.length}get fragment(){return this.fragments[0]}static both(e,t,r=true){return t?new this({target:e.target,layer:e.layer,options:e.options,fragments:e.fragments.concat(t.fragments),finished:r&&this.mergeFinished(e,t)}):e}static async mergeFinished(e,t){return this.both(await e.finished,await t.finished,false)}static buildNone(){return new this({target:":none",finished:Promise.resolve()})}}},()=>{var t;const r=up.util;up.Request=(t=class Request extends up.Record{keys(){return["method","url","hash","params","target","failTarget","headers","timeout","background","cache","expireCache","evictCache","layer","mode","context","failLayer","failMode","failContext","origin","fragments","builtAt","wrapMethod","contentType","payload","onLoading","fail","abortable","badResponseTime"]}defaults(){return{state:"new",abortable:true,headers:{},timeout:up.network.config.timeout,builtAt:new Date}}constructor(e){super(e);this.params=new up.Params(this.params);this.wrapMethod==null&&(this.wrapMethod=up.network.config.wrapMethod);this._normalize();if((this.target||this.layer||this.origin)&&!e.basic){const e={origin:this.origin};this.layer=up.layer.get(this.layer,e);this.failLayer=up.layer.get(this.failLayer,e);this.context||=this.layer.context||{};this.failContext||=this.failLayer?.context||{};this.mode||=this.layer.mode;this.failMode||=this.failLayer?.mode}this.deferred=r.newDeferred();this.badResponseTime??=r.evalOption(up.network.config.badResponseTime,this);this._setAutoHeaders()}get xhr(){return this._xhr??=new XMLHttpRequest}get fragments(){if(this._fragments)return this._fragments;{let e=up.fragment.parseTargetSteps(this.target);let t=r.map(e,"selector");let n={origin:this.origin,layer:this.layer};return r.compact(r.map(t,(e=>up.fragment.get(e,n))))}}set fragments(e){this._fragments=e}get fragment(){return this.fragments?.[0]}_normalize(){this.method=r.normalizeMethod(this.method);this._extractHashFromURL();this._transferParamsToURL();this.url=r.normalizeURL(this.url)}_evictExpensiveAttrs(){r.task((()=>{this.layer=void 0;this.failLayer=void 0;this.origin=void 0;this.fragments=void 0}))}_extractHashFromURL(){let e=this.url?.match(/^([^#]*)(#.+)$/);if(e){this.url=e[1];return this.hash=e[2]}}_transferParamsToURL(){if(this.url&&!this.allowsPayload()&&!r.isBlank(this.params)){this.url=this.params.toURL(this.url);this.params.clear()}}isSafe(){return up.network.isSafeMethod(this.method)}allowsPayload(){return r.methodAllowsPayload(this.method)}will302RedirectWithGET(){return this.isSafe()||this.method==="POST"}willCache(){return r.evalAutoOption(this.cache,up.network.config.autoCache,this)}runQueuedCallbacks(){r.always(this,(()=>this._evictExpensiveAttrs()))}load(){if(this.state==="new"){if(this._emitLoad()){this.state="loading";this._normalize();this.onLoading?.();this.expired=false;new up.Request.XHRRenderer(this).buildAndSend({onload:()=>this._onXHRLoad(),onerror:()=>this._onXHRError(),ontimeout:()=>this._onXHRTimeout(),onabort:()=>this._onXHRAbort()});return true}this.abort({reason:"Prevented by event listener"})}}_emitLoad(){let e=this.emit("up:request:load",{log:["Loading %s",this.description]});return!e.defaultPrevented}loadPage(){up.network.abort();new up.Request.FormRenderer(this).buildAndSubmit()}_onXHRLoad(){const e=this._extractResponseFromXHR();const t="Loaded "+e.description;this.emit("up:request:loaded",{request:e.request,response:e,log:t});this.respondWith(e)}_onXHRError(){this._setOfflineState("Network error")}_onXHRTimeout(){this._setOfflineState("Timeout")}_onXHRAbort(){this._setAbortedState()}abort({reason:e}={}){this._setAbortedState(e)&&this._xhr&&this._xhr.abort()}_setAbortedState(e){if(this._isSettled())return;let t="Aborted request to "+this.description+(e?": "+e:"");this.state="aborted";this.deferred.reject(new up.Aborted(t));this.emit("up:request:aborted",{log:t});return true}_setOfflineState(e){if(this._isSettled())return;let t="Cannot load request to "+this.description+(e?": "+e:"");this.state="offline";this.emit("up:request:offline",{log:t});this.deferred.reject(new up.Offline(t))}respondWith(e){this.response=e;if(!this._isSettled()){this.state="loaded";e.ok?this.deferred.resolve(e):this.deferred.reject(e)}}_isSettled(){return this.state!=="new"&&this.state!=="loading"&&this.state!=="tracking"}csrfHeader(){return up.protocol.csrfHeader()}csrfParam(){return up.protocol.csrfParam()}csrfToken(){if(!this.isSafe()&&!this.isCrossOrigin())return up.protocol.csrfToken()}isCrossOrigin(){return r.isCrossOrigin(this.url)}_extractResponseFromXHR(){const e={method:this.method,url:this.url,request:this,xhr:this.xhr,text:this.xhr.responseText,status:this.xhr.status,title:up.protocol.titleFromXHR(this.xhr),target:up.protocol.targetFromXHR(this.xhr),acceptLayer:up.protocol.acceptLayerFromXHR(this.xhr),dismissLayer:up.protocol.dismissLayerFromXHR(this.xhr),eventPlans:up.protocol.eventPlansFromXHR(this.xhr),context:up.protocol.contextFromXHR(this.xhr),expireCache:up.protocol.expireCacheFromXHR(this.xhr),evictCache:up.protocol.evictCacheFromXHR(this.xhr),fail:this.fail};let t=up.protocol.methodFromXHR(this.xhr);let n=up.protocol.locationFromXHR(this.xhr);if(n){r.matchURLs(this.url,n)||(t||="GET");e.url=n}t&&(e.method=t);return new up.Response(e)}_buildEventEmitter(e){return up.EventEmitter.fromEmitArgs(e,{layer:this.layer,request:this,origin:this.origin})}emit(...e){return this._buildEventEmitter(e).emit()}assertEmitted(...e){this._buildEventEmitter(e).assertEmitted()}get description(){return this.method+" "+this.url}isPartOfSubtree(e){e=r.wrapList(e);return r.some(this.fragments,(function(t){return r.some(e,(e=>e.contains(t)))}))}get age(){return new Date-this.builtAt}header(e){return this.headers[e]}_setAutoHeaders(){for(let e of["target","failTarget","mode","failMode","context","failContext"])this._setPropertyHeader(e);let e,t;(e=this.csrfHeader())&&(t=this.csrfToken())&&this._setAutoHeader(e,t);this._setAutoHeader(up.protocol.headerize("version"),up.version)}_setPropertyHeader(e){this._setAutoHeader(up.protocol.headerize(e),this[e])}_setAutoHeader(e,t){if(!r.isMissing(t)){(r.isOptions(t)||r.isArray(t))&&(t=r.safeStringifyJSON(t));this.headers[e]=t}}mergeIfUnsent(e){if(this.state!=="new")return;if(!this.target||!e.target)return;let t=up.fragment.splitTarget(this.target+","+e.target);this.target=r.uniq(t).join(", ");this._setPropertyHeader("target");this._fragments=r.uniq([...this.fragments,...e.fragments])}static tester(e,{except:t}={}){let n;if(r.isFunction(e))n=e;else if(e instanceof this)n=t=>e===t;else if(r.isString(e)){let t=new up.URLPattern(e);n=e=>t.test(e.url)}else n=t=>e;return t?e=>!up.cache.willHaveSameResponse(e,t)&&n(e):n}},(()=>{r.delegate(t.prototype,["then","catch","finally"],(function(){return(this||e).deferred}))})(),t)},()=>{const e=up.util;class Route{constructor(){this.varyHeaders=new Set;this.requests=[]}matchBest(t){let r=this.requests.filter((e=>this.satisfies(e,t)));return e.last(r)}delete(t){e.remove(this.requests,t)}put(e){this.requests.push(e)}updateVary(e){for(let t of e.varyHeaderNames)this.varyHeaders.add(t)}satisfies(t,r){return t===r||e.every(this.varyHeaders,(n=>{let s=t.header(n);let i=r.header(n);if(n==="X-Up-Target"||n==="X-Up-Fail-Target"){if(!s)return true;if(!i)return false;let t=e.parseTokens(s,{separator:"comma"});let r=e.parseTokens(i,{separator:"comma"});return e.containsAll(t,r)}return s===i}))}}up.Request.Cache=class Cache{constructor(){this.reset()}reset(){this._routes={};this._requests=[]}get(e){e=this._wrap(e);let t=this._getRoute(e);let r=t.matchBest(e);if(r){if(this._isUsable(r))return r;this._delete(e,t)}}async put(e){e=this._wrap(e);let t=this._getRoute(e);let{response:r}=e;r&&t.updateVary(r);let n=t.requests.filter((r=>t.satisfies(e,r)));for(let e of n)this._delete(e);e.cacheRoute=t;t.put(e);this._requests.push(e);this._limitSize()}alias(e,t){e=this.get(e);if(e){t=this._wrap(t);this.track(e,t,{force:true});this.put(t);return t}}async track(t,r,n={}){r.trackedRequest=t;r.state="tracking";let s=await e.always(t);if(s instanceof up.Response)if(n.force||t.cacheRoute.satisfies(t,r)){r.fromCache=true;s=e.variant(s,{request:r});r.respondWith(s);e.delegate(r,["expired","state"],(()=>t))}else{delete r.trackedRequest;r.state="new";n.onIncompatible?.(r)}else{r.state=t.state;r.deferred.reject(s)}}willHaveSameResponse(e,t){return e===t||e===t.trackedRequest}evict(e=true,t){this._eachMatch(e,t,(e=>this._delete(e)))}expire(e=true,t){this._eachMatch(e,t,(e=>e.expired=true))}reindex(e){this._delete(e);this.put(e)}_delete(t){e.remove(this._requests,t);t.cacheRoute?.delete(t);delete t.cacheRoute}_getRoute(e){return e.cacheRoute||(this._routes[e.description]||=new Route)}_isUsable(e){return e.age<up.network.config.cacheEvictAge}get _size(){return this._requests.length}get _capacity(){return up.network.config.cacheSize}_limitSize(){for(let e=0;e<this._size-this._capacity;e++)this._delete(this._requests[0])}_eachMatch(t=true,r,n){let s=up.Request.tester(t,r);let i=e.filter(this._requests,s);e.each(i,n)}_wrap(t){return e.wrapValue(up.Request,t)}}},()=>{const e=up.util;up.Request.Queue=class Queue{constructor(){this.reset()}reset(){this._queuedRequests=[];this._currentRequests=[];this._emittedLate=false}get allRequests(){return this._currentRequests.concat(this._queuedRequests)}asap(t){t.runQueuedCallbacks();e.always(t,(e=>this._onRequestSettled(t,e)));this._scheduleSlowTimer(t);this._queueRequest(t);queueMicrotask((()=>this._poke()))}promoteToForeground(e){if(e.background){e.background=false;this._scheduleSlowTimer(e)}}_scheduleSlowTimer(t){let r=Math.max(t.badResponseTime-t.age,0);e.timer(r,(()=>this._checkLate()))}_getMaxConcurrency(){return e.evalOption(up.network.config.concurrency)}_hasConcurrencyLeft(){const e=this._getMaxConcurrency();return e===-1||this._currentRequests.length<e}isBusy(){return this._currentRequests.length>0||this._queuedRequests.length>0}_queueRequest(e){this._queuedRequests.push(e)}_pluckNextRequest(){let t=e.find(this._queuedRequests,(e=>!e.background));t||=this._queuedRequests[0];return e.remove(this._queuedRequests,t)}_sendRequestNow(e){e.load()&&this._currentRequests.push(e)}_onRequestSettled(t,r){e.remove(this._currentRequests,t)||e.remove(this._queuedRequests,t);r instanceof up.Response&&r.ok&&up.network.registerAliasForRedirect(t,r);this._checkLate();queueMicrotask((()=>this._poke()))}_poke(){let e;if(this._hasConcurrencyLeft()&&(e=this._pluckNextRequest()))return this._sendRequestNow(e)}abort(...t){let r=e.extractOptions(t);let{except:n,reason:s,logOnce:i}=r;let o=t[0]??true;let a=up.Request.tester(o,{except:n});for(let t of[this._currentRequests,this._queuedRequests]){const r=e.filter(t,a);for(let n of r){if(i){up.puts(...i);i=null}n.abort({reason:s});e.remove(t,n)}}}_checkLate(){const e=this._isLate();if(this._emittedLate!==e){this._emittedLate=e;e?up.emit("up:network:late",{log:"Server is slow to respond"}):up.emit("up:network:recover",{log:"Slow requests were loaded"})}}_isLate(){const t=e.reject(this.allRequests,"background");const r=1;return e.some(t,(e=>e.age>=e.badResponseTime-r))}}},()=>{const e=up.util;const t=up.element;const r=["GET","POST"];up.Request.FormRenderer=class FormRenderer{constructor(e){this._request=e}buildAndSubmit(){this.params=e.copy(this._request.params);let n=this._request.url;let{method:s}=this._request;const i=up.Params.fromURL(n);this.params.addAll(i);n=up.Params.stripURL(n);e.contains(r,s)||(s=up.protocol.wrapMethod(s,this.params));this._form=t.affix(document.body,"form.up-request-loader",{method:s,action:n});let o=this._request.contentType;o&&this._form.setAttribute("enctype",o);let a,u;(a=this._request.csrfParam())&&(u=this._request.csrfToken())&&this.params.add(a,u);e.each(this.params.toArray(),this._addField.bind(this));up.browser.submitForm(this._form)}_addField(e){t.affix(this._form,"input[type=hidden]",e)}}},()=>{var e;const t="application/x-www-form-urlencoded";const r="multipart/form-data";const n=up.util;up.Request.XHRRenderer=(e=class XHRRenderer{constructor(e){this._request=e}buildAndSend(e){const t=this._request.xhr;this._params=n.copy(this._request.params);this._request.timeout&&(t.timeout=this._request.timeout);t.open(this._getMethod(),this._request.url);let r=this._getContentType();r&&t.setRequestHeader("Content-Type",r);for(let e in this._request.headers){let r=this._request.headers[e];t.setRequestHeader(e,r)}Object.assign(t,e);t.send(this._getPayload())}_getMethod(){let e=this._request.method;this._request.wrapMethod&&!this._request.will302RedirectWithGET()&&(e=up.protocol.wrapMethod(e,this._params));return e}_getContentType(){this._finalizePayload();return this._contentType}_getPayload(){this._finalizePayload();return this._payload}_finalizePayload(){this._payload=this._request.payload;this._contentType=this._request.contentType;if(!this._payload&&this._request.allowsPayload()){this._contentType||(this._contentType=this._params.hasBinaryValues()?r:t);if(this._contentType===r){this._contentType=null;this._payload=this._params.toFormData()}else this._payload=this._params.toQuery().replace(/%20/g,"+")}}},(()=>{n.memoizeMethod(e.prototype,{_finalizePayload:true,_getMethod:true})})(),e)},()=>{const e=up.util;up.Response=class Response extends up.Record{keys(){return["method","url","text","status","request","xhr","target","title","acceptLayer","dismissLayer","eventPlans","context","expireCache","evictCache","headers","loadedAt","fail"]}defaults(){return{headers:{},loadedAt:new Date}}get ok(){return!e.evalOption(this.fail??up.network.config.fail,this)}get none(){return!this.text}header(e){return this.headers[e]||this.xhr?.getResponseHeader(e)}get varyHeaderNames(){let t=this.header("Vary");return e.parseTokens(t,{separator:"comma"})}get contentType(){return this.header("Content-Type")}get cspNonces(){return up.protocol.cspNoncesFromHeader(this.header("Content-Security-Policy")||this.header("Content-Security-Policy-Report-Only"))}get lastModified(){let e=this.header("Last-Modified");if(e)return new Date(e)}get etag(){return this.header("ETag")}get json(){return this.parsedJSON||=JSON.parse(this.text)}get age(){let e=new Date;return e-this.loadedAt}get expired(){return this.age>up.network.config.cacheExpireAge||this.request.expired}get description(){return`HTTP ${this.status} response to ${this.request.description}`}}},()=>{var e;const t=up.util;const r=up.element;const n=/^\s*<(html|!DOCTYPE)\b/i;up.ResponseDoc=(e=class ResponseDoc{constructor({document:e,fragment:t,content:r,target:n,origin:s,cspNonces:i,match:o}){e?this._parseDocument(e):t?this._parseFragment(t):this._parseContent(r||"",n);this._cspNonces=i;if(s){let e=up.fragment.tryToTarget(s);e&&(this._rediscoveredOrigin=this.select(e))}this._match=o}_parseDocument(e){if(e instanceof Document){this._document=e;this._isFullDocument=true}else if(t.isString(e)){this._document=r.createBrokenDocumentFromHTML(e);this._isFullDocument=n.test(e);this._isDocumentBroken=true}else{this._document=this._buildFauxDocument(e);this._isFullDocument=e.matches("html")}}_parseFragment(e){let n=t.isString(e)?r.createFromHTML(e):e;this._document=this._buildFauxDocument(n)}_parseContent(e,n){n||up.fail("must pass a { target } when passing { content }");let s=t.map(up.fragment.parseTargetSteps(n),"selector").join();const i=r.createFromSelector(s);t.isString(e)?i.innerHTML=e:i.appendChild(e);this._document=this._buildFauxDocument(i)}_buildFauxDocument(e){let t=document.createElement("up-document");t.append(e);t.documentElement=e;return t}rootSelector(){return up.fragment.toTarget(this._document.documentElement)}get title(){return this._fromHead(this._getTitleText)}_getHead(){if(this._isFullDocument)return this._document.head}_fromHead(e){let t=this._getHead();return t&&e(t)}get metaTags(){return this._fromHead(up.history.findMetaTags)}get assets(){return this._fromHead(up.script.findAssets)}get lang(){if(this._isFullDocument)return up.history.getLang(this._document)}_getTitleText(e){return e.querySelector("title")?.textContent}select(e){let t=new up.FragmentFinder({selector:e,origin:this._rediscoveredOrigin,document:this._document,match:this._match});return t.find()}selectSteps(e){return e.filter((e=>this._trySelectStep(e)||this._cannotMatchStep(e)))}commitSteps(e){return e.filter((e=>this.commitElement(e.newElement)))}_trySelectStep(e){if(e.newElement)return true;let t=this.select(e.selector);if(!t)return;let{selectEvent:r}=e;if(r){r.newFragment=t;r.renderOptions=e.originalRenderOptions;up.emit(e.oldElement,r,{callback:e.selectCallback});if(r.defaultPrevented)return}e.newElement=t;return true}_cannotMatchStep(e){if(!e.maybe)throw new up.CannotMatch}commitElement(e){if(this._document.contains(e)){up.fragment.config.runScripts||up.script.disableSubtree(e);e.remove();return true}}finalizeElement(e){up.NonceableCallback.adoptNonces(e,this._cspNonces);if(this._isDocumentBroken){let n=r.subtree(e,":is(noscript,script,audio,video):not(.up-keeping, .up-keeping *)");t.each(n,r.fixParserDamage)}}},(()=>{t.memoizeMethod(e.prototype,{_getHead:true})})(),e)},()=>{const e=up.element;const t=up.util;up.RevealMotion=class RevealMotion{constructor(t,r={}){this._element=t;this._viewport=e.get(r.viewport)||up.viewport.get(this._element);this._obstructionsLayer=up.layer.get(this._viewport);this._behavior=r.scrollBehavior??r.behavior??"instant";const n=up.viewport.config;this._snap=r.snap??r.revealSnap??n.revealSnap;this._padding=r.padding??r.revealPadding??n.revealPadding;this._top=r.top??r.revealTop??n.revealTop;this._max=r.max??r.revealMax??n.revealMax;this._topObstructionSelector=n.selector("fixedTopSelectors");this._bottomObstructionSelector=n.selector("fixedBottomSelectors")}start(){const e=this._getViewportRect(this._viewport);const r=up.Rect.fromElement(this._element);if(this._max){const e=t.evalOption(this._max,this._element);r.height=Math.min(r.height,e)}r.grow(this._padding);this._substractObstructions(e);e.height<0&&up.fail("Viewport has no visible area");const n=this._viewport.scrollTop;let s=n;if(this._top||r.height>e.height){const t=r.top-e.top;s+=t}else r.top<e.top?s-=e.top-r.top:r.bottom>e.bottom&&(s+=r.bottom-e.bottom);t.isNumber(this._snap)&&s<this._snap&&r.top<.5*e.height&&(s=0);s!==n&&this._viewport.scrollTo({top:s,behavior:this._behavior})}_getViewportRect(){return up.viewport.isRoot(this._viewport)?new up.Rect({left:0,top:0,width:up.viewport.rootWidth(),height:up.viewport.rootHeight()}):up.Rect.fromElement(this._viewport)}_selectObstructions(r){let n=up.fragment.all(r,{layer:this._obstructionsLayer});return t.filter(n,e.isVisible)}_substractObstructions(e){for(let t of this._selectObstructions(this._topObstructionSelector)){let r=up.Rect.fromElement(t);let n=r.bottom-e.top;if(n>0){e.top+=n;e.height-=n}}for(let t of this._selectObstructions(this._bottomObstructionSelector)){let r=up.Rect.fromElement(t);let n=e.bottom-r.top;n>0&&(e.height-=n)}}}},()=>{const e=up.util;const t=/:has\(([^)]+)\)$/;up.Selector=class Selector{constructor(r,n,s={}){this._filters=[];s.destroying||this._filters.push(up.fragment.isNotDestroying);let i=n&&!document.contains(n);let o;if(i||s.layer==="any")o=up.layer.root;else{s.layer??=e.presence(n,e.isElement);this._layers=up.layer.getAll(s);if(!this._layers.length)throw new up.CannotMatch(["Unknown layer: %o",s.layer]);this._filters.push((t=>e.some(this._layers,(e=>e.contains(t)))));o=this._layers[0]}let a=up.fragment.expandTargets(r,{...s,layer:o});this._selectors=a.map((e=>{up.browser.canHasSelector()||(e=e.replace(t,((e,t)=>{this._filters.push((e=>e.querySelector(t)));return""})));return e||"*"}));this._unionSelector=this._selectors.join()||"match-none"}matches(e){return e.matches(this._unionSelector)&&this._passesFilter(e)}closest(e){let t;return this.matches(e)?e:(t=e.parentElement)?this.closest(t):void 0}_passesFilter(t){return e.every(this._filters,(e=>e(t)))}descendants(t=document){const r=e.flatMap(this._selectors,(e=>t.querySelectorAll(e)));return e.filter(r,(e=>this._passesFilter(e)))}subtree(e){const t=[];e instanceof Document||!this.matches(e)||t.push(e);t.push(...this.descendants(e));return t}}},()=>{const e=up.util;const t=up.element;up.Tether=class Tether{constructor(e){up.migrate.handleTetherOptions?.(e);this._anchor=e.anchor;this._align=e.align;this._position=e.position;this._alignAxis=this._position==="top"||this._position==="bottom"?"horizontal":"vertical";this._viewport=up.viewport.get(this._anchor);this.parent=this._viewport===t.root?document.body:this._viewport;this._syncOnScroll=!this._viewport.contains(this._anchor.offsetParent)}start(e){this._element=e;this._element.style.position="absolute";this._setOffset(0,0);this.sync();this._changeEventSubscription("on")}stop(){this._changeEventSubscription("off")}_changeEventSubscription(e){let t=this._scheduleSync.bind(this);up[e](window,"resize",t);this._syncOnScroll&&up[e](this._viewport,"scroll",t)}_scheduleSync(){clearTimeout(this.syncTimer);return this.syncTimer=e.task(this.sync.bind(this))}isDetached(){return!this.parent.isConnected||!this._anchor.isConnected}sync(){const r=this._element.getBoundingClientRect();const n={top:t.styleNumber(this._element,"margin-top"),right:t.styleNumber(this._element,"margin-right"),bottom:t.styleNumber(this._element,"margin-bottom"),left:t.styleNumber(this._element,"margin-left")};const s=this._anchor.getBoundingClientRect();let i;let o;switch(this._alignAxis){case"horizontal":switch(this._position){case"top":o=s.top-n.bottom-r.height;break;case"bottom":o=s.top+s.height+n.top;break}switch(this._align){case"left":i=s.left+n.left;break;case"center":i=s.left+.5*(s.width-r.width);break;case"right":i=s.left+s.width-r.width-n.right;break}break;case"vertical":switch(this._align){case"top":o=s.top+n.top;break;case"center":o=s.top+.5*(s.height-r.height);break;case"bottom":o=s.top+s.height-r.height-n.bottom;break}switch(this._position){case"left":i=s.left-n.right-r.width;break;case"right":i=s.left+s.width+n.left;break}break}e.isDefined(i)||e.isDefined(o)?this._moveTo(i,o):up.fail("Invalid tether constraints: %o",this._describeConstraints())}_describeConstraints(){return{position:this._position,align:this._align}}_moveTo(e,t){const r=this._element.getBoundingClientRect();this._setOffset(e-r.left+this.offsetLeft,t-r.top+this.offsetTop)}_setOffset(e,r){this.offsetLeft=e;this.offsetTop=r;t.setStyle(this._element,{left:e,top:r},"px")}}},()=>{const e=up.util;up.URLPattern=class URLPattern{constructor(t){this._groups=[];const r=[];const n=[];for(let s of e.parseTokens(t))s[0]==="-"?n.push(s.substring(1)):r.push(s);this._positiveRegexp=this._buildRegexp(r,true);this._negativeRegexp=this._buildRegexp(n,false)}_buildRegexp(t,r){if(!t.length)return;t=e.flatMap(t,e.matchableURLPatternAtom);t=t.map(e.escapeRegExp);let n=t.join("|");n=n.replace(/\\\*/g,".*?");n=n.replace(/(:|\\\$)([a-z][\w-]*)/gi,((e,t,n)=>{if(t==="\\$"){r&&this._groups.push({name:n,cast:Number});return"(\\d+)"}r&&this._groups.push({name:n,cast:String});return"([^/?#]+)"}));return new RegExp("^(?:"+n+")$")}test(t,r=true){r&&(t=e.matchableURL(t));return this._positiveRegexp.test(t)&&!this._isExcluded(t)}recognize(t,r=true){r&&(t=e.matchableURL(t));let n=this._positiveRegexp.exec(t);if(n&&!this._isExcluded(t)){const e={};this._groups.forEach(((t,r)=>{let s=n[r+1];if(s)return e[t.name]=t.cast(s)}));return e}}_isExcluded(e){return this._negativeRegexp?.test(e)}}},()=>{up.framework=function(){let e="evaling";function emitReset(){up.emit("up:framework:reset",{log:false})}function boot(){if(e!=="configuring"){console.error("Unpoly has already booted");return}let t=supportIssue();if(t)console.error("Unpoly cannot boot: %s",t);else{e="booting";up.emit("up:framework:boot",{log:false});e="booted";up.emit("up:framework:booted",{log:false})}}function mustBootManually(){let e=document.currentScript;return!!e?.async||(e?.getAttribute("up-boot")==="manual"||(document.readyState==="complete"||void 0))}function onEvaled(){up.emit("up:framework:evaled",{log:false});mustBootManually()?console.debug("Call up.boot() after you have configured Unpoly"):document.addEventListener("DOMContentLoaded",boot);e="configuring"}function startExtension(){if(e!=="configuring")throw new Error("Unpoly extensions must be loaded before booting");e="evaling"}function stopExtension(){e="configuring"}function isSupported(){return!supportIssue()}function supportIssue(){for(let e of["URL","Proxy","Promise","DOMParser","FormData"])if(!window[e])return`Browser doesn't support the ${e} API`;if(document.compatMode==="BackCompat")return"Browser is in quirks mode (missing DOCTYPE?)"}return{onEvaled:onEvaled,boot:boot,startExtension:startExtension,stopExtension:stopExtension,reset:emitReset,get evaling(){return e==="evaling"},get booted(){return e==="booted"},get beforeBoot(){return e!=="booting"&&e!=="booted"},isSupported:isSupported}}();up.boot=up.framework.boot},()=>{up.event=function(){const e=up.util;const t=up.element;function reset(){for(let e of[window,document,t.root,document.body])for(let t of up.EventListener.allNonDefault(e))t.unbind()}function on(...e){return buildListenerGroup(e).bind()}function off(...e){return buildListenerGroup(e).unbind()}function buildListenerGroup(e,t){return up.EventListenerGroup.fromBindArgs(e,t)}function buildEmitter(e){return up.EventEmitter.fromEmitArgs(e)}function emit(...e){return buildEmitter(e).emit()}function build(...t){const r=e.extractOptions(t);const n=t[0]||r.type||up.fail("Missing event type");const s=new Event(n,{bubbles:true,cancelable:true});Object.assign(s,e.omit(r,["type","target"]));return s}function assertEmitted(...e){return buildEmitter(e).assertEmitted()}function onEscape(e){return on("keydown",(function(t){if(t.key==="Escape")return e(t)}))}function halt(e,t={}){t.log&&up.log.putsEvent(e);e.stopImmediatePropagation();e.preventDefault()}const r=["metaKey","shiftKey","ctrlKey","altKey"];function isUnmodified(t){return(e.isUndefined(t.button)||t.button===0)&&!e.some(r,(e=>t[e]))}function isSyntheticClick(t){return e.isMissing(t.clientX)}function fork(t,r,n=[]){const s=build(r,e.pick(t,n));s.originalEvent=t;["stopPropagation","stopImmediatePropagation","preventDefault"].forEach((function(e){const r=s[e];return s[e]=function(){t[e]();return r.call(s)}}));t.defaultPrevented&&s.preventDefault();return s}function executeEmitAttr(e,r){if(!isUnmodified(e))return;const n=t.attr(r,"up-emit");const s=t.jsonAttr(r,"up-emit-props");const i=fork(e,n);Object.assign(i,s);up.emit(r,i)}on("up:click","[up-emit]",executeEmitAttr);let n=["unknown"];function getInputDevice(){return e.last(n)}function observeInputDevice(e){n.push(e);setTimeout((()=>n.pop()))}on("keydown keyup",{capture:true},(()=>observeInputDevice("key")));on("pointerdown pointerup",{capture:true},(()=>observeInputDevice("pointer")));on("up:framework:reset",reset);return{on:on,off:off,build:build,emit:emit,assertEmitted:assertEmitted,onEscape:onEscape,halt:halt,isUnmodified:isUnmodified,isSyntheticClick:isSyntheticClick,fork:fork,keyModifiers:r,get inputDevice(){return getInputDevice()}}}();up.on=up.event.on;up.off=up.event.off;up.emit=up.event.emit},()=>{up.protocol=function(){const e=up.util;const t=up.element;const headerize=function(e){const t=e.replace(/(^.|[A-Z])/g,(e=>"-"+e.toUpperCase()));return"X-Up"+t};const extractHeader=function(t,r,n=e.identity){let s=t.getResponseHeader(headerize(r));if(s)return n(s)};function targetFromXHR(e){return extractHeader(e,"target")}function parseModifyCacheValue(e){return e!=="false"&&e}function evictCacheFromXHR(e){return extractHeader(e,"evictCache",parseModifyCacheValue)}function expireCacheFromXHR(e){return extractHeader(e,"expireCache")||up.migrate.clearCacheFromXHR?.(e)}function contextFromXHR(e){return extractHeader(e,"context",JSON.parse)}function methodFromXHR(t){return extractHeader(t,"method",e.normalizeMethod)}function titleFromXHR(e){return up.migrate.titleFromXHR?.(e)??extractHeader(e,"title",JSON.parse)}function eventPlansFromXHR(e){return extractHeader(e,"events",JSON.parse)}function acceptLayerFromXHR(e){return extractHeader(e,"acceptLayer",JSON.parse)}function dismissLayerFromXHR(e){return extractHeader(e,"dismissLayer",JSON.parse)}const r=e.memoize((function(){return e.normalizeMethod(up.browser.popCookie("_up_method"))}));function locationFromXHR(e){return extractHeader(e,"location")||e.responseURL}const n=new up.Config((()=>({methodParam:"_method",csrfParam(){return t.metaContent("csrf-param")},csrfToken(){return t.metaContent("csrf-token")},cspNonce(){return t.metaContent("csp-nonce")},csrfHeader:"X-CSRF-Token",maxHeaderSize:2048})));function csrfHeader(){return e.evalOption(n.csrfHeader)}function csrfParam(){return e.evalOption(n.csrfParam)}function csrfToken(){return e.evalOption(n.csrfToken)}function cspNonce(){return e.evalOption(n.cspNonce)}function cspNoncesFromHeader(e){let t=[];if(e){let r=e.split(/\s*;\s*/);for(let e of r)if(e.indexOf("script-src")===0){let r=/'nonce-([^']+)'/g;let n;while(n=r.exec(e))t.push(n[1])}}return t}function wrapMethod(e,t){t.add(n.methodParam,e);return"POST"}return{config:n,locationFromXHR:locationFromXHR,titleFromXHR:titleFromXHR,targetFromXHR:targetFromXHR,methodFromXHR:methodFromXHR,acceptLayerFromXHR:acceptLayerFromXHR,contextFromXHR:contextFromXHR,dismissLayerFromXHR:dismissLayerFromXHR,eventPlansFromXHR:eventPlansFromXHR,expireCacheFromXHR:expireCacheFromXHR,evictCacheFromXHR:evictCacheFromXHR,csrfHeader:csrfHeader,csrfParam:csrfParam,csrfToken:csrfToken,cspNonce:cspNonce,initialRequestMethod:r,headerize:headerize,wrapMethod:wrapMethod,cspNoncesFromHeader:cspNoncesFromHeader}}()},()=>{up.log=function(){const e=up.util;const t=new up.LogConfig;function printToStandard(...e){t.enabled&&printToStream("log",...e)}const printToWarn=(...e)=>printToStream("warn",...e);const printToError=(...e)=>printToStream("error",...e);function printToStream(e,t,r,...n){printToStreamStyled(e,t,"",r,...n)}function printToStreamStyled(r,n,s,i,...o){i&&(t.format?console[r](`%c${n}%c ${i}`,"color: #666666; padding: 1px 3px; border: 1px solid #bbbbbb; border-radius: 2px; font-size: 90%; display: inline-block;"+s,"",...o):console[r](`[${n}] ${e.sprintf(i,...o)}`))}function printUserEvent(e){if(t.enabled){e=e.originalEvent||e;let t="#5566cc";printToStreamStyled("log",e.type,`color: white; border-color: ${t}; background-color: ${t}`,"Interaction on %o",e.target)}}function printBanner(){if(!t.banner)return;const e=` __ _____  ___  ___  / /_ __\n/ // / _ \\/ _ \\/ _ \\/ / // /  ${up.version}\n\\___/_//_/ .__/\\___/_/\\_. / \n        / /            / /\n\n`;let r="";up.migrate.loaded||(r+="Load unpoly-migrate.js to polyfill deprecated APIs.\n\n");t.enabled?r+="Call `up.log.disable()` to disable logging for this session.":r+="Call `up.log.enable()` to enable logging for this session.";const n="color: #777777";t.format?console.log("%c"+e+"%c"+r,"font-family: monospace;"+n,n):console.log(e+r)}up.on("up:framework:boot",printBanner);function enable(){t.enabled=true}function disable(){t.enabled=false}return{puts:printToStandard,putsEvent:printUserEvent,error:printToError,warn:printToWarn,config:t,enable:enable,disable:disable}}();up.puts=up.log.puts;up.warn=up.log.warn},()=>{up.script=function(){const e=up.util;const t=up.element;const r=new up.Config((()=>({assetSelectors:["link[rel=stylesheet]","script[src]","[up-asset]"],noAssetSelectors:["[up-asset=false]"],nonceableAttributes:["up-watch","up-on-accepted","up-on-dismissed","up-on-loaded","up-on-rendered","up-on-finished","up-on-error","up-on-offline"],scriptSelectors:["script"],noScriptSelectors:['script[type="application/ld+json"]']})));const n={"[up-back]":-100,"[up-clickable]":-200,"[up-drawer]":-200,"[up-modal]":-200,"[up-cover]":-200,"[up-popup]":-200,"[up-tooltip]":-200,"[up-dash]":-200,"[up-flashes]":-200,"[up-expand]":-300,"[data-method]":-400,"[data-confirm]":-400};let s=[];let i=[];function registerCompiler(...e){registerProcessor(e)}function registerMacro(...e){registerProcessor(e,{macro:true})}function registerAttrCompiler(...e){let[r,n,s]=parseProcessorArgs(e);let i=`[${r}]`;let callback=e=>{let i=t.booleanOrStringAttr(e,r,n.defaultValue);if(i)return s(e,i)};registerProcessor([i,n,callback])}function detectSystemMacroPriority(t){t=e.evalOption(t);for(let e in n)if(t.indexOf(e)>=0)return n[e];up.fail("Unregistered priority for system macro %o",t)}function registerProcessor(e,t={}){let r=buildProcessor(e,t);if(r.macro){up.framework.evaling&&(r.priority||=detectSystemMacroPriority(r.selector));insertProcessor(i,r)}else insertProcessor(s,r)}const parseProcessorArgs=function(t){const r=e.extractOptions(t);const n=t.shift();const s=t.pop();const i={...r,...e.extractOptions(t)};return[n,i,s]};function buildProcessor(t,r){let[n,s,i]=parseProcessorArgs(t);s=e.options(s,{selector:n,isDefault:up.framework.evaling,priority:0,batch:false});return Object.assign(i,s,r)}function insertProcessor(e,t){let r;let n=0;while((r=e[n])&&r.priority>=t.priority)n+=1;e.splice(n,0,t);if(up.framework.booted)if(t.priority===0)for(let e of up.layer.stack)compile(e.element,{layer:e,compilers:[t]});else up.puts("up.compiler()","Compiler %s was registered after booting Unpoly. Compiler will run for future fragments only.",t.selector);return t}function compile(e,t){up.emit(e,"up:fragment:compile",{log:false});let r=t.compilers||i.concat(s);const n=new up.CompilerPass(e,r,t);n.run()}function registerDestructor(t,r){let n=t.upDestructors;if(!n){n=[];t.upDestructors=n;t.classList.add("up-can-clean")}e.isArray(r)?n.push(...r):n.push(r)}function hello(e,t={}){e=up.fragment.get(e,t);up.puts("up.hello()","Compiling fragment %o",e);compile(e,t);up.fragment.emitInserted(e);return e}function clean(e,t={}){new up.DestructorPass(e,t).run()}function readData(e){e=up.fragment.get(e);return e.upData||=buildData(e)}function buildData(t){if(!t.getAttribute)return{};let r=t.getAttribute("up-data");let n;if(r){n=JSON.parse(r);if(!e.isOptions(n))return n}return{...t.dataset,...n,...t.upCompileData}}function findAssets(e=document.head){return e.querySelectorAll(r.selector("assetSelectors"))}function assertAssetsOK(t,r){let n=findAssets();let s=e.map(n,"outerHTML").join();let i=e.map(t,"outerHTML").join();s!==i&&up.event.assertEmitted("up:assets:changed",{oldAssets:n,newAssets:t,renderOptions:r})}function disableScript(e){e.type="up-disabled-script"}function disableScriptsInSubtree(n){let s=r.selector("scriptSelectors");e.each(t.subtree(n,s),disableScript)}function reset(){s=e.filter(s,"isDefault");i=e.filter(i,"isDefault")}up.on("up:framework:reset",reset);return{config:r,compiler:registerCompiler,macro:registerMacro,attrCompiler:registerAttrCompiler,destructor:registerDestructor,hello:hello,clean:clean,data:readData,findAssets:findAssets,assertAssetsOK:assertAssetsOK,disableSubtree:disableScriptsInSubtree}}();up.compiler=up.script.compiler;up.destructor=up.script.destructor;up.macro=up.script.macro;up.data=up.script.data;up.hello=up.script.hello;up.attribute=up.script.attrCompiler},()=>{up.history=function(){const e=up.util;const t=up.element;const r=new up.Config((()=>({enabled:true,updateMetaTags:true,restoreTargets:["body"],metaTagSelectors:["meta","link[rel=alternate]","link[rel=canonical]","link[rel=icon]","[up-meta]",'script[type="application/ld+json"]'],noMetaTagSelectors:["meta[http-equiv]","[up-meta=false]","meta[name=csp-nonce]"]})));let n;let s;function reset(){n=void 0;s=void 0;trackCurrentLocation()}function currentLocation(){return e.normalizeURL(location.href)}function trackCurrentLocation(){const e=currentLocation();if(s!==e){n=s;s=e}}trackCurrentLocation();function isLocation(t,r){return e.matchURLs(t,location.href,{hash:true,...r})}function replace(t,r={}){t=e.normalizeURL(t);manipulate("replaceState",t)&&r.event!==false&&emitLocationChanged({location:t,reason:"replace",log:`Replaced state for ${t}`})}function push(t){t=e.normalizeURL(t);!isLocation(t)&&manipulate("pushState",t)&&emitLocationChanged({location:t,reason:"push",log:`Advanced to location ${t}`})}function emitLocationChanged(e){let t=up.event.build("up:location:changed",e);up.migrate?.renamedProperty?.(t,"url","location");up.emit(t)}function manipulate(e,t){if(r.enabled){const r=buildState();window.history[e](r,"",t);trackCurrentLocation();return true}}function buildState(){return{up:{}}}function restoreStateOnPop(e){if(!e?.up){up.puts("popstate","Ignoring a history state not owned by Unpoly");return}let t=currentLocation();up.error.muteUncriticalRejection(up.render({guardEvent:up.event.build("up:location:restore",{location:t,log:`Restoring location ${t}`}),url:t,target:r.restoreTargets,fail:false,history:true,location:t,peel:true,layer:"root",cache:"auto",revalidate:"auto",saveScroll:false,scroll:["restore","auto"],saveFocus:false,focus:["restore","auto"]}))}function onPop(e){trackCurrentLocation();let t=currentLocation();emitLocationChanged({location:t,reason:"pop",log:`Navigated to history entry ${t}`});up.viewport.saveFocus({location:n});up.viewport.saveScroll({location:n});restoreStateOnPop(e.state)}function register(){window.addEventListener("popstate",onPop);up.protocol.initialRequestMethod()==="GET"&&replace(currentLocation(),{event:false})}up.on("up:framework:boot",(function(){"jasmine"in window?register():setTimeout(register,100)}));function findMetaTags(e=document.head){return e.querySelectorAll(r.selector("metaTagSelectors"))}function updateMetaTags(e){let t=findMetaTags();for(let e of t)e.remove();for(let t of e)document.head.append(t)}function getLang(e=document){let{documentElement:t}=e;if(t.matches("html"))return e.documentElement.lang}function updateLang(e){t.toggleAttr(t.root,"lang",e,!!e)}up.macro("[up-back]",(function(e){if(n){t.setMissingAttrs(e,{"up-href":n,"up-scroll":"restore"});e.removeAttribute("up-back");up.link.makeFollowable(e)}}));up.on("up:framework:reset",reset);return{config:r,push:push,replace:replace,get location(){return currentLocation()},get previousLocation(){return n},isLocation:isLocation,findMetaTags:findMetaTags,updateMetaTags:updateMetaTags,getLang:getLang,updateLang:updateLang}}()},(e,t,r)=>{r(87);const n=up.util;const s=up.element;up.fragment=function(){function upTagName(e){let t=s.tagName(e);if(t.startsWith("up-"))return t}const e=new up.Config((()=>({badTargetClasses:[/^up-/],targetDerivers:["[up-id]","[id]","html","head","body","main","[up-main]",upTagName,"link[rel][type]","link[rel=preload][href]","link[rel=preconnect][href]","link[rel=prefetch][href]","link[rel]","meta[property]","*[name]","form[action]","a[href]","[class]","[up-flashes]","form"],verifyDerivedTarget:true,navigateOptions:{cache:"auto",revalidate:"auto",feedback:true,fallback:true,focus:"auto",scroll:"auto",history:"auto",peel:true},match:"region",runScripts:true,autoHistoryTargets:[":main"],autoFocus:["hash","autofocus","main-if-main","keep","target-if-lost"],autoScroll:["hash","layer-if-main"],autoRevalidate:e=>e.expired,skipResponse:defaultSkipResponse})));n.delegate(e,["mainTargets"],(()=>up.layer.config.any));function defaultSkipResponse({response:e,expiredResponse:t}){return!e.text||e.text===t?.text}function sourceOf(e,t={}){e=getSmart(e,t);return s.closestAttr(e,"up-source")}function normalizeSource(e){return n.normalizeURL(e,{hash:false})}function timeOf(e){let t=s.closestAttr(e,"up-time");if(t&&t!=="false"){/^\d+$/.test(t)&&(t=Number(t)*1e3);return new Date(t)}}function etagOf(e){let t=s.closestAttr(e,"up-etag");if(t&&t!=="false")return t}const t=up.mockable(((...e)=>{let t=parseTargetAndOptions(e);return new up.RenderJob(t).execute()}));const r=up.mockable(((...e)=>{const r=parseTargetAndOptions(e);return t({...r,navigate:true})}));function emitFragmentInserted(e){return up.emit(e,"up:fragment:inserted",{log:["Inserted fragment %o",e]})}function emitFragmentKeep(e){let{oldElement:t,newElement:r,newData:n,renderOptions:i}=e;const o=["Keeping fragment %o",t];const a=s.callbackAttr(t,"up-on-keep",{exposedKeys:["newFragment","newData"]});return up.emit(t,"up:fragment:keep",{newFragment:r,newData:n,renderOptions:i,log:o,callback:a})}function emitFragmentDestroyed(e,t){const r=t.log??["Destroyed fragment %o",e];const n=t.parent||document;return up.emit(n,"up:fragment:destroyed",{fragment:e,parent:n,log:r})}function isNotDestroying(e){return!e.closest(".up-destroying")}function isAlive(e){return e.isConnected&&isNotDestroying(e)}function getSmart(...e){const t=n.extractOptions(e);const r=e.pop();const i=e[0];return n.isElementish(r)?s.get(r):i?getDumb(i,r,t):new up.FragmentFinder({selector:r,origin:t.origin,layer:t.layer,match:t.match}).find()}function getDumb(...e){return getAll(...e)[0]}function getAll(...e){const t=n.extractOptions(e);let r=e.pop();const s=e[0];if(n.isElement(r))return[r];if(n.isList(r))return r;let i=new up.Selector(r,s,t);return i.descendants(s)}function getSubtree(e,t,r={}){return new up.Selector(t,e,r).subtree(e)}function contains(e,t){return n.isElement(t)?s.contains(e,t)&&up.layer.get(e).contains(t):getSubtree(e,t).length>0}function closest(e,t,r){return new up.Selector(t,e,r).closest(e)}function destroy(...e){const t=parseTargetAndOptions(e);(t.element=getSmart(t.target,t))&&new up.Change.DestroyFragment(t).execute();return up.migrate.formerlyAsync?.("up.destroy()")}function parseTargetAndOptions(e){const t=n.parseArgIntoOptions(e,"target");n.isElement(t.target)&&(t.origin||=t.target);return t}function markFragmentAsDestroying(e){e.classList.add("up-destroying");e.setAttribute("aria-hidden","true")}function reload(...e){const r=parseTargetAndOptions(e);r.target||=":main";const i=getSmart(r.target,r);r.url||=sourceOf(i);r.headers=n.merge(r.headers,conditionalHeaders(i));(r.keepData||s.booleanAttr(i,"up-keep-data"))&&(r.data=up.data(i));up.migrate.postprocessReloadOptions?.(r);return t(r)}function conditionalHeaders(e){let t={};let r=timeOf(e);r&&(t["If-Modified-Since"]=r.toUTCString());let n=etagOf(e);n&&(t["If-None-Match"]=n);return t}function visit(e,t){return r({...t,url:e})}const i=/^(onFail|on|fail)?(.+)$/;function successKey(e){let t=i.exec(e);if(t){let[e,r,s]=t;switch(r){case"onFail":return"on"+n.upperCaseFirst(s);case"fail":return n.lowerCaseFirst(s)}}}function failKey(e){let t=i.exec(e);if(t){let[e,r,s]=t;switch(r){case"on":return"onFail"+n.upperCaseFirst(s);case void 0:return"fail"+n.upperCaseFirst(s)}}}function toTarget(e,t){return n.presence(e,n.isString)||tryToTarget(e,t)||cannotTarget(e)}function isTargetable(e){return!!tryToTarget(e)}function untargetableMessage(e){return`Cannot derive good target selector from a <${s.tagName(e)}> element without identifying attributes. Try setting an [id] or configure up.fragment.config.targetDerivers.`}function cannotTarget(e){throw new up.CannotTarget(untargetableMessage(e))}function tryToTarget(t,r){return n.findResult(e.targetDerivers,(function(e){let n=deriveTarget(t,e);if(n&&isGoodTarget(n,t,r))return n}))}function deriveTarget(e,t){if(n.isFunction(t))return t(e);if(e.matches(t))try{return deriveTargetFromPattern(e,t)}catch(e){if(e instanceof up.CannotParse)return t;throw e}}function deriveTargetFromPattern(e,t){let{includePath:r,excludeRaw:n}=up.element.parseSelector(t);if(r.length!==1)throw new up.CannotParse(t);let{tagName:i,id:o,classNames:a,attributes:u}=r[0];let l="";i==="*"?l+=s.tagName(e):i&&(l+=i);for(let e of a)l+=s.classSelector(e);o&&(l+=s.idSelector(o));for(let t in u){let r=u[t]||e.getAttribute(t);if(t==="id")l+=s.idSelector(r);else if(t==="class")for(let t of goodClassesForTarget(e))l+=s.classSelector(t);else l+=s.attrSelector(t,r)}n&&(l+=n);return l}function isGoodTarget(t,r,n={}){return!isAlive(r)||!e.verifyDerivedTarget||up.fragment.get(t,{layer:r,...n})===r}function matchesPattern(e,t){return n.isRegExp(e)?e.test(t):e===t}function goodClassesForTarget(t){let isGood=t=>!n.some(e.badTargetClasses,(e=>matchesPattern(e,t)));return n.filter(t.classList,isGood)}const o=/:main\b/;const a=/:layer\b/;const u=/:origin\b/;function containsMainPseudo(e){return o.test(e)}function expandTargets(e,t={}){const{layer:r}=t;r==="new"||r instanceof up.Layer||up.fail("Must pass an up.Layer as { layer } option, but got %o",r);e=n.copy(n.wrapList(e));const s=[];while(e.length){let i=e.shift();i===true&&(i=":main");if(containsMainPseudo(i)){let r=resolveMode(t);let n=up.layer.mainTargets(r).map((e=>i.replace(o,e)));e.unshift(...n)}else if(a.test(i)){if(r==="new"||r.opening)continue;let n=toTarget(r.getFirstSwappableElement(),t);e.unshift(i.replace(a,n))}else n.isElementish(i)?s.push(toTarget(i,t)):n.isString(i)&&s.push(resolveOrigin(i,t))}return n.uniq(s)}function resolveMode({layer:e,mode:t}){return e==="new"?t||up.fail('Must pass a { mode } option together with { layer: "new" }'):e.mode}function modernResolveOrigin(e,{origin:t}={}){return e.replace(u,(function(r){if(t)return toTarget(t);up.fail('Missing { origin } element to resolve "%s" reference (found in %s)',r,e)}))}function resolveOrigin(...e){return(up.migrate.resolveOrigin||modernResolveOrigin)(...e)}function splitTarget(e){return n.parseTokens(e,{separator:"comma"})}function parseTargetSteps(e,t={}){let r=t.defaultPlacement||"swap";let n=t.defaultMaybe??false;let s=[];let i=splitTarget(e);for(let e of i){if(e===":none")continue;let i=r;let o=n;e=e.replace(/\b::?(before|after)\b/,((e,t)=>{i=t;return""}));e=e.replace(/\b:maybe\b/,(()=>{o=true;return""}));const a={...t,selector:e,placement:i,maybe:o,originalRenderOptions:t};s.push(a)}return s}function hasAutoHistory(t,r){let n=expandTargets(e.autoHistoryTargets,{layer:r}).join();for(let e of t)if(s.subtree(e,n).length)return true;up.puts("up.render()","Will not auto-update history because fragment doesn't contain a selector from up.fragment.config.autoHistoryTargets");return false}function matches(e,t,r={}){e=s.get(e);if(n.isElement(t)){let r=tryToTarget(t);return r&&e.matches(r)}return new up.Selector(t,e,r).matches(e)}function shouldRevalidate(t,r,s={}){return t.fromCache&&n.evalAutoOption(s.revalidate,e.autoRevalidate,r)}function targetForSteps(e){let t=e.filter((e=>!e.maybe||e.oldElement?.isConnected));let r=n.map(t,"selector");return r.join(", ")||":none"}function isContainedByRivalStep(e,t){return n.some(e,(function(e){return e!==t&&(e.placement==="swap"||e.placement==="content")&&e.oldElement.contains(t.oldElement)}))}function compressNestedSteps(e){if(e.length<2)return e;let t=n.uniqBy(e,"oldElement");t=n.reject(t,(e=>isContainedByRivalStep(t,e)));return t}function abort(...e){let t=parseTargetAndOptions(e);let r;let{reason:s,newLayer:i}=t;let o;if(t.target){o=getAll(t.target,t);r=e=>e.isPartOfSubtree(o);s||="Aborting requests within fragment"}else{let e=up.layer.getAll(t);o=n.map(e,"element");r=t=>n.contains(e,t.layer);s||="Aborting requests within "+e.join(", ")}let testFnWithAbortable=e=>e.abortable&&r(e);up.network.abort(testFnWithAbortable,{...t,reason:s});for(let e of o)up.emit(e,"up:fragment:aborted",{reason:s,newLayer:i,log:false})}function onAborted(e,t){let guard=t=>t.target.contains(e);let r=up.on("up:fragment:aborted",{guard:guard},t);up.destructor(e,r);return r}function onFirstIntersect(e,t,{margin:r=0}={}){if(s.isIntersectingWindow(e,{margin:r})){t();return}function processIntersectEntries(e){for(let r of e)if(r.isIntersecting){disconnect();t();return}}let n=new IntersectionObserver(processIntersectEntries,{rootMargin:`${r}px`});let disconnect=()=>n.disconnect();n.observe(e);onAborted(e,disconnect)}up.on("up:framework:boot",(function(){const{documentElement:e}=document;e.setAttribute("up-source",normalizeSource(location.href));up.hello(e);if(!up.browser.canPushState())return up.warn("Cannot push history changes. Next fragment update will load in a new page.")}));return{config:e,reload:reload,destroy:destroy,render:t,navigate:r,get:getSmart,getDumb:getDumb,all:getAll,subtree:getSubtree,contains:contains,closest:closest,source:sourceOf,normalizeSource:normalizeSource,visit:visit,markAsDestroying:markFragmentAsDestroying,emitInserted:emitFragmentInserted,emitDestroyed:emitFragmentDestroyed,emitKeep:emitFragmentKeep,successKey:successKey,failKey:failKey,expandTargets:expandTargets,resolveOrigin:resolveOrigin,toTarget:toTarget,tryToTarget:tryToTarget,isTargetable:isTargetable,matches:matches,hasAutoHistory:hasAutoHistory,time:timeOf,etag:etagOf,shouldRevalidate:shouldRevalidate,abort:abort,onAborted:onAborted,onFirstIntersect:onFirstIntersect,splitTarget:splitTarget,parseTargetSteps:parseTargetSteps,isAlive:isAlive,isNotDestroying:isNotDestroying,targetForSteps:targetForSteps,compressNestedSteps:compressNestedSteps,containsMainPseudo:containsMainPseudo}}();up.reload=up.fragment.reload;up.destroy=up.fragment.destroy;up.render=up.fragment.render;up.navigate=up.fragment.navigate;up.visit=up.fragment.visit;n.delegate(up,["context"],(()=>up.layer.current))},(e,t,r)=>{r.r(t)},(e,t,r)=>{r(89);up.viewport=function(){const e=up.util;const t=up.element;const r=up.fragment;const n=new up.Config((()=>({viewportSelectors:["[up-viewport]","[up-fixed]"],fixedTopSelectors:["[up-fixed~=top]"],fixedBottomSelectors:["[up-fixed~=bottom]"],anchoredRightSelectors:["[up-anchored~=right]","[up-fixed~=top]","[up-fixed~=bottom]","[up-fixed~=right]"],revealSnap:200,revealPadding:0,revealTop:false,revealMax(){return.5*window.innerHeight},autoFocusVisible({element:e,inputDevice:t}){return t==="key"||up.form.isField(e)}})));const s=new up.BodyShifter;up.compiler(n.selectorFn("anchoredRightSelectors"),(function(e){return s.onAnchoredElementInserted(e)}));function reveal(t,n){n=e.options(n);t=r.get(t,n);(n.layer=up.layer.get(t))||up.fail("Cannot reveal a detached element");n.peel&&n.layer.peel();const s=new up.RevealMotion(t,n);s.start();return up.migrate.formerlyAsync?.("up.reveal()")||true}function doFocus(t,{preventScroll:r,force:s,inputDevice:i,focusVisible:o}={}){s&&(t.hasAttribute("tabindex")||t.tabIndex!==-1||t.setAttribute("tabindex","-1"));i??=up.event.inputDevice;o??="auto";o=e.evalAutoOption(o,n.autoFocusVisible,{element:t,inputDevice:i});t.focus({preventScroll:true,focusVisible:o});removeFocusClasses(t);t.classList.add(o?"up-focus-visible":"up-focus-hidden");if(!r)return reveal(t)}function removeFocusClasses(e){e?.classList.remove("up-focus-hidden","up-focus-visible")}up.on("focusin",(function({relatedTarget:e}){removeFocusClasses(e)}));function tryFocus(e,t){doFocus(e,t);return e===document.activeElement}function revealHash(e=location.hash,t){let r=firstHashTarget(e,t);if(r)return up.reveal(r,{top:true})}function allSelector(){return[rootSelector(),...n.viewportSelectors].join()}function closest(e,t={}){const n=r.get(e,t);return n.closest(allSelector())}function getSubtree(e,n={}){e=r.get(e,n);return t.subtree(e,allSelector())}function getAround(e,n={}){e=r.get(e,n);return t.around(e,allSelector())}function getAll(e={}){return r.all(allSelector(),e)}function rootSelector(){return getRoot().tagName}function getRoot(){return document.scrollingElement}function rootWidth(){return t.root.clientWidth}function rootHeight(){return t.root.clientHeight}function isRoot(e){return e===getRoot()}function rootScrollbarWidth(){return window.innerWidth-rootWidth()}function scrollTopKey(e){return up.fragment.tryToTarget(e)}function fixedElements(e=document){const t=["[up-fixed]"].concat(n.fixedTopSelectors).concat(n.fixedBottomSelectors);return e.querySelectorAll(t.join())}function saveScroll(...e){const[t,r]=parseOptions(e);const n=r.location||r.layer.location;if(n){const e=getScrollTopsForSave(t);r.layer.lastScrollTops.set(n,e)}}function getScrollTopsForSave(e){let t={};for(let r of e){let e=scrollTopKey(r);e?t[e]=r.scrollTop:up.warn("up.viewport.saveScroll()","Cannot save scroll positions for untargetable viewport %o",r)}return t}function restoreScroll(...e){const[t,r]=parseOptions(e);const{location:n}=r.layer;const s=r.layer.lastScrollTops.get(n);if(s){setScrollTops(t,s);up.puts("up.viewport.restoreScroll()","Restored scroll positions to %o",s);return true}return false}function saveFocus(e={}){const t=up.layer.get(e);const r=e.location||t.location;if(r){const e=up.FocusCapsule.preserve(t);t.lastFocusCapsules.set(r,e)}}function restoreFocus(e={}){const t=up.layer.get(e);const r=e.location||t.location;const n=e.layer.lastFocusCapsules.get(r);if(n&&n.restore(t)){up.puts("up.viewport.restoreFocus()",'Restored focus to "%s"',n.target);return true}return false}function newStateCache(){return new up.FIFOCache({capacity:30,normalizeKey:e.matchableURL})}function parseOptions(t){const r=e.copy(e.extractOptions(t));r.layer=up.layer.get(r);let n;n=t[0]?[closest(t[0],r)]:r.around?getAround(r.around,r):getAll(r);return[n,r]}function resetScroll(...e){const[t,r]=parseOptions(e);setScrollTops(t,{})}function setScrollTops(e,t){for(let r of e){const e=scrollTopKey(r);r.scrollTop=t[e]||0}}function absolutize(r,n={}){const s=closest(r);const i=s.getBoundingClientRect();const o=r.getBoundingClientRect();const a=new up.Rect({left:o.left-i.left,top:o.top-i.top,width:o.width,height:o.height});n.afterMeasure?.();t.setStyle(r,{position:r.style.position==="static"?"static":"relative",top:"auto",right:"auto",bottom:"auto",left:"auto",width:"100%",height:"100%"});const u=t.createFromSelector("up-bounds");t.insertBefore(r,u);u.appendChild(r);const moveBounds=function(e,r){a.left+=e;a.top+=r;return t.setStyle(u,a,"px")};moveBounds(0,0);const l=r.getBoundingClientRect();moveBounds(o.left-l.left,o.top-l.top);e.each(fixedElements(r),t.fixedToAbsolute);return{bounds:u,moveBounds:moveBounds}}function firstHashTarget(e,n={}){if(e=pureHash(e)){const s=[t.attrSelector("id",e),"a"+t.attrSelector("name",e)].join();return r.get(s,n)}}function pureHash(e){return e?.replace(/^#/,"")}function focusedElementWithin(e){const t=document.activeElement;if(up.fragment.contains(e,t))return t}const i=["selectionStart","selectionEnd","scrollLeft","scrollTop"];function copyCursorProps(e,t={}){for(let r of i)try{t[r]=e[r]}catch(e){}return t}let o=false;up.on("scroll",{once:true,beforeBoot:true},(()=>o=true));up.on("up:framework:boot",(function(){e.task((function(){if(!o)return revealHash()}))}));up.on(window,"hashchange",(()=>revealHash()));return{reveal:reveal,revealHash:revealHash,firstHashTarget:firstHashTarget,config:n,get:closest,subtree:getSubtree,around:getAround,get root(){return getRoot()},rootWidth:rootWidth,rootHeight:rootHeight,isRoot:isRoot,rootScrollbarWidth:rootScrollbarWidth,saveScroll:saveScroll,restoreScroll:restoreScroll,resetScroll:resetScroll,saveFocus:saveFocus,restoreFocus:restoreFocus,absolutize:absolutize,focus:doFocus,tryFocus:tryFocus,newStateCache:newStateCache,focusedElementWithin:focusedElementWithin,copyCursorProps:copyCursorProps,bodyShifter:s}}();up.focus=up.viewport.focus;up.reveal=up.viewport.reveal},(e,t,r)=>{r.r(t)},()=>{up.motion=function(){const e=up.util;const t=up.element;let r={};let n={};const s=new up.MotionController("motion");const i=new up.Config((()=>({duration:175,easing:"ease",enabled:!matchMedia("(prefers-reduced-motion: reduce)").matches})));function pickDefault(t){return e.pickBy(t,"isDefault")}function reset(){s.reset();r=pickDefault(r);n=pickDefault(n)}function isEnabled(){return i.enabled}function animate(t,r,n){t=up.fragment.get(t);n=e.options(n);let i=findAnimationFn(r);const o=willAnimate(t,r,n);i=up.error.guardFn(i);if(o){const runNow=()=>i(t,n);return s.startFunction(t,runNow,n)}return skipAnimate(t,r)}function willAnimate(e,r,n){applyConfig(n);return isEnabled()&&!isNone(r)&&n.duration>0&&!t.isSingleton(e)}function skipAnimate(r,n){e.isOptions(n)&&t.setStyle(r,n);return Promise.resolve()}function animateNow(e,t,r){up.migrate.loaded&&(t=up.migrate.fixStyleProps(t));r={...r,finishEvent:s.finishEvent};const n=new up.CSSTransition(e,t,r);return n.start()}function applyConfig(e){e.easing??=i.easing;e.duration??=i.duration}function findNamedAnimation(e){return r[e]||up.fail("Unknown animation %o",e)}function finish(e){return s.finish(e)}function morph(r,n,i,a){a=e.options(a);applyConfig(a);r=up.fragment.get(r);n=up.fragment.get(n);let u=findTransitionFn(i);const l=willAnimate(r,u,a);u=up.error.guardFn(u);const c=e.pluckKey(a,"beforeStart")||e.noop;const p=e.pluckKey(a,"afterInsert")||e.noop;const h=e.pluckKey(a,"beforeDetach")||e.noop;const d=e.pluckKey(a,"afterDetach")||e.noop;const f=e.pluckKey(a,"scrollNew")||e.noop;c();if(l){if(s.isActive(r)&&a.trackMotion===false)return u(r,n,a);up.puts("up.morph()","Morphing %o to %o with transition %O over %d ms",r,n,i,a.duration);const e=up.viewport.get(r);const o=e.scrollTop;const l=up.viewport.absolutize(r,{afterMeasure(){t.insertBefore(r,n);p()}});const trackable=async function(){f();const t=e.scrollTop;l.moveBounds(0,t-o);await u(r,n,a);h();l.bounds.remove();d()};return s.startFunction([r,n],trackable,a)}h();o(r,n);p();d();f();return Promise.resolve()}function findTransitionFn(t){if(!isNone(t)){if(e.isFunction(t))return t;if(e.isArray(t))return composeTransitionFn(...t);if(e.isString(t)){let e;if(t.indexOf("/")>=0)return composeTransitionFn(...t.split("/"));if(e=n[t])return findTransitionFn(e)}else up.fail("Unknown transition %o",t)}}function composeTransitionFn(t,r){if(!isNone(t)&&!isNone(r)){const n=findAnimationFn(t)||e.asyncNoop;const s=findAnimationFn(r)||e.asyncNoop;return(e,t,r)=>Promise.all([n(e,r),s(t,r)])}}function findAnimationFn(t){if(!isNone(t)){if(e.isFunction(t))return t;if(e.isString(t))return findNamedAnimation(t);if(e.isOptions(t))return(e,r)=>animateNow(e,t,r);up.fail("Unknown animation %o",t)}}const o=up.mockable((function(e,t){e.replaceWith(t)}));function motionOptions(t,r,n){r=e.options(r);let s=new up.OptionsParser(t,r,n);s.booleanOrString("animation");s.booleanOrString("transition");s.string("easing");s.number("duration");return r}function registerTransition(e,t){const r=findTransitionFn(t);r.isDefault=up.framework.evaling;n[e]=r}function registerAnimation(e,t){const n=findAnimationFn(t);n.isDefault=up.framework.evaling;r[e]=n}up.on("up:framework:boot",(function(){isEnabled()||up.puts("up.motion","Animations are disabled")}));function isNone(e){return!e||e==="none"}function registerOpacityAnimation(e,r,n){registerAnimation(e,(function(e,s){e.style.opacity=0;t.setStyle(e,{opacity:r});return animateNow(e,{opacity:n},s)}))}registerOpacityAnimation("fade-in",0,1);registerOpacityAnimation("fade-out",1,0);function translateCSS(e,t){return{transform:`translate(${e}px, ${t}px)`}}function noTranslateCSS(){return{transform:""}}function untranslatedBox(e){t.setStyle(e,noTranslateCSS());return e.getBoundingClientRect()}function registerMoveAnimations(e,r){const n=`move-to-${e}`;const s=`move-from-${e}`;registerAnimation(n,(function(e,t){const n=untranslatedBox(e);const s=r(n);return animateNow(e,s,t)}));registerAnimation(s,(function(e,n){const s=untranslatedBox(e);const i=r(s);t.setStyle(e,i);return animateNow(e,noTranslateCSS(),n)}))}registerMoveAnimations("top",(function(e){const t=e.top+e.height;return translateCSS(0,-t)}));registerMoveAnimations("bottom",(function(e){const t=up.viewport.rootHeight()-e.top;return translateCSS(0,t)}));registerMoveAnimations("left",(function(e){const t=e.left+e.width;return translateCSS(-t,0)}));registerMoveAnimations("right",(function(e){const t=up.viewport.rootWidth()-e.left;return translateCSS(t,0)}));registerTransition("cross-fade",["fade-out","fade-in"]);registerTransition("move-left",["move-to-left","move-from-right"]);registerTransition("move-right",["move-to-right","move-from-left"]);registerTransition("move-up",["move-to-top","move-from-bottom"]);registerTransition("move-down",["move-to-bottom","move-from-top"]);up.on("up:framework:reset",reset);return{morph:morph,animate:animate,finish:finish,finishCount(){return s.finishCount},transition:registerTransition,animation:registerAnimation,config:i,isEnabled:isEnabled,isNone:isNone,willAnimate:willAnimate,swapElementsDirectly:o,motionOptions:motionOptions}}();up.transition=up.motion.transition;up.animation=up.motion.animation;up.morph=up.motion.morph;up.animate=up.motion.animate},(e,t,r)=>{r(92);const n=up.util;up.network=function(){const e=new up.Config((()=>({concurrency:6,wrapMethod:true,cacheSize:70,cacheExpireAge:15e3,cacheEvictAge:54e5,badResponseTime:400,fail(e){return(e.status<200||e.status>299)&&e.status!==304},autoCache(e){return e.isSafe()},expireCache(e,t){return!e.isSafe()},evictCache:false,progressBar:true,timeout:9e4})));const t=new up.Request.Queue;const r=new up.Request.Cache;let s=null;function reset(){abortRequests();t.reset();r.reset();s?.destroy();s=null}function makeRequest(...e){const t=parseRequestOptions(e);const r=new up.Request(t);processRequest(r);return r}function parseRequestOptions(e){const t=n.extractOptions(e);t.url||(t.url=e[0]);up.migrate.handleRequestOptions?.(t);return t}function processRequest(e){useCachedRequest(e)||queueRequest(e)}function useCachedRequest(e){let n;if(e.willCache()&&(n=r.get(e))){up.puts("up.request()","Re-using previous request to %s",e.description);e.background||t.promoteToForeground(n);n.mergeIfUnsent(e);r.track(n,e,{onIncompatible:processRequest});return true}}function queueRequest(e){handleCaching(e);t.asap(e);return true}function handleCaching(t){if(t.willCache()){r.put(t);t.onLoading=()=>r.reindex(t)}n.always(t,(function(s){let i=s.expireCache??t.expireCache??n.evalOption(e.expireCache,t,s);i&&r.expire(i,{except:t});let o=s.evictCache??t.evictCache??n.evalOption(e.evictCache,t,s);o&&r.evict(o,{except:t});let a=r.get(t);let u=s instanceof up.Response;let l=!u;let c=u&&s.ok;let p=u&&!s.ok;let h=u&&s.none;p?r.evict(t.url):l||h?r.evict(t):c&&a&&r.put(t)}))}function isBusy(){return t.isBusy()}function loadPage(e){new up.Request(e).loadPage()}function abortRequests(...e){up.migrate.preprocessAbortArgs?.(e);t.abort(...e)}function registerAliasForRedirect(e,t){if(e.cache&&t.url&&e.url!==t.url){const s=n.variant(e,{method:t.method,url:t.url,cacheRoute:null});r.alias(e,s)}}function isSafeMethod(e){return n.contains(["GET","OPTIONS","HEAD"],n.normalizeMethod(e))}function onLate(){n.evalOption(e.progressBar)&&(s=new up.ProgressBar)}function onRecover(){s?.conclude()}up.on("up:network:late",onLate);up.on("up:network:recover",onRecover);up.on("up:framework:reset",reset);return{request:makeRequest,cache:r,isBusy:isBusy,isSafeMethod:isSafeMethod,config:e,abort:abortRequests,registerAliasForRedirect:registerAliasForRedirect,queue:t,loadPage:loadPage}}();up.request=up.network.request;up.cache=up.network.cache},(e,t,r)=>{r.r(t)},(e,t,r)=>{r(94);const n=up.util;const s=up.element;up.layer=function(){const e=[up.Layer.Root,up.Layer.Modal,up.Layer.Popup,up.Layer.Drawer,up.Layer.Cover];const t=new up.Config((function(){const t={mode:"modal",any:{mainTargets:["[up-main='']","main",":layer"]},root:{mainTargets:["[up-main~=root]"],history:true},overlay:{mainTargets:["[up-main~=overlay]"],openAnimation:"fade-in",closeAnimation:"fade-out",dismissLabel:"Ã—",dismissAriaLabel:"Dismiss dialog",dismissable:true,history:"auto"},cover:{mainTargets:["[up-main~=cover]"]},drawer:{mainTargets:["[up-main~=drawer]"],backdrop:true,position:"left",size:"medium",openAnimation(e){switch(e.position){case"left":return"move-from-left";case"right":return"move-from-right"}},closeAnimation(e){switch(e.position){case"left":return"move-to-left";case"right":return"move-to-right"}}},modal:{mainTargets:["[up-main~=modal]"],backdrop:true,size:"medium"},popup:{mainTargets:["[up-main~=popup]"],position:"bottom",size:"medium",align:"left",dismissable:"outside key"},foreignOverlaySelectors:["dialog"]};for(let r of e)t[r.mode].Class=r;return t}));let r=null;let i=[];function mainTargets(e){return n.flatMap(modeConfigs(e),"mainTargets")}function modeConfigs(e){return e==="root"?[t.root,t.any]:[t[e],t.overlay,t.any]}function normalizeLayerOption(e){if(!(e.layer instanceof up.Layer)){up.migrate.handleLayerOptions?.(e);if(n.isGiven(e.layer)){let r=String(e.layer).match(/^(new|shatter|swap)( (\w+))?/);if(r){e.layer="new";const n=r[1];const s=r[3];e.mode||=s||t.mode;n==="swap"?up.layer.isOverlay()&&(e.baseLayer="parent"):n==="shatter"&&(e.baseLayer="root")}}else e.mode?e.layer="new":n.isElementish(e.target)?e.layer=r.get(e.target,{normalizeLayerOptions:false}):e.origin?e.layer="origin":e.layer="current"}}function setBaseLayerOption(e){e.baseLayer instanceof up.Layer||(e.baseLayer=r.get("current",{...e,normalizeLayerOptions:false}))}function normalizeOptions(e){normalizeLayerOption(e);e.context??={};setBaseLayerOption(e)}function build(e,s){const{mode:i}=e;const{Class:o}=t[i];const a=n.reverse(modeConfigs(i));let u=up.migrate.handleLayerConfig;u&&a.forEach(u);e.openAnimation??=n.pluckKey(e,"animation");e=n.mergeDefined(...a,{mode:i,stack:r},e);s&&(e=s(e));return new o(e)}function openCallbackAttr(e,t){return s.callbackAttr(e,t,{exposedKeys:["layer"]})}function closeCallbackAttr(e,t){return s.callbackAttr(e,t,{exposedKeys:["layer","value","response"]})}function reset(){r.reset();i=n.filter(i,"isDefault")}async function open(e){e=n.options(e,{layer:"new",defaultToEmptyContent:true,navigate:true});let t=await up.render(e);return t.layer}function ask(e){return new Promise((function(t,r){e={...e,onAccepted:e=>t(e.value),onDismissed:e=>r(e.value)};open(e)}))}function anySelector(){return n.map(e,(e=>e.selector())).join()}function optionToString(e){return n.isString(e)?`layer "${e}"`:e.toString()}function isWithinForeignOverlay(e){let r=t.selector("foreignOverlaySelectors");return!!(r&&e.closest(r))}up.on("up:fragment:destroyed",(function(){r.sync()}));up.on("up:framework:evaled",(function(){r=new up.LayerStack}));up.on("up:framework:reset",reset);const o={config:t,mainTargets:mainTargets,open:open,build:build,ask:ask,normalizeOptions:normalizeOptions,openCallbackAttr:openCallbackAttr,closeCallbackAttr:closeCallbackAttr,anySelector:anySelector,optionToString:optionToString,get stack(){return r.layers},isWithinForeignOverlay:isWithinForeignOverlay};n.delegate(o,["get","getAll","root","overlays","current","front","sync","count","dismissOverlays"],(()=>r));n.delegate(o,["accept","dismiss","isRoot","isOverlay","isFront","on","off","emit","parent","history","location","mode","context","element","contains","size","affix"],(()=>r.current));return o}()},(e,t,r)=>{r.r(t)},(e,t,r)=>{r(96);up.link=function(){const e=up.util;const t=up.element;let r=null;const n="[up-content], [up-fragment], [up-document]";const s=`${n}, [up-target], [up-layer], [up-transition], [up-preload]`;const i="a[href], button";const o=new up.Config((()=>({followSelectors:["[up-follow]",`a:is(${s})`],noFollowSelectors:["[up-follow=false]","a[download]","a[target]",'a[href^="javascript:"]','a[href^="mailto:"]',`a[href^="#"]:not(${n})`,t.crossOriginSelector("href"),t.crossOriginSelector("up-href")],instantSelectors:["[up-instant]"],noInstantSelectors:["[up-instant=false]","[onclick]"],preloadSelectors:["[up-preload]"],noPreloadSelectors:["[up-preload=false]"],clickableSelectors:["[up-clickable]","[up-follow]","[up-emit]","[up-accept]","[up-dismiss]",`a:is(${s})`],noClickableSelectors:["[up-clickable=false]",i],preloadDelay:90})));function isPreloadDisabled(e){return!up.browser.canPushState()||!isFollowable(e)||!willCache(e)}function willCache(e){const t=parseRequestOptions(e);if(t.url){t.cache==null&&(t.cache="auto");t.basic=true;const e=new up.Request(t);return e.willCache()}}function reset(){r=null}const a=up.mockable((function(e,t,r){return up.render(followOptions(e,t,r))}));function parseRequestOptions(t,r,n){r=e.options(r);const s=new up.OptionsParser(t,r,{...n,fail:false});r.url=followURL(t,r);r.method=followMethod(t,r);s.json("headers");s.json("params");s.booleanOrString("cache");s.booleanOrString("expireCache");s.booleanOrString("evictCache");s.booleanOrString("revalidate");s.booleanOrString("abort");s.boolean("abortable");s.boolean("background");s.string("contentType");s.number("badResponseTime");s.number("timeout");return r}function followOptions(t,r,n){t=up.fragment.get(t);r=e.options(r);const s=new up.OptionsParser(t,r,{fail:true,...n});s.include(parseRequestOptions);s.boolean("feedback");r.origin||=t;s.boolean("fail");s.boolean("navigate",{default:true});s.string("confirm",{attr:["up-confirm","data-confirm"]});s.string("target");s.booleanOrString("fallback");s.string("match");s.string("content");s.string("fragment");s.string("document");s.boolean("useKeep");s.boolean("useHungry");s.callback("onLoaded");s.callback("onRendered",{mainKey:"result"});s.callback("onFinished",{mainKey:"result"});s.callback("onOffline",{mainKey:"error"});s.callback("onError",{mainKey:"error"});s.boolean("peel");s.string("layer");s.string("baseLayer");s.json("context");s.string("mode");s.string("align");s.string("position");s.string("class");s.string("size");s.booleanOrString("dismissable");s.parse(up.layer.openCallbackAttr,"onOpened");s.parse(up.layer.closeCallbackAttr,"onAccepted");s.parse(up.layer.closeCallbackAttr,"onDismissed");s.string("acceptEvent");s.string("dismissEvent");s.string("acceptLocation");s.string("dismissLocation");s.booleanOrString("history");s.booleanOrString("focus");s.boolean("saveScroll");s.boolean("saveFocus");s.booleanOrString("scroll");s.boolean("revealTop");s.number("revealMax");s.number("revealPadding");s.number("revealSnap");s.string("scrollBehavior");s.booleanOrString("history");s.booleanOrString("location");s.booleanOrString("title");s.boolean("metaTags");s.booleanOrString("lang");s.include(up.motion.motionOptions);r.guardEvent??=up.event.build("up:link:follow",{log:["Following link %o",t]});return r}function preload(e,t){e=up.fragment.get(e);let r=preloadIssue(e);if(r)return Promise.reject(new up.Error(r));const n=up.event.build("up:link:preload",{log:["Preloading link %o",e]});return a(e,{abortable:false,...t,guardEvent:n,preload:true})}function preloadIssue(e){if(!isSafe(e))return"Will not preload an unsafe link"}function followMethod(t,r={}){return e.normalizeMethod(r.method||t.getAttribute("up-method")||t.getAttribute("data-method"))}function followURL(e,t={}){const r=t.url||e.getAttribute("up-href")||e.getAttribute("href");if(r!=="#")return r}function isFollowable(e){e=up.fragment.get(e);return o.matches(e,"followSelectors")}function makeFollowable(e){isFollowable(e)||e.setAttribute("up-follow","")}function makeClickable(e){let r=e.matches("a, [up-follow]")?"link":"button";t.setMissingAttrs(e,{tabindex:"0",role:r,"up-clickable":""});e.addEventListener("keydown",(function(t){if(t.key==="Enter"||e.role==="button"&&t.key==="Space")return forkEventAsUpClick(t)}))}up.macro(o.selectorFn("clickableSelectors"),makeClickable);function shouldFollowEvent(e,t){if(e.defaultPrevented)return false;const r=`a, [up-follow], ${up.form.fieldSelector()}`;const n=e.target.closest(r);return!n||n===t}function isInstant(e){const t=e.closest(o.selector("instantSelectors"));return t&&!isInstantDisabled(t)}function isInstantDisabled(e){return o.matches(e,"noInstantSelectors")||o.matches(e,"noFollowSelectors")}function convertClicks(e){e.on("click",(function(t,n){if(up.event.isUnmodified(t)){isInstant(n)&&r?up.event.halt(t):(up.event.inputDevice==="key"||up.event.isSyntheticClick(t)||e.wasHitByMouseEvent(t)&&!didUserDragAway(t))&&forkEventAsUpClick(t);return r=null}}));e.on("mousedown",(function(e,t){if(up.event.isUnmodified(e)){r=e.target;isInstant(t)&&forkEventAsUpClick(e)}}))}function didUserDragAway(e){return r&&r!==e.target}function forkEventAsUpClick(e){let t=["clientX","clientY","button",...up.event.keyModifiers];const r=up.event.fork(e,"up:click",t);up.emit(e.target,r,{log:false})}function isSafe(e){const t=followMethod(e);return up.network.isSafeMethod(t)}function onLoadCondition(e,r,n){switch(e){case"insert":n();break;case"reveal":{let e=t.numberAttr(r,"up-intersect-margin");up.fragment.onFirstIntersect(r,n,{margin:e});break}case"hover":new up.LinkFollowIntent(r,n);break;case"manual":break}}function loadDeferred(e,t){let r=up.event.build("up:deferred:load",{log:["Loading deferred %o",e]});let n={navigate:false,guardEvent:r,...t};let s={target:":origin",cache:"auto",revalidate:"auto",feedback:true};return a(e,n,{defaults:s})}up.attribute("up-defer",{defaultValue:"insert"},(function(e,t){let doLoad=()=>up.error.muteUncriticalRejection(loadDeferred(e));onLoadCondition(t,e,doLoad)}));up.on("up:click",o.selectorFn("followSelectors"),(function(e,t){if(shouldFollowEvent(e,t)){up.event.halt(e,{log:true});up.focus(t,{preventScroll:true});up.error.muteUncriticalRejection(a(t))}}));up.attribute("up-expand",{defaultValue:"a, [up-href]",macro:true},(function(e,r){let n=t.get(e,r);if(n){t.setMissingAttrs(e,{"up-href":t.attr(n,"href"),...t.upAttrs(n)});e.classList.add(...t.upClasses(n));makeFollowable(e)}}));up.compiler(o.selectorFn("preloadSelectors"),(function(e){if(!isPreloadDisabled(e)){let doPreload=()=>up.error.muteUncriticalRejection(preload(e));let r=t.booleanOrStringAttr(e,"up-preload",null)??"hover";onLoadCondition(r,e,doPreload)}}));up.on("up:framework:reset",reset);return{follow:a,followOptions:followOptions,requestOptions:parseRequestOptions,preload:preload,makeFollowable:makeFollowable,isSafe:isSafe,isFollowable:isFollowable,shouldFollowEvent:shouldFollowEvent,convertClicks:convertClicks,config:o,loadDeferred:loadDeferred}}();up.follow=up.link.follow;up.deferred={load:up.link.loadDeferred}},(e,t,r)=>{r.r(t)},()=>{up.form=function(){const e=up.util;const t=up.element;const r=new up.Config((()=>({groupSelectors:["[up-form-group]","fieldset","label","form"],fieldSelectors:["select","input:not([type=submit]):not([type=image])","button[type]:not([type=submit])","textarea"],submitSelectors:["form:is([up-submit], [up-target], [up-layer], [up-transition])"],noSubmitSelectors:["[up-submit=false]","[target]",t.crossOriginSelector("action")],submitButtonSelectors:["input[type=submit]","input[type=image]","button[type=submit]","button:not([type])"],watchInputEvents:["input","change"],watchInputDelay:0,watchChangeEvents:["change"]})));function fieldSelector(e=""){return r.fieldSelectors.map((t=>t+e)).join()}function isField(e){return e.matches(fieldSelector())}function findFields(r){r=t.get(r);let n=t.subtree(r,fieldSelector());if(r.matches("form[id]")){const s=fieldSelector(t.attrSelector("form",r.getAttribute("id")));const i=up.fragment.all(s,{layer:r});n.push(...i);n=e.uniq(n)}return n}function findSubmitButtons(e){return t.subtree(e,submitButtonSelector())}function isSubmitButton(e){return e?.matches(submitButtonSelector())}function submitButtonSelector(){return r.selector("submitButtonSelectors")}const n=up.mockable(((e,t)=>up.render(submitOptions(e,t))));function submitOptions(t,r,n){t=getForm(t);r=e.options(r);let s=new up.OptionsParser(t,r,n);s.include(destinationOptions);s.string("failTarget",{default:up.fragment.tryToTarget(t)});s.booleanOrString("disable");r.guardEvent||=up.event.build("up:form:submit",{submitButton:r.submitButton,log:"Submitting form",params:r.params,form:t});r.origin||=up.viewport.focusedElementWithin(t)||r.submitButton||t;s.include(up.link.followOptions);return r}function watchOptions(t,r,n={}){r=e.options(r);let s=new up.OptionsParser(t,r,{...n,closest:true,attrPrefix:"up-watch-"});s.boolean("feedback");s.booleanOrString("disable");s.string("event");s.number("delay");let i=up.form.config;if(r.event==="input"){r.event=e.evalOption(i.watchInputEvents,t);r.delay??=i.watchInputDelay}else r.event==="change"&&(r.event=e.evalOption(i.watchChangeEvents,t));r.origin||=t;return r}function disableContainer(e){let t=document.activeElement;let r;let n=[...findFields(e),...findSubmitButtons(e)];for(let e of n){e===t&&(r=findGroup(t));raiseDisableStack(e)}r&&up.focus(r,{force:true,preventScroll:true});return function(){n.forEach(lowerDisableStack)}}function raiseDisableStack(e){if(!e.upDisableCount){e.upDisableCount||=0;e.upOriginalDisabled=e.disabled}e.upDisableCount++;e.disabled=true}function lowerDisableStack(e){if(e.upDisableCount)if(e.disabled){e.upDisableCount--;e.upDisableCount||(e.disabled=e.upOriginalDisabled)}else e.upDisableCount=0}function disableWhile(t,r){let n=handleDisableOption(r);e.always(t,n)}function handleDisableOption({disable:t,origin:r}){if(!t)return e.noop;let missingOption=e=>{up.fail("Cannot process { disable: '%s' } option without { %s }",t,e)};let getOrigin=()=>r||missingOption("origin");let getOriginForm=()=>getScope(getOrigin());let n;t===true?n=[getOriginForm()]:e.isString(t)&&(n=up.fragment.subtree(getOriginForm(),t,{origin:r}));return e.sequence(n.map(disableContainer))}function destinationOptions(t,r,n){r=e.options(r);t=getForm(t);const s=new up.OptionsParser(t,r,n);s.string("contentType",{attr:"enctype"});s.json("headers");const i=up.Params.fromForm(t);const o=r.submitButton??=findSubmitButtons(t)[0];if(o){i.addField(o);r.method||=o.getAttribute("formmethod");r.url||=o.getAttribute("formaction")}i.addAll(r.params);r.params=i;s.string("url",{attr:"action",default:up.fragment.source(t)});s.string("method",{attr:["up-method","data-method","method"],default:"GET",normalize:e.normalizeMethod});r.method==="GET"&&(r.url=up.Params.stripURL(r.url));return r}function watch(t,...r){t=up.element.get(t);const n=e.extractCallback(r)||watchCallbackFromElement(t)||up.fail("No callback given for up.watch()");let s=e.extractOptions(r);const i=new up.FieldWatcher(t,s,n);i.start();return()=>i.stop()}function watchCallbackFromElement(e){let t=e.getAttribute("up-watch");if(t)return up.NonceableCallback.fromString(t).toFunction("value","name").bind(e)}function autosubmit(e,t={}){const onChange=(t,r)=>n(e,r);return watch(e,{options:t,batch:true},onChange)}function getGroupSelectors(){return up.migrate.migratedFormGroupSelectors?.()||r.groupSelectors}function findGroup(e){return findGroupSolution(e).element}function findGroupSolution(t){return e.findResult(getGroupSelectors(),(function(e){let r=t.closest(e);if(r){let n=up.fragment.tryToTarget(r);let s=up.fragment.tryToTarget(t);let i=s&&r!==t&&`${e}:has(${s})`;let o=n||i;if(o)return{target:o,element:r,origin:t}}}))}function validate(...e){let t=parseValidateArgs(...e);let r=up.FormValidator.forElement(t.origin);return r.validate(t)}function parseValidateArgs(t,...r){const n=e.extractOptions(r);n.origin?n.target||=up.fragment.toTarget(t):n.origin||=up.fragment.get(t);return n}function switcherValues(r){let n;let s;if(r.matches("input[type=checkbox]"))if(r.checked){n=r.value;s=":checked"}else s=":unchecked";else if(r.matches("input[type=radio]")){const e=getScope(r);const i=r.getAttribute("name");const o=e.querySelector(`input[type=radio]${t.attrSelector("name",i)}:checked`);if(o){s=":checked";n=o.value}else s=":unchecked"}else n=r.value;const i=[];if(e.isPresent(n)){i.push(n);i.push(":present")}else i.push(":blank");e.isPresent(s)&&i.push(s);return i}function switchTargets(e,t={}){const r=t.target||t.target||e.getAttribute("up-switch");const n=getScope(e);r||up.fail("No switch target given for %o",e);const i=switcherValues(e);for(let e of up.fragment.all(n,r))s(e,i)}const s=up.mockable((function(r,n){let s;n||=switcherValues(findSwitcherForTarget(r));let i=r.getAttribute("up-hide-for");if(i){i=parseSwitchTokens(i);s=e.intersect(n,i).length===0}else{let t=r.getAttribute("up-show-for");t=t?parseSwitchTokens(t):[":present",":checked"];s=e.intersect(n,t).length>0}t.toggle(r,s);r.classList.add("up-switched")}));function parseSwitchTokens(t){return e.parseTokens(t,{json:true})}function findSwitcherForTarget(t){const r=getScope(t);const n=r.querySelectorAll("[up-switch]");const s=e.find(n,(function(e){const r=e.getAttribute("up-switch");return t.matches(r)}));return s||up.fail("Could not find [up-switch] field for %o",t)}function getForm(e,t={}){const r=up.fragment.get(e,t);return r.form||r.closest("form")}function getScope(e,t){return getForm(e,t)||up.layer.get(e).element}function focusedField(){return e.presence(document.activeElement,isField)}function isSubmittable(e){e=up.fragment.get(e);return r.matches(e,"submitSelectors")}up.on("submit",r.selectorFn("submitSelectors"),(function(t,r){if(t.defaultPrevented)return;const s=e.presence(t.submitter,isSubmitButton);up.event.halt(t,{log:true});up.error.muteUncriticalRejection(n(r,{submitButton:s}))}));up.compiler(validatingFieldSelector,(function(e){let t=up.FormValidator.forElement(e);t.watchContainer(e)}));function validatingFieldSelector(){let e=r.fieldSelectors.map((e=>`${e}[up-validate], [up-validate] ${e}`));let n=["[up-validate=false]"];return t.unionSelector(e,n)}up.compiler("[up-switch]",(e=>{switchTargets(e)}));up.on("change","[up-switch]",((e,t)=>{switchTargets(t)}));up.compiler("[up-show-for]:not(.up-switched), [up-hide-for]:not(.up-switched)",(e=>{s(e)}));up.attribute("up-watch",(e=>watch(e)));up.attribute("up-autosubmit",(e=>autosubmit(e)));return{config:r,submit:n,submitOptions:submitOptions,destinationOptions:destinationOptions,watchOptions:watchOptions,isSubmittable:isSubmittable,watch:watch,validate:validate,autosubmit:autosubmit,fieldSelector:fieldSelector,fields:findFields,isField:isField,submitButtons:findSubmitButtons,focusedField:focusedField,switchTarget:s,disableWhile:disableWhile,disable:disableContainer,group:findGroup,groupSolution:findGroupSolution,groupSelectors:getGroupSelectors,get:getForm,getScope:getScope}}();up.submit=up.form.submit;up.watch=up.form.watch;up.autosubmit=up.form.autosubmit;up.validate=up.form.validate},()=>{up.feedback=function(){const e=up.util;const t=up.element;const r=new up.Config((()=>({currentClasses:["up-current"],navSelectors:["[up-nav]","nav"],noNavSelectors:["[up-nav=false]"]})));function reset(){up.layer.root.feedbackLocation=null}const n="up-active";const s="up-loading";const i="a, [up-href]";function linkURLs(e){return e.upFeedbackURLs||=new up.LinkFeedbackURLs(e)}function updateFragment(e,{layer:n}={}){n||=up.layer.get(e);let s=getMatchableLayerLocation(n);const o=r.selector("navSelectors");const a=`${o} :is(${i}), ${o}:is(${i})`;const u=up.fragment.all(a,{layer:n});for(let e of u){const n=linkURLs(e).isCurrent(s);for(let t of r.currentClasses)e.classList.toggle(t,n);t.toggleAttr(e,"aria-current","page",n)}}function getMatchableLayerLocation(t){return t.feedbackLocation||e.matchableURL(t.location)}function findActivatableArea(e){return t.ancestor(e,i)||e}function showAroundRequest(r,i){if(!i.feedback)return;let clean=t=>e.always(r,t);let o=getActiveElementFromRenderOptions(r);o&&clean(t.addTemporaryClass(o,n));for(let e of r.fragments)clean(t.addTemporaryClass(e,s))}function getActiveElementFromRenderOptions(e){let t=e.origin;if(t)return findActivatableArea(t)}function updateLayerIfLocationChanged(e){const t=e.feedbackLocation;const r=getMatchableLayerLocation(e.location);if(!t||t!==r){e.feedbackLocation=r;updateFragment(e.element,{layer:e})}}function onBrowserLocationChanged(){const e=up.layer.front;e.showsLiveHistory()&&updateLayerIfLocationChanged(e)}up.on("up:location:changed",(e=>{onBrowserLocationChanged()}));up.on("up:fragment:compile",((e,t)=>{updateFragment(t)}));up.on("up:layer:location:changed",(e=>{updateLayerIfLocationChanged(e.layer)}));up.on("up:framework:reset",reset);return{config:r,showAroundRequest:showAroundRequest}}()},()=>{up.radio=function(){const e=up.element;const t=new up.Config((()=>({hungrySelectors:["[up-hungry]"],noHungrySelectors:["[up-hungry=false]"],pollInterval:3e4})));function hungrySteps(r){let{useHungry:n,origin:s,layer:i}=r;let o={current:[],other:[]};if(!n)return o;let a=t.selector("hungrySelectors");const u=[i,...i.ancestors,...i.descendants];for(let t of u){let n=up.fragment.all(t.element,a,{layer:t});for(let a of n){let n=up.fragment.tryToTarget(a,{origin:s});if(!n){up.warn("[up-hungry]","Ignoring untargetable fragment %o",a);continue}let u=e.attr(a,"up-if-layer");let l=u?up.layer.getAll(u,{baseLayer:t}):[t];let c=up.motion.motionOptions(a);let p=up.event.build("up:fragment:hungry",{log:false});let h=e.callbackAttr(a,"up-on-hungry",{exposedKeys:["newFragment","renderOptions"]});let d={selector:n,oldElement:a,layer:t,origin:s,...c,placement:"swap",useKeep:true,maybe:true,selectEvent:p,selectCallback:h,originalRenderOptions:r};if(l.includes(i)){let e=i===t?o.current:o.other;e.push(d)}}}o.other=up.fragment.compressNestedSteps(o.other);return o}function startPolling(e,t={}){up.FragmentPolling.forFragment(e).forceStart(t)}function stopPolling(e){up.FragmentPolling.forFragment(e).forceStop()}function pollOptions(e,r={}){const n={background:true};const s=new up.OptionsParser(e,r,{defaults:n});s.number("interval",{default:t.pollInterval});s.string("ifLayer",{default:"front"});s.include(up.link.requestOptions);return r}up.attribute("up-poll",(function(e){up.FragmentPolling.forFragment(e).onPollAttributeObserved()}));up.macro("[up-flashes]",(function(t){e.setMissingAttrs(t,{"up-hungry":"","up-if-layer":"subtree","up-keep":"",role:"alert"});t.addEventListener("up:fragment:keep",(function(t){e.isEmpty(t.newFragment)||t.preventDefault()}))}));return{config:t,hungrySteps:hungrySteps,startPolling:startPolling,stopPolling:stopPolling,pollOptions:pollOptions}}()},()=>{(function(){const e=up.element;function isRails(){return window.Rails||window.jQuery?.rails}for(let t of["method","confirm"]){const r=`up-${t}`;const n=`data-${t}`;up.macro(`a[${n}]`,(function(t){if(isRails()&&up.link.isFollowable(t)){e.setMissingAttr(t,r,t.getAttribute(n));t.removeAttribute(n)}}))}})()}];var r={};function __webpack_require__(e){var n=r[e];if(n!==void 0)return n.exports;var s=r[e]={exports:{}};t[e](s,s.exports,__webpack_require__);return s.exports}(()=>{__webpack_require__.r=e=>{typeof Symbol!=="undefined"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:true})}})();(()=>{__webpack_require__(1);__webpack_require__(2);__webpack_require__(3);__webpack_require__(4);__webpack_require__(5);__webpack_require__(6);__webpack_require__(7);__webpack_require__(9);__webpack_require__(10);__webpack_require__(11);__webpack_require__(12);__webpack_require__(13);__webpack_require__(14);__webpack_require__(15);__webpack_require__(16);__webpack_require__(17);__webpack_require__(18);__webpack_require__(19);__webpack_require__(20);__webpack_require__(21);__webpack_require__(22);__webpack_require__(23);__webpack_require__(24);__webpack_require__(25);__webpack_require__(26);__webpack_require__(27);__webpack_require__(28);__webpack_require__(29);__webpack_require__(30);__webpack_require__(31);__webpack_require__(32);__webpack_require__(33);__webpack_require__(34);__webpack_require__(35);__webpack_require__(36);__webpack_require__(37);__webpack_require__(38);__webpack_require__(39);__webpack_require__(40);__webpack_require__(41);__webpack_require__(42);__webpack_require__(43);__webpack_require__(44);__webpack_require__(45);__webpack_require__(46);__webpack_require__(47);__webpack_require__(48);__webpack_require__(49);__webpack_require__(50);__webpack_require__(51);__webpack_require__(52);__webpack_require__(53);__webpack_require__(54);__webpack_require__(55);__webpack_require__(56);__webpack_require__(57);__webpack_require__(58);__webpack_require__(59);__webpack_require__(60);__webpack_require__(61);__webpack_require__(62);__webpack_require__(63);__webpack_require__(64);__webpack_require__(65);__webpack_require__(66);__webpack_require__(67);__webpack_require__(68);__webpack_require__(69);__webpack_require__(70);__webpack_require__(71);__webpack_require__(72);__webpack_require__(73);__webpack_require__(74);__webpack_require__(75);__webpack_require__(76);__webpack_require__(77);__webpack_require__(78);__webpack_require__(79);__webpack_require__(80);__webpack_require__(81);__webpack_require__(82);__webpack_require__(83);__webpack_require__(84);__webpack_require__(85);__webpack_require__(86);__webpack_require__(88);__webpack_require__(90);__webpack_require__(91);__webpack_require__(93);__webpack_require__(95);__webpack_require__(97);__webpack_require__(98);__webpack_require__(99);__webpack_require__(100);up.framework.onEvaled()})()})();var t={};const r=exports.__esModule;export{r as __esModule,t as default};

